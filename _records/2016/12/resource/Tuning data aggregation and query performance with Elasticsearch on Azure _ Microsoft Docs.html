<!DOCTYPE html>
<!-- saved from url=(0116)https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance -->
<html class="js noTouch" lang="en-us" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script async="" src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/jsll-3.3.1.js.下载"></script><script async="" src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/ms.js.下载"></script><script async="" src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/open-rating.entry.min.js.下载"></script><script async="" src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/open-commenting.entry.min.js.下载"></script><script async="" src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/Livefyre.js.下载"></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Tuning data aggregation and query performance with Elasticsearch on Azure">
    <meta property="og:image" content="https://docs.microsoft.com/en-us/_themes/images/microsoft-header.png">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@docsmsft">
    <meta name="twitter:title" content="Tuning data aggregation and query performance with Elasticsearch on Azure">
    <meta name="twitter:description" content="A summary of considerations when optimizing query and search performance for Elasticsearch.">
    <meta name="twitter:image" content="https://docs.microsoft.com/en-us/_themes/images/microsoft-header.png">    
    <meta name="twitter:image:alt" content="Microsoft Logo">
    
    <meta name="breadcrumb_path" content="/azure/bread/toc.json">
<meta name="tags" content="">
<meta name="ms.devlang" content="na">
<meta name="ms.tgt_pltfrm" content="na">
<meta name="ms.assetid" content="da54e75e-0b08-45b5-a171-f67d88b77c5b">
<meta name="author" content="dragon119">
<meta name="editor" content="">
<meta name="description" content="A summary of considerations when optimizing query and search performance for Elasticsearch.">
<meta name="ms.author" content="masashin">
<meta name="manager" content="bennage">
<meta name="documentationcenter" content="na">
<meta name="ms.topic" content="article">
<meta name="services" content="">
<meta name="ms.service" content="guidance">
<meta name="ms.date" content="09/22/2016">
<meta name="ms.workload" content="na">
<meta name="search.ms_sitename" content="Docs">
<meta name="search.ms_docsetname" content="azure-documents">
<meta name="version" content="0">
<meta name="locale" content="en-us">
<meta name="site_name" content="Docs">
<meta name="search.ms_product" content="Azure">
<meta name="depot_name" content="Azure.azure-documents">
<meta name="updated_at" content="2016-11-03 11:53 PM">
<meta name="gitcommit" content="https://github.com/Microsoft/azure-docs-pr/blob/2ea002938d69ad34aff421fa0eb753e449724a8f/articles/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance.md">
<meta name="original_content_git_url" content="https://github.com/Microsoft/azure-docs-pr/blob/live/articles/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance.md">
<meta name="document_id" content="6ee7d587-7444-0e7e-dd85-707057cea295">
<meta name="pagetype" content="Conceptual">
<meta name="toc_rel" content="TOC.json">

    
    <meta name="scope" content="Azure">
    
    
      
    <meta name="brand" content="azure">
    
    <link href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance" rel="canonical">
    <title>Tuning data aggregation and query performance with Elasticsearch on Azure | Microsoft Docs</title>
    <link rel="stylesheet" href="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/e0ce3378843779296d07.conceptual.css">
    <script>
	var msDocs = {
		data:{},
		functions:{}
	};
	</script>


<script>
	msDocs.data.pathToTheme = '../_themes/';
</script>

<link rel="stylesheet" href="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/azureHeader.css">

<script>
function cdnfallback() {
	if (window.location.search.indexOf('cdn=disable') === -1) {
		window.location.href = '?cdn=disable';
	}
}
</script>

<!--[if lt IE 9]>
	<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.12.4.min.js"></script>
	<script src="../_themes/global/js/polyfills/all.js"></script>
	<script src="../_themes/global/js/azureHeader/respond_and_ie8Setup_combine.js"></script>
<![endif]-->
<!--[if gte IE 9]><!-->
	<script src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/jquery-2.2.4.min.js.下载"></script>
<!--<![endif]-->
<script>window.jQuery || document.write('<script src="../_themes/global/js/jquery/jquery-1.12.4.min.js"><\/script>')</script>

  <script src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/global.min.js.下载"></script>
<script src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/header.js.下载"></script>

<script src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/6607840572.js.下载"></script> 



  <script type="text/javascript" charset="utf-8" async="" src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/1.e0ce3378843779296d07.1.js.下载"></script><script type="text/javascript" charset="utf-8" async="" src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/4.e0ce3378843779296d07.4.js.下载"></script><script type="text/javascript" charset="utf-8" async="" src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/2.e0ce3378843779296d07.2.js.下载"></script><meta name="ms.EXP" content="undefined"><meta name="ms.SID" content="9F3D7DC4-C85F-4B29-B56D-BAE1D972ACF6"><meta name="ms.documentid" content="6ee7d587-7444-0e7e-dd85-707057cea295"><meta name="ms.contentlang" content="en-us"><meta name="ms.publishtime" content="2016-11-03 11:53 PM"><meta name="ms.giturl" content="https://github.com/Microsoft/azure-docs-pr/blob/live/articles/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance.md"><meta name="ms.sitename" content="Docs"><meta name="ms.gitcommit" content="https://github.com/Microsoft/azure-docs-pr/blob/2ea002938d69ad34aff421fa0eb753e449724a8f/articles/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance.md"><meta name="ms.depotname" content="Azure.azure-documents"><meta name="ms.opspagetype" content="Conceptual"><meta name="ms.locale" content="en-us"><meta name="ms.lang" content="en"><meta name="ms.loc" content="us"><meta name="ms.contentsource" content="OP"><meta name="ms.perf.timing" content=",,0,6,730,730,1653,1657,1670,2230,2230,2360,,,"><script type="text/javascript" charset="utf-8" async="" src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/3.e0ce3378843779296d07.3.js.下载"></script><script type="text/javascript" charset="utf-8" async="" src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/7.e0ce3378843779296d07.7.js.下载"></script><script src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/ai.0.js.下载"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="/_chrome/commenting/master/open-commenting.ui.v1.0.2-7-g1b78816.master.min.js" src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/open-commenting.ui.v1.0.2-7-g1b78816.master.min.js.下载"></script><style type="text/css">.or-o, .or-so {
    margin: 0;
    padding: 0;
    height: auto;
    width: auto;
    position: relative;
    float: none;
    border: none;
    border-radius: 0;
    outline: none;
    background: none;
    box-sizing: border-box;
    font: 13px 'Segoe UI', Frutiger, 'Frutiger Linotype', 'Dejavu Sans', 'Helvetica Neue', Arial, sans-serif;
    letter-spacing: normal;
    text-transform: none;
    border-spacing: 0;
    border-collapse: collapse;
    transform: none;
    transition: none;
    animation: none;
}
.or-o:before, .or-o:after, .or-so:before, .or-so:after {
    content: none;
}
.or-e-0 {
    transition: none !important;
}
.or-f {
    padding: 1px;
}
.or-f::-moz-focus-inner {
    border: none;
    padding: 0;
}
.or-lw {
    clear: both;
}
h1, h2 {}
h1.or-t, h2.or-t {
    font-weight: lighter;
}
h1.or-t {
    font-size: 40px;
}
h2.or-t {
    font-size: 30px;
}
h3.or-t {
    font-size: 20px;
}
h4.or-t {
    font-size: 17px;
}
.or-b {
    cursor: pointer;
}
.or-b>.or-c {
    display: inline-block;
    padding: 4px 25px;
    width: 100%;
    height: 100%;
}
.or-b:active {
    transform: scale(0.98, 0.95);
}
.or-b[disabled] {
    cursor: default;
}
.or-b[disabled]:active {
    transform: none;
}
.or-g {
    display: inline-block;
    line-height: 0;
}
.or-l {
    cursor: pointer;
    padding: 5px 1px;
    vertical-align: baseline;
}
.or-l>.or-c {
    text-decoration: underline;
}
.or-a {
    cursor: pointer;
}
.or-a>.or-c {
    display: inline-block;
    padding: 8px;
    width: 100%;
    height: 100%;
}
.or-v {
    cursor: pointer;
    padding-bottom: 2px;
    /* For IE :active propagation BUG Fix */
}
.or-v>span {
    display: inline-block;
}
.or-v>input[type=checkbox] {
    -moz-appearance: checkbox-container;
    width: 0;
    height: 0;
    opacity: 0;
}
.or-v>input[type=checkbox]+span, .or-v>input[type=checkbox]+span+span {
    position: absolute;
    width: 20px;
    height: 20px;
    overflow: hidden;
}
.or-v>input[type=checkbox]+span+span {
    opacity: 0;
}
.or-v>input[type=checkbox]:checked+span+span {
    opacity: 1;
}
.or-v>span:last-child {
    margin: 0 0 0 25px;
    line-height: 19px;
}
.or-v:after {
    content: '';
    display: inline-block;
    position: absolute;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    opacity: 0;
}
.or-pc[dir=rtl] .or-v>span:last-child {
    margin: 0 25px 0 0;
}
.or-x {
    resize: none;
    padding: 5px;
}
.or-c-mf {
    padding: 10px;
}
.or-c-mf.or-e-fi {
    transition: opacity 0.1s linear;
}
.or-c-mf.or-e-fo {
    transition: opacity 0.75s linear;
}
.or-c-pf {
    padding: 7px;
    max-height: 100%;
    overflow: auto;
}
.or-c-pf>.or-a {
    padding: 0;
    position: absolute;
    right: 0;
    top: 0;
    line-height: 0;
    width: 20px;
    height: 20px;
}
.or-c-pf>.or-a.or-f.or-k {
    outline: none;
}
.or-c-pf>.or-a>.or-c.or-g {
    padding: 0;
}
.or-c-pf>.or-a>.or-c.or-g>svg {
    stroke-width: 1px;
}
.or-c-pf.or-e-fi, .or-c-pf.or-e-fo {
    transition: opacity 0.1s linear;
}
.or-c-pf>.or-lw {
    overflow: hidden;
    padding: 3px;
}
.or-c-pf>.or-lw.or-e-h.or-e-w.or-e-fi {
    transition: height 0.167s cubic-bezier(0.1, 0.9, 0.2, 1.0),
                    width 0.167s cubic-bezier(0.1, 0.9, 0.2, 1.0),
                    opacity 0.1s linear 0.167s;
}
.or-pc[dir=rtl] .or-c-pf>.or-a {
    left: 0;
    right: initial;
}
.or-c-md {
    position: fixed;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    display: -ms-flexbox;
    display: flex;
    -ms-flex-direction: column;
        flex-direction: column;
    -ms-flex-align: center;
        align-items: center;
    -ms-flex-pack: center;
        justify-content: center;
}
.or-c-md>.or-c {
    overflow: auto;
}
.or-c-md>.or-c.or-e-fi.or-e-t {
    transition: opacity 0.167s linear, transform 0.367s cubic-bezier(0.1, 0.9, 0.2, 1.0);
}
.or-c-md>.or-c.or-e-fo.or-e-t {
    transition: opacity 0.1s linear, transform 0.1s linear;
}
.or-c-v h3.or-t {
    font-size: 13px;
    margin: 0 18px 5px 1px;
}
.or-c-v>table.or-lw {
    table-layout: fixed;
}
.or-c-v>table.or-lw td {
    width: 50%;
}
.or-c-v>table.or-lw td>.or-b {
    width: 100%;
}
.or-c-v>table.or-lw td:first-child {
    padding-right: 1px;
}
.or-c-v>table.or-lw td:last-child {
    padding-left: 1px;
}
.or-pc[dir=rtl] .or-c-v h3.or-t {
    margin: 0 1px 5px 18px;
}
.or-pc[dir=rtl] .or-c-v>table.or-lw td:first-child {
    border: none;
    border-left: 2px transparent solid;
}
.or-c-f {
    width: 235px;
    max-width: 100%;
}
.or-c-f h3.or-t {
    font-size: 13px;
    font-weight: bold;
}
.or-c-f .or-v, .or-c-f .or-x, .or-c-f>.or-b {
    display: block;
}
.or-c-f .or-v {
    margin: 3px 0 0 0;
}
.or-c-f .or-x {
    width: 100%;
    height: 75px;
}
.or-c-f>.or-lw {
    margin: 3px 0 0 0;
}
.or-c-f>.or-lw>.or-t {
    margin: 0 18px 0 0;
}
.or-c-f>.or-lw.or-e-h.or-e-w.or-e-fi {
    transition: height 0.167s cubic-bezier(0.1, 0.9, 0.2, 1.0),
                    width 0.167s cubic-bezier(0.1, 0.9, 0.2, 1.0),
                    opacity 0.167s linear;
}
.or-c-f>h3.or-t {
    margin: 7px 0 5px 1px;
}
.or-c-f>.or-b {
    float: right;
    margin: 4px -1px 0 0;
}
.or-pc[dir=rtl] .or-c-f {}
.or-pc[dir=rtl] .or-c-f>h3.or-t {
    margin: 7px 1px 5px 0;
}
.or-pc[dir=rtl] .or-c-f>.or-lw>.or-t {
    margin: 0 0 0 18px;
}
.or-pc[dir=rtl] .or-c-f>.or-b {
    float: left;
    margin: 4px 0 0 -1px;
}
.or-c-t h3.or-t {
    font-size: 13px;
}
.or-c-pf .or-c-t h3.or-t {
    margin: 3px 18px 0 0;
}
.or-pc[dir=rtl] .or-c-pf .or-c-t h3.or-t {
    margin: 3px 0 0 18px;
}
.or-c-mv svg {
    width: 12px;
    height: 12px;
    stroke-width: 1px;
}
.or-c-mv>.or-c {
    padding: 3px 20px 5px 17px;
}
.or-c-mv>.or-c>span {
    vertical-align: middle;
}
.or-c-mv>.or-c>.or-t {
    color: inherit;
    margin-left: 2px;
}
.or-c-mv.or-e-fi {
    transition: opacity 0.1s linear;
}
.or-pc[dir=rtl] .or-c-mv>.or-c {
    padding: 3px 17px 5px 20px;
}
.or-pc[dir=rtl] .or-c-mv>.or-c>.or-t {
    margin: 0 2px 0 0;
}
.or-t-ml .or-f {}
.or-t-ml .or-f.or-k {
    outline: 2px black solid;
}
.or-t-ml .or-t {
    color: black;
}
.or-t-ml .or-b {}
.or-t-ml .or-b, .or-t-ml .or-b:hover, .or-t-ml .or-b:active {
    background: none;
}
.or-t-ml .or-b>.or-c {
    color: white;
    stroke: white;
    fill: white;
    background: #0078d7;
    border: 2px transparent solid;
}
.or-t-ml .or-b:hover>.or-c {
    border-color: rgba(0, 0, 0, 0.4);
}
.or-t-ml .or-b:active>.or-c {
    color: black;
    stroke: black;
    fill: black;
    background: #999999;
    border-color: transparent;
}
.or-t-ml .or-b[disabled]>.or-c, .or-t-ml .or-b[disabled]:hover>.or-c {
    color: rgba(0, 0, 0, 0.4);
    stroke: rgba(0, 0, 0, 0.4);
    fill: rgba(0, 0, 0, 0.4);
    background: rgba(0, 0, 0, 0.2);
    border-color: transparent;
}
.or-t-ml .or-l {}
.or-t-ml .or-l, .or-t-ml .or-l:hover, .or-t-ml .or-l:active {
    background: none;
}
.or-t-ml .or-l>.or-c {
    color: #0078d7;
}
.or-t-ml .or-l:hover>.or-c {
    color: rgba(0, 0, 0, 0.6);
}
.or-t-ml .or-l:active>.or-c {
    color: rgba(0, 0, 0, 0.4);
}
.or-t-ml .or-a {}
.or-t-ml .or-a, .or-t-ml .or-a:hover, .or-t-ml .or-a:active {
    background: none;
}
.or-t-ml .or-a>.or-c {
    color: black;
    background: transparent;
}
.or-t-ml .or-a:hover>.or-c {
    background: rgba(0, 0, 0, 0.1);
}
.or-t-ml .or-a:active>.or-c {
    background: rgba(0, 0, 0, 0.2);
}
.or-t-ml .or-v {}
.or-t-ml .or-v>input[type=checkbox] {}
.or-t-ml .or-v>input[type=checkbox]+span {
    border: 2px solid rgba(0, 0, 0, 0.4);
    background: none;
}
.or-t-ml .or-v>input[type=checkbox]+span+span>svg {
    stroke: white;
    stroke-width: 1.5px;
    fill: transparent;
}
.or-t-ml .or-v:hover>input[type=checkbox]+span, .or-t-ml .or-v:hover>input[type=checkbox]:checked+span {
    border-color: black;
}
.or-t-ml .or-v:active>input[type=checkbox]+span, .or-t-ml .or-v>input[type=checkbox]:checked+span, .or-t-ml .or-v:active>input[type=checkbox]:checked+span {
    border-color: transparent;
}
.or-t-ml .or-v:active>input[type=checkbox]+span, .or-t-ml .or-v:active>input[type=checkbox]:checked+span {
    background: rgba(0, 0, 0, 0.6);
}
.or-t-ml .or-v>input[type=checkbox]:checked+span {
    background: #0078d7;
}
.or-t-ml .or-x {
    color: black;
    background: rgba(255, 255, 255, 0.4);
    border: 2px rgba(0, 0, 0, 0.4) solid;
}
.or-t-ml .or-x:hover {
    background: rgba(255, 255, 255, 0.6);
    border-color: #171717;
}
.or-t-ml .or-x:active, .or-t-ml .or-x:focus {
    color: black;
    background: white;
    border-color: #0078d7;
}
.or-t-ml .or-x:active::-webkit-input-placeholder, .or-t-ml .or-x:focus::-webkit-input-placeholder {
    color: rgba(0, 0, 0, 0.4);
}
.or-t-ml .or-x:active::-moz-placeholder, .or-t-ml .or-x:focus::-moz-placeholder {
    color: rgba(0, 0, 0, 0.4);
}
.or-t-ml .or-x:active:-ms-input-placeholder, .or-t-ml .or-x:focus:-ms-input-placeholder {
    color: rgba(0, 0, 0, 0.4);
}
.or-t-ml .or-x:active::placeholder, .or-t-ml .or-x:focus::placeholder {
    color: rgba(0, 0, 0, 0.4);
}
.or-t-ml .or-x::-webkit-input-placeholder {
    color: rgba(0, 0, 0, 0.6);
}
.or-t-ml .or-x::-moz-placeholder {
    color: rgba(0, 0, 0, 0.6);
}
.or-t-ml .or-x:-ms-input-placeholder {
    color: rgba(0, 0, 0, 0.6);
}
.or-t-ml .or-x::placeholder {
    color: rgba(0, 0, 0, 0.6);
}
.or-t-ml .or-c-pf, .or-t-ml .or-c-mf {
    border: 1px rgba(133, 133, 133, 0.4) solid;
    background: white;
}
.or-t-ml .or-c-pf {}
.or-t-ml .or-c-pf>.or-a {}
.or-t-ml .or-c-pf>.or-a.or-f.or-k:after {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    border: 2px black solid;
}
.or-t-ml .or-c-pf>.or-a>.or-c.or-g>svg {
    stroke: rgba(0, 0, 0, 0.6);
}
.or-t-ml .or-c-pf>.or-a:hover>.or-c.or-g>svg {
    stroke: #c80000;
}
.or-t-ml .or-c-pf>.or-a:active>.or-c.or-g>svg {
    stroke: #8c0000;
}
.or-t-ml .or-c-md {
    background: rgba(255, 255, 255, 0.6);
}
.or-t-ml .or-c-md>.or-c {
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.05);
}

@media screen and (-ms-high-contrast: active) {
    .or-t-ml .or-b, .or-t-md .or-b {}
    .or-t-ml .or-b>.or-c, .or-t-ml .or-b:active>.or-c, .or-t-md .or-b>.or-c, .or-t-md .or-b:active>.or-c {
        stroke: white;
        fill: white;
    }
    .or-t-ml .or-c-pf>.or-a>.or-c.or-g>svg, .or-t-md .or-c-pf>.or-a>.or-c.or-g>svg {
        stroke: white;
    }
}

@media screen and (-ms-high-contrast: black-on-white) {
    .or-t-ml .or-b, .or-t-md .or-b {}
    .or-t-ml .or-b>.or-c, .or-t-ml .or-b:active>.or-c, .or-t-md .or-b>.or-c, .or-t-md .or-b:active>.or-c {
        stroke: black;
        fill: black;
    }
    .or-t-ml .or-v>input[type=checkbox]+span+span>svg, .or-t-md .or-v>input[type=checkbox]+span+span>svg {
        stroke: black;
    }
    .or-t-ml .or-c-pf>.or-a>.or-c.or-g>svg, .or-t-md .or-c-pf>.or-a>.or-c.or-g>svg {
        stroke: black;
    }
}
</style><style type="text/css">[id='openFeedbackContainer']{ position: fixed; right: 10px; bottom: 10px; }
[id='openFeedbackContainer'][dir='rtl']{ left: 10px; right: initial; }</style><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="//cdn.livefyre.com/libs/fyre.conv/v3.0.0/livefyre.min.js" src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/livefyre.min.js.下载"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="//cdn.livefyre.com/libs/sidenotes/v1.5.6/sidenotes.min.js" src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/sidenotes.min.js.下载"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="//cdn.livefyre.com/libs/identity/v1.1.5/simple/javascripts/customprofiles.min.js" src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/customprofiles.min.js.下载"></script><link rel="stylesheet" type="text/css" href="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/livefyre_main.css" media="all"><script type="text/javascript" src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/livefyre_base.js.下载" async="" defer=""></script><script type="text/javascript" src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/livefyre_mod_main.js.下载" async="" defer=""></script><link rel="stylesheet" type="text/css" href="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/sp.css" media="all"><style type="text/css" id="fyre-brand-styles-v2">.fyre-lfep2,
.fyre-lfep2 input,
.fyre-lfep2 textarea {
    font-family: ;
}

.fyre-cp-form-btns .fyre-cp-form-back-btn,
.fyre-cp-form-btns .fyre-cp-form-submit-btn {
    background-color: #e86600;
}

.fyre-cp-link-create {
    color: #e86600;
}

p.fyre-profile-user-comments span,
p.fyre-profile-user-likes span {
    color: #e86600;
}

.fyre-profile-comment-footer a {
    color: #e86600;
}

a.fyre-profile-more-link {
    color: #e86600;
}

.fyre-cp-form .fyre-cp-edit-save-msg {
    color: #e86600
}</style><script type="text/javascript" src="https://d3qdfnco3bamip.cloudfront.net/wjs/v3.0.1481843438/javascripts/livefyre_mod_editor_main.js" async="" defer=""></script><link rel="stylesheet" type="text/css" href="https://cdn.livefyre.com/libs/sidenotes/v1.5.6/css/block.css" media="all"></head>
  <body mycollectionplug="bind">

<div class="az_h default">

    <header data-tag-area="header" data-tag-group="header"> <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" class="skip-nav" title="Skip Navigation">Skip Navigation</a> <div class="row column"> <a href="https://azure.microsoft.com/en-us/" class="logo" title="Microsoft Azure"> <svg x="0px" y="0px" width="165px" height="20px" viewBox="0 0 165 20"> <path fill="#29A5DE" d="M18,19H16V7.1C16,6.2,16,5,16.1,3.7h0c-0.2,0.8-0.4,1.4-0.5,1.7L9.5,19h-1l-6-13.5c-0.2-0.4-0.3-1-0.5-1.8
                    h0C2,4.4,2,5.5,2,7.1V19H0V1.3h2.7l5.4,12.3c0.4,0.9,0.7,1.7,0.8,2.1H9c0.4-1,0.6-1.7,0.9-2.2l5.5-12.3H18V19z"></path> <path fill="#29A5DE" d="M22.8,3.1c-0.4,0-0.7-0.1-0.9-0.4s-0.4-0.6-0.4-0.9s0.1-0.7,0.4-0.9c0.3-0.3,0.6-0.4,0.9-0.4
                    c0.4,0,0.7,0.1,0.9,0.4c0.3,0.3,0.4,0.6,0.4,0.9c0,0.4-0.1,0.7-0.4,0.9C23.5,3,23.2,3.1,22.8,3.1z M23.8,19h-2V6.3h2V19z"></path> <path fill="#29A5DE" d="M35.8,18.4c-1,0.6-2.1,0.9-3.5,0.9c-1.8,0-3.3-0.6-4.4-1.8c-1.1-1.2-1.7-2.7-1.7-4.6c0-2.1,0.6-3.7,1.8-5
                    C29.4,6.7,30.9,6,32.9,6C34,6,35,6.2,35.9,6.7v2.1c-0.9-0.7-1.9-1-3-1c-1.3,0-2.3,0.5-3.2,1.4c-0.8,0.9-1.2,2.1-1.2,3.6
                    c0,1.5,0.4,2.6,1.2,3.5c0.8,0.9,1.8,1.3,3.1,1.3c1.1,0,2.1-0.4,3.1-1.1V18.4z"></path> <path fill="#29A5DE" d="M44.9,8.4C44.5,8.1,44,8,43.3,8c-0.9,0-1.6,0.4-2.2,1.2c-0.6,0.8-0.9,1.9-0.9,3.3V19h-2V6.3h2v2.6h0
                    c0.3-0.9,0.7-1.6,1.3-2.1c0.6-0.5,1.3-0.7,2-0.7c0.5,0,0.9,0.1,1.2,0.2V8.4z"></path> <path fill="#29A5DE" d="M51.4,19.3c-1.9,0-3.4-0.6-4.5-1.8c-1.1-1.2-1.7-2.7-1.7-4.7c0-2.1,0.6-3.8,1.7-5S49.7,6,51.7,6
                    c1.9,0,3.4,0.6,4.4,1.7c1.1,1.2,1.6,2.8,1.6,4.8c0,2-0.6,3.6-1.7,4.8C54.8,18.6,53.3,19.3,51.4,19.3z M51.5,7.7
                    c-1.3,0-2.3,0.4-3.1,1.3c-0.8,0.9-1.1,2.1-1.1,3.7c0,1.5,0.4,2.7,1.1,3.5c0.8,0.9,1.8,1.3,3.1,1.3c1.3,0,2.3-0.4,3-1.3
                    c0.7-0.8,1.1-2,1.1-3.6c0-1.6-0.4-2.8-1.1-3.6C53.8,8.2,52.8,7.7,51.5,7.7z"></path> <path fill="#29A5DE" d="M59.5,18.5v-2.2c1.1,0.8,2.3,1.2,3.6,1.2c1.8,0,2.7-0.6,2.7-1.8c0-0.3-0.1-0.6-0.2-0.9
                    c-0.2-0.2-0.4-0.4-0.6-0.6c-0.3-0.2-0.6-0.3-0.9-0.5c-0.3-0.1-0.7-0.3-1.1-0.4c-0.6-0.2-1-0.4-1.5-0.7c-0.4-0.2-0.8-0.5-1.1-0.8
                    c-0.3-0.3-0.5-0.6-0.6-1c-0.1-0.4-0.2-0.8-0.2-1.3c0-0.6,0.1-1.1,0.4-1.6C60.2,7.7,60.5,7.3,61,7c0.5-0.3,1-0.5,1.5-0.7
                    C63.1,6.1,63.7,6,64.3,6c1.1,0,2.1,0.2,2.9,0.6v2c-0.9-0.6-2-0.9-3.2-0.9c-0.4,0-0.7,0-1,0.1c-0.3,0.1-0.6,0.2-0.8,0.4
                    c-0.2,0.2-0.4,0.3-0.5,0.6c-0.1,0.2-0.2,0.5-0.2,0.7c0,0.3,0.1,0.6,0.2,0.8c0.1,0.2,0.3,0.4,0.5,0.6c0.2,0.2,0.5,0.3,0.8,0.5
                    c0.3,0.1,0.7,0.3,1.1,0.5c0.6,0.2,1.1,0.4,1.5,0.7c0.4,0.2,0.8,0.5,1.1,0.8c0.3,0.3,0.6,0.6,0.7,1c0.2,0.4,0.3,0.8,0.3,1.3
                    c0,0.6-0.1,1.2-0.4,1.6c-0.3,0.5-0.6,0.8-1.1,1.1c-0.5,0.3-1,0.5-1.6,0.7c-0.6,0.1-1.2,0.2-1.9,0.2C61.6,19.3,60.4,19,59.5,18.5z"></path> <path fill="#29A5DE" d="M75.6,19.3c-1.9,0-3.4-0.6-4.5-1.8c-1.1-1.2-1.7-2.7-1.7-4.7c0-2.1,0.6-3.8,1.7-5C72.4,6.6,73.9,6,75.9,6
                    c1.9,0,3.4,0.6,4.4,1.7c1.1,1.2,1.6,2.8,1.6,4.8c0,2-0.6,3.6-1.7,4.8C79,18.6,77.5,19.3,75.6,19.3z M75.7,7.7
                    c-1.3,0-2.3,0.4-3.1,1.3c-0.8,0.9-1.1,2.1-1.1,3.7c0,1.5,0.4,2.7,1.1,3.5c0.8,0.9,1.8,1.3,3.1,1.3c1.3,0,2.3-0.4,3-1.3
                    c0.7-0.8,1.1-2,1.1-3.6c0-1.6-0.4-2.8-1.1-3.6C78.1,8.2,77,7.7,75.7,7.7z"></path> <path fill="#29A5DE" d="M97.6,8.1V6.3h-3.2V2.6l-2,0.7v3.1h-2.6h-1.5h-1.4V4.4c0-1.8,0.7-2.7,2.1-2.7c0.5,0,0.9,0.1,1.3,0.3V0.2
                    C89.9,0.1,89.4,0,88.8,0c-1.1,0-2.1,0.4-2.9,1.2c-0.8,0.8-1.1,1.8-1.1,3.1v2h-2.2v1.7h2.2V19h2V8.1h1.4h1.5h2.6v7.5
                    c0,2.5,1.1,3.7,3.3,3.7c0.8,0,1.4-0.1,1.9-0.4v-1.7c-0.4,0.3-0.8,0.4-1.3,0.4c-0.7,0-1.1-0.2-1.4-0.5c-0.3-0.4-0.4-1-0.4-1.8V8.1
                    H97.6z"></path> <path fill="#29A5DE" d="M119.9,19h-2.3l-1.9-5h-7.5l-1.8,5h-2.3L111,1.3h2.1L119.9,19z M115.1,12.1l-2.8-7.5
                    c-0.1-0.2-0.2-0.6-0.3-1.2h0c-0.1,0.5-0.2,0.9-0.3,1.2l-2.7,7.5H115.1z"></path> <path fill="#29A5DE" d="M130.4,6.9l-7.5,10.3h7.4V19H120v-0.6l7.5-10.3h-6.8V6.3h9.7V6.9z"></path> <path fill="#29A5DE" d="M142.6,19h-2v-2h0c-0.8,1.5-2.1,2.3-3.9,2.3c-3,0-4.5-1.8-4.5-5.4V6.3h2v7.2c0,2.7,1,4,3.1,4
                    c1,0,1.8-0.4,2.4-1.1c0.6-0.7,1-1.7,1-2.9V6.3h2V19z"></path> <path fill="#29A5DE" d="M152.6,8.4c-0.4-0.3-0.9-0.4-1.5-0.4c-0.9,0-1.6,0.4-2.2,1.2c-0.6,0.8-0.9,1.9-0.9,3.3V19h-2V6.3h2v2.6h0
                    c0.3-0.9,0.7-1.6,1.3-2.1c0.6-0.5,1.3-0.7,2-0.7c0.5,0,0.9,0.1,1.2,0.2V8.4z"></path> <path fill="#29A5DE" d="M164,13.1h-8.9c0,1.4,0.4,2.5,1.1,3.3c0.7,0.8,1.7,1.1,3,1.1c1.4,0,2.7-0.5,3.9-1.4V18
                    c-1.1,0.8-2.6,1.2-4.4,1.2c-1.8,0-3.2-0.6-4.2-1.7c-1-1.1-1.5-2.8-1.5-4.8c0-2,0.6-3.6,1.7-4.8c1.1-1.2,2.5-1.9,4.1-1.9
                    s2.9,0.5,3.8,1.6s1.4,2.6,1.4,4.4V13.1z M161.9,11.4c0-1.2-0.3-2.1-0.8-2.7c-0.6-0.6-1.3-1-2.3-1c-1,0-1.8,0.3-2.4,1
                    c-0.7,0.7-1.1,1.6-1.2,2.7H161.9z"></path> </svg> </a> <div class="large-free-trial"> <a data-event="global-clicked-primarycta" class="button button-primary" id="A1" href="https://azure.microsoft.com/en-us/free/" title="Free account">Free account</a> </div> <div class="relative-container"> <ul class="menu-tools" id="old-search"> <li class="sales"> <a href="https://azure.microsoft.com/en-us/overview/sales-number/" data-event="global-clicked-saleslink" title="Sales"> Sales <span data-control="geophone">1-800-867-1389</span> </a> <span class="slider-sales-tooltip"> <span> <p>Questions about Azure? Contact our sales team.</p> <p><span data-control="geocountry" style="text-transform: capitalize;">United States</span>: <span data-control="geophone">1-800-867-1389</span><br> <span data-control="united-states-sales-phone">United States: 1-800-867-1389</span></p> <a href="https://azure.microsoft.com/en-us/overview/sales-number/" class="wa-arrowLink wa-arrowLink-blue">Find a local number or submit query form</a> </span> </span> </li> <li><a href="https://azure.microsoft.com/en-us/account/" data-event="global-clicked-myaccountlink" title="My Account">My Account</a></li> <li><a href="https://portal.azure.com/" data-event="global-clicked-portallink" title="Portal">Portal</a></li> <li class="search az_hUpdated"> <div class="wa-text-light wa-textSearch" data-control="textbox"> <input class="text-input" id="MainSearchBox" placeholder="Search" onkeypress="return checkForEnterKey(event, &#39;MainSearchBox&#39;);"> <button type="button" id="header-search-button" class="search-button" title="Search" onclick="doSearch(&#39;MainSearchBox&#39;); return false;"></button> </div> </li> </ul> </div> <ul class="menu-tools" id="modern-search"> <li class="search az_hUpdated"> <div class="wa-text wa-text-light wa-textSearch" data-control="textbox"> <input class="text-input" id="ModernMainSearchBox" placeholder="Search" onkeypress="return checkForEnterKey(event, &#39;ModernMainSearchBox&#39;);"> <button type="button" id="header-search-button" class="search-button" title="Search" onclick="doSearch(&#39;ModernMainSearchBox&#39;); return false;"></button> <button type="button" id="header-search-button-expand" class="search-button" title="Search" onclick="expandSearch(&#39;ModernMainSearchBox&#39;)"></button> </div> </li> <li class="sales"> <a href="https://azure.microsoft.com/en-us/overview/sales-number/" title="Sales"> Sales <span data-control="geophone">1-800-867-1389</span> </a> <span class="slider-sales-tooltip"> <span> <p>Questions about Azure? Contact our sales team.</p> <p><span data-control="geocountry" style="text-transform: capitalize;">United States</span>: <span data-control="geophone">1-800-867-1389</span><br> <span data-control="united-states-sales-phone">United States: 1-800-867-1389</span></p> <a href="https://azure.microsoft.com/en-us/overview/sales-number/" class="wa-arrowLink wa-arrowLink-blue">Find a local number or submit query form</a> </span> </span> </li> <li><a href="https://azure.microsoft.com/en-us/account/" title="My Account">My Account</a></li> <li><a href="https://portal.azure.com/" title="Portal">Portal</a></li> </ul> <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" class="small-hamburger"> <span class="icon-hamburger"></span> </a> <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" class="small-search"> <span class="icon icon-search"><svg style="display:none; visibility:hidden;"><defs><symbol id="magnifying-glass" viewBox="0 0 16 16"> <path fill="#FFFFFF" d="M1.8,16c-0.5,0-0.9-0.2-1.2-0.5C0.2,15.2,0,14.7,0,14.3c0-0.5,0.2-0.9,0.5-1.2l4.2-4.2C4,7.5,3.8,6,4.2,4.6 C4.8,1.9,7.2,0,10,0c0.5,0,1,0.1,1.4,0.2c1.6,0.4,2.9,1.4,3.7,2.7s1,3,0.7,4.6c-0.6,2.7-3,4.6-5.8,4.6c-0.5,0-1-0.1-1.4-0.2 c-0.5-0.2-1-0.3-1.4-0.6L3,15.4C2.6,15.8,2.2,16,1.8,16 M10,2.2c-1.8,0-3.2,1.2-3.6,2.9c-0.2,1-0.1,2.1,0.6,3c0.2,0.4,0.6,0.7,1,1 c0.4,0.2,0.8,0.5,1.2,0.6C9.5,9.7,9.7,9.7,10,9.7c1.8,0,3.2-1.2,3.6-2.9c0.2-1,0.1-2-0.4-2.8c-0.6-0.8-1.4-1.4-2.3-1.6 C10.6,2.3,10.3,2.2,10,2.2"></path> </symbol> </defs></svg><svg><use xlink:href="#magnifying-glass"></use></svg></span> </a> <ul class="menu"> <li> <a data-event="global-clicked-topnav" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="Why Azure">Why Azure</a> <div> <ul class="menu-drop menu-drop-why-azure"> <li> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/overview/what-is-azure/" title="What is Azure" class="label">What is Azure</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/overview/what-is-azure/" title="What is Azure" class="sub">Learn the basics about Microsoft's cloud platform</a> </li> <li> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/support/trust-center/" title="Cloud you can trust" class="label">Cloud you can trust</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/support/trust-center/" title="Cloud you can trust" class="sub">Learn about security, privacy, transparency, and disaster recovery</a> </li> <li> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/support/trust-center/compliance/" title="Compliance and certifications" class="label">Compliance and certifications</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/support/trust-center/compliance/" title="Compliance and certifications" class="sub">Learn about independently verified compliance certifications</a> </li> <li> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/case-studies/" title="Case studies" class="label">Case studies</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/case-studies/" title="Case studies" class="sub">People are doing amazing things with Azure, hear their stories</a> </li> <li> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/overview/azure-vs-aws/" title="Azure vs. AWS" class="label">Azure vs. AWS</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/overview/azure-vs-aws/" title="Azure vs. AWS" class="sub">Which public cloud is right for you?</a> </li> <li> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/overview/business-apps-on-azure/" title="Azure for your business applications" class="label">Azure for your business applications</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/overview/business-apps-on-azure/" title="Azure for your business applications" class="sub">Learn about the benefits of running your business apps on Microsoft’s cloud platform</a> </li> <li> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/overview/webinars/" title="Webinars" class="label">Webinars</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/overview/webinars/" title="Webinars" class="sub">Watch live online presentations about the latest features</a> </li> <li> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/get-started/" title="Get started" class="label">Get started</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/get-started/" title="Get started" class="sub">Learn how to get started quickly with Azure</a> </li> </ul> <div class="free-trial free-trial-why-azure"> <div> <span class="icon icon-size13"><svg style="display:none; visibility:hidden;"><defs><symbol id="azure" viewBox="-1 -1 34 34"> <path d="M19,17.4c-0.8,0-1.5,0.5-1.9,1.2H5.3v0c-2,0-3.6-1.6-3.6-3.6s1.6-3.6,3.6-3.6v0h0h0H7 c0.1-0.4,0.2-0.8,0.4-1.2C7.4,10,7.5,9.8,7.5,9.7c0.8-1.5,2.4-2.4,4.2-2.4c1.6,0,3,0.8,3.9,2c0.5-0.2,1-0.4,1.6-0.5 c-1.1-1.8-3.2-3.1-5.5-3.1c-2.7,0-5,1.7-6,4.1c0,0,0,0,0,0l0,0c0,0,0,0,0,0H5.3C2.4,9.7,0,12.1,0,15c0,2.9,2.4,5.3,5.3,5.3h11.9 c0.3,0.7,1,1.2,1.9,1.2c1.1,0,2-0.9,2-2C21.1,18.3,20.2,17.4,19,17.4z"></path> <path d="M25.6,13.4C24.4,11,21.9,9.3,19,9.3c-3.5,0-6.4,2.4-7.1,5.7c-1.7,0.2-3.2,1.1-4.1,2.4h8.7 c0.6-0.7,1.5-1.2,2.5-1.2c1.8,0,3.2,1.5,3.2,3.2c0,1.8-1.5,3.2-3.2,3.2c-1,0-1.9-0.5-2.5-1.2H6.9c0.4,2.8,2.8,4.9,5.6,4.9 c0,0,0,0,0,0v0h13v0c0,0,0,0,0,0c3.6,0,6.5-2.9,6.5-6.5C32,16.3,29.1,13.4,25.6,13.4z"></path> </symbol> </defs></svg><svg><use xlink:href="#azure"></use></svg></span> <p>Sign up for free and get <span class="price-data " data-amount="{&quot;currencies&quot;:{&quot;USD&quot;:200.0,&quot;ARS&quot;:2800.0,&quot;AUD&quot;:260.0,&quot;BRL&quot;:750.0,&quot;CAD&quot;:250.0,&quot;CHF&quot;:190.0,&quot;DKK&quot;:1300.0,&quot;EUR&quot;:170.0,&quot;GBP&quot;:125.0,&quot;HKD&quot;:1600.0,&quot;IDR&quot;:2940000.0,&quot;INR&quot;:12100.0,&quot;JPY&quot;:20500.0,&quot;KRW&quot;:240000.0,&quot;MXN&quot;:3600.0,&quot;MYR&quot;:900.0,&quot;NOK&quot;:1650.0,&quot;NZD&quot;:300.0,&quot;RUB&quot;:12500.0,&quot;SAR&quot;:750.0,&quot;SEK&quot;:1600.0,&quot;TRY&quot;:610.0,&quot;TWD&quot;:6300.0,&quot;ZAR&quot;:3450.0}}" data-decimals="0">$200</span> to spend on all Azure services</p> <a href="https://azure.microsoft.com/en-us/free/" title="Learn more" class="wa-arrowLink wa-arrowLink-light" data-event="global-clicked-menumessage" data-event-property="Why Azure">Learn more</a> </div> </div> </div> </li> <li><a data-event="global-clicked-topnav" href="https://azure.microsoft.com/en-us/solutions/" title="Solutions">Solutions</a></li> <li> <a data-event="global-clicked-topnav" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="Products">Products</a> <div> <ul class="menu-drop menu-drop-features"> <li> <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="Compute">Compute</a> <ul class="menu-pop" id="Compute-category"> <li class="title">Compute</li> <li data-product-slug="virtual-machines"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/virtual-machines/" title="Virtual Machines" class="label">Virtual Machines</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/virtual-machines/" title="Virtual Machines" class="sub">Provision Windows and Linux virtual machines in minutes</a> </li> <li data-product-slug="virtual-machine-scale-sets"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/virtual-machine-scale-sets/" title="Virtual Machine Scale Sets" class="label">Virtual Machine Scale Sets</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/virtual-machine-scale-sets/" title="Virtual Machine Scale Sets" class="sub">Manage and scale 10s to 1000s of Linux and Windows VMs</a> </li> <li data-product-slug="app-service"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/app-service/" title="App Service" class="label">App Service</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/app-service/" title="App Service" class="sub">Create web and mobile apps for any platform and any device</a> </li> <li data-product-slug="container-service"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/container-service/" title="Azure Container Service" class="label">Azure Container Service</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/container-service/" title="Azure Container Service" class="sub">Use Docker based tools to deploy and manage containers</a> </li> <li data-product-slug="container-registry"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/container-registry/" title="Azure Container Registry" class="label">Azure Container Registry</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/container-registry/" title="Azure Container Registry" class="sub">Store images for container deployments—Docker Swarm, DC/OS, and more</a> </li> <li data-product-slug="functions"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/functions/" title="Functions" class="label">Functions</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/functions/" title="Functions" class="sub">Process events with serverless code</a> </li> <li data-product-slug="batch"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/batch/" title="Batch" class="label">Batch</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/batch/" title="Batch" class="sub">Run large-scale parallel and batch compute jobs</a> </li> <li data-product-slug="service-fabric"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/service-fabric/" title="Service Fabric" class="label">Service Fabric</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/service-fabric/" title="Service Fabric" class="sub">Build and operate always-on, scalable, distributed applications</a> </li> <li data-product-slug="cloud-services"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/cloud-services/" title="Cloud Services" class="label">Cloud Services</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/cloud-services/" title="Cloud Services" class="sub">Create highly available, infinitely scalable cloud applications and APIs</a> </li> </ul> <div class="free-trial"> <div> <p>Get credits that enable:</p> <p>4 Windows or Linux Virtual Machines</p> <p>24 x 7 for a month</p> <p>And much more...</p> <a href="https://azure.microsoft.com/en-us/free/" title="Learn more" class="wa-arrowLink wa-arrowLink-light" data-event="global-clicked-menumessage" data-event-property="Products (Compute)">Learn more</a> <span class="icon icon-size17"><svg style="display:none; visibility:hidden;"><defs><symbol id="virtual-machines" viewBox="0 0 51 47"> <path fill="#7A7A7A" d="M32.9,36.9h-1.2H19.9h-0.6c1.6,5.7-0.6,6.6-10.2,6.6v3h12.2h8.9h11.5v-3 C32.2,43.5,31.3,42.7,32.9,36.9z"></path> <path fill="#3E3E3E" d="M47.5,0.5H3.2c-1.5,0-2.7,1.3-2.7,2.8v30.8c0,1.5,1.2,2.8,2.7,2.8h44.3c1.5,0,3-1.3,3-2.8V3.3 C50.5,1.8,49,0.5,47.5,0.5z M46.7,4.3v28.7H4.3V4.3l42.4-0.1L46.7,4.3z"></path> <polygon fill="#00BBF1" points="46.6,4.3 46.6,33.1 4.3,33.1 4.3,4.3 46.7,4.3"></polygon> <path fill="#7A7A7A" d="M4.3,33.1L4.3,33.1L4.3,4.3L43,4.3l4.5-3.8c0,0,0,0,0,0H3.2c-1.5,0-2.7,1.3-2.7,2.8v30.8 c0,1.5,1.2,2.8,2.7,2.8h1.1l4.6-3.8H4.3z"></path> <polygon fill="#59B4D9" points="4.3,33.1 4.3,33.1 4.3,4.3 43,4.3 43,4.3 4.3,4.3"></polygon> <rect x="9.2" y="43.5" fill="#B0B0B0" width="32.7" height="3"></rect> <circle fill="#BAC84A" cx="25.3" cy="2.6" r="0.7"></circle> <path opacity="0.9" fill="#FFFFFF" d="M25.5,18.2c0,0-0.1,0-0.1,0l-8.8-5.1c-0.1,0-0.1-0.1-0.1-0.2c0-0.1,0.1-0.2,0.1-0.2l8.7-5 c0.1,0,0.2,0,0.3,0l8.8,5.1c0.1,0,0.1,0.1,0.1,0.2c0,0.1,0,0.2-0.1,0.2l-8.7,5C25.6,18.2,25.5,18.2,25.5,18.2z"></path> <g opacity="0.8"> <path fill="#FFFFFF" d="M24.2,30.5c0,0-0.1,0-0.1,0l-8.8-5c-0.1,0-0.1-0.1-0.1-0.2V15.1c0-0.1,0-0.2,0.1-0.2 c0.1,0,0.2,0,0.3,0l8.8,5c0.1,0,0.1,0.1,0.1,0.2v10.1c0,0.1-0.1,0.2-0.1,0.2C24.3,30.5,24.3,30.5,24.2,30.5z"></path> </g> <path opacity="0.5" fill="#FFFFFF" d="M26.7,30.5c0,0-0.1,0-0.1,0c-0.1,0-0.1-0.1-0.1-0.2V20.2c0-0.1,0.1-0.2,0.1-0.2l8.8-5 c0.1,0,0.2,0,0.3,0c0.1,0,0.1,0.1,0.1,0.2v10.1c0,0.1-0.1,0.2-0.1,0.2l-8.8,5C26.8,30.5,26.7,30.5,26.7,30.5z"></path> </symbol> </defs></svg><svg><use xlink:href="#virtual-machines"></use></svg></span> </div> </div> </li> <li> <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="Networking">Networking</a> <ul class="menu-pop" id="Networking-category"> <li class="title">Networking</li> <li data-product-slug="virtual-network"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/virtual-network/" title="Virtual Network" class="label">Virtual Network</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/virtual-network/" title="Virtual Network" class="sub">Provision private networks, optionally connect to on-premises datacenters</a> </li> <li data-product-slug="load-balancer"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/load-balancer/" title="Load Balancer" class="label">Load Balancer</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/load-balancer/" title="Load Balancer" class="sub">Deliver high availability and network performance to your applications</a> </li> <li data-product-slug="application-gateway"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/application-gateway/" title="Application Gateway" class="label">Application Gateway</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/application-gateway/" title="Application Gateway" class="sub">Layer 7 Load Balancer with built-in HTTP load balancing and delivery control</a> </li> <li data-product-slug="vpn-gateway"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/vpn-gateway/" title="VPN Gateway" class="label">VPN Gateway</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/vpn-gateway/" title="VPN Gateway" class="sub">Establish secure, cross-premises connectivity</a> </li> <li data-product-slug="dns"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/dns/" title="Azure DNS" class="label">Azure DNS</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/dns/" title="Azure DNS" class="sub">Host your DNS domain in Azure</a> </li> <li data-product-slug="cdn"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/cdn/" title="CDN" class="label">CDN</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/cdn/" title="CDN" class="sub">Deliver content to end-users through a robust network of global data centers</a> </li> <li data-product-slug="traffic-manager"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/traffic-manager/" title="Traffic Manager" class="label">Traffic Manager</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/traffic-manager/" title="Traffic Manager" class="sub">Route incoming traffic for high performance and availability</a> </li> <li data-product-slug="expressroute"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/expressroute/" title="ExpressRoute" class="label">ExpressRoute</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/expressroute/" title="ExpressRoute" class="sub">Dedicated private network fiber connections to Azure</a> </li> </ul> <div class="free-trial"> <div> <p>Connect Virtual Machines with Virtual Network for free.</p> <a href="https://azure.microsoft.com/en-us/free/" title="Learn more" class="wa-arrowLink wa-arrowLink-light" data-event="global-clicked-menumessage" data-event-property="Products (Networking)">Learn more</a> <span class="icon icon-size17"><svg style="display:none; visibility:hidden;"><defs><symbol id="virtual-network" viewBox="0 0 50 50"> <path fill="#3999C6" d="M49.7,25.7c0.5-0.5,0.4-1.3,0-1.8l-2.4-2.4L36.5,11c-0.5-0.5-1.2-0.5-1.7,0l0,0c-0.5,0.5-0.6,1.3,0,1.8 l11.3,11.1c0.5,0.5,0.5,1.3,0,1.8L34.6,37.2c-0.5,0.5-0.5,1.3,0,1.8l0,0c0.5,0.5,1.3,0.4,1.7,0l10.7-10.6c0,0,0,0,0.1-0.1L49.7,25.7 z"></path> <path fill="#3999C6" d="M0.3,25.7c-0.5-0.5-0.4-1.3,0-1.8l2.4-2.4L13.5,11c0.5-0.5,1.2-0.5,1.7,0l0,0c0.5,0.5,0.6,1.3,0,1.8 L4.1,23.9c-0.5,0.5-0.5,1.3,0,1.8l11.3,11.5c0.5,0.5,0.5,1.3,0,1.8l0,0c-0.5,0.5-1.3,0.4-1.7,0L2.8,28.5c0,0,0,0-0.1-0.1L0.3,25.7z"></path> <path fill="#7FBA00" d="M18.2,24.8c0,1.9-1.6,3.3-3.3,3.3s-3.5-1.6-3.5-3.3s1.4-3.3,3.5-3.3C16.9,21.5,18.2,23.1,18.2,24.8z"></path> <path fill="#7FBA00" d="M28.3,24.8c0,1.9-1.6,3.3-3.3,3.3s-3.5-1.6-3.5-3.3s1.6-3.3,3.5-3.3S28.3,23.1,28.3,24.8z"></path> <circle fill="#7FBA00" cx="35.2" cy="24.8" r="3.3"></circle> </symbol> </defs></svg><svg><use xlink:href="#virtual-network"></use></svg></span> </div> </div> </li> <li> <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="Storage">Storage</a> <ul class="menu-pop" id="Storage-category"> <li class="title">Storage</li> <li data-product-slug="storage"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/storage/" title="Storage" class="label">Storage</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/storage/" title="Storage" class="sub">Durable, highly available, and massively scalable cloud storage</a> </li> <li class="indent" data-product-slug="blob-storage"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/storage/blobs/" title="Blob Storage" class="label">Blob Storage</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/storage/blobs/" title="Blob Storage" class="sub">REST-based object storage for unstructured data</a> </li> <li class="indent" data-product-slug="storage\queues"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/storage/queues/" title="Queue Storage" class="label">Queue Storage</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/storage/queues/" title="Queue Storage" class="sub">Effectively scale apps according to traffic</a> </li> <li class="indent" data-product-slug="storage\files"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/storage/files/" title="File Storage" class="label">File Storage</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/storage/files/" title="File Storage" class="sub">File shares that use the standard SMB 3.0 protocol</a> </li> <li class="indent" data-product-slug="premium-storage"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/storage/disks/" title="Disk Storage" class="label">Disk Storage</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/storage/disks/" title="Disk Storage" class="sub">Persistent, secured disk options supporting virtual machines</a> </li> <li data-product-slug="data-lake-store"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/data-lake-store/" title="Data Lake Store" class="label">Data Lake Store</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/data-lake-store/" title="Data Lake Store" class="sub">Hyperscale repository for big data analytics workloads</a> </li> <li data-product-slug="storsimple"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/storsimple/" title="StorSimple" class="label">StorSimple</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/storsimple/" title="StorSimple" class="sub">Hybrid cloud storage for enterprises, reduces costs and improves data security</a> </li> <li data-product-slug="backup"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/backup/" title="Backup" class="label">Backup</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/backup/" title="Backup" class="sub">Simple and reliable server backup to the cloud</a> </li> <li data-product-slug="site-recovery"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/site-recovery/" title="Site Recovery" class="label">Site Recovery</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/site-recovery/" title="Site Recovery" class="sub">Orchestrate protection and recovery of private clouds</a> </li> </ul> <div class="free-trial"> <div> <p>Get credits that enable:</p> <p>8 standard SQL Databases</p> <p>Hadoop instance for a week</p> <p>And much more...</p> <a href="https://azure.microsoft.com/en-us/free/" title="Learn more" class="wa-arrowLink wa-arrowLink-light" data-event="global-clicked-menumessage" data-event-property="Products (Data &amp; Storage)">Learn more</a> <span class="icon icon-size17"><svg style="display:none; visibility:hidden;"><defs><symbol id="storage" viewBox="0 0 50 50"> <path fill="#A0A1A2" d="M0,44.4c0,1,0.7,1.9,1.9,1.9h46.2c1,0,1.9-0.7,1.9-1.9V11.3H0V44.4z"></path> <path fill="#7A7A7A" d="M48.1,3.7H1.9C0.7,3.7,0,4.6,0,5.6v5.7h50V5.6C50,4.6,49.3,3.7,48.1,3.7"></path> <rect x="18.8" y="14.6" fill="#FFFFFF" width="12.6" height="7.6"></rect> <rect x="18.8" y="24.9" fill="#FCD116" width="12.6" height="7.6"></rect> <rect x="33.8" y="24.9" fill="#FCD116" width="12.6" height="7.6"></rect> <rect x="33.8" y="14.6" fill="#FFFFFF" width="12.6" height="7.6"></rect> <rect x="3.8" y="14.6" fill="#FFFFFF" width="12.6" height="7.6"></rect> <rect x="3.8" y="24.9" fill="#FFFFFF" width="12.6" height="7.6"></rect> <rect x="3.8" y="35.1" fill="#FCD116" width="12.6" height="7.6"></rect> <rect x="18.8" y="35.1" fill="#FCD116" width="12.6" height="7.6"></rect> <rect x="33.8" y="35.1" fill="#FCD116" width="12.6" height="7.6"></rect> <path opacity="0.2" fill="#FFFFFF" enable-background="new    " d="M1.9,3.7C1,3.7,0,4.6,0,5.6V13v3.3v28.1c0,1,1,1.9,1.9,1.9H4 	L43.6,3.7H1.9z"></path> </symbol> </defs></svg><svg><use xlink:href="#storage"></use></svg></span> </div> </div> </li> <li> <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="Web + Mobile">Web + Mobile</a> <ul class="menu-pop" id="WebMobile-category"> <li class="title">Web + Mobile</li> <li data-product-slug="app-service"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/app-service/" title="App Service" class="label">App Service</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/app-service/" title="App Service" class="sub">Create web and mobile apps for any platform and any device</a> </li> <li class="indent" data-product-slug="app-service\web"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/app-service/web/" title="Web Apps" class="label">Web Apps</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/app-service/web/" title="Web Apps" class="sub">Quickly create and deploy mission critical Web apps at scale</a> </li> <li class="indent" data-product-slug="app-service\mobile"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/app-service/mobile/" title="Mobile Apps" class="label">Mobile Apps</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/app-service/mobile/" title="Mobile Apps" class="sub">Build and host the backend for any mobile app</a> </li> <li class="indent" data-product-slug="logic-apps"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/logic-apps/" title="Logic Apps" class="label">Logic Apps</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/logic-apps/" title="Logic Apps" class="sub">Automate the access and use of data across clouds without writing code</a> </li> <li class="indent" data-product-slug="app-service\api"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/app-service/api/" title="API Apps" class="label">API Apps</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/app-service/api/" title="API Apps" class="sub">Easily build and consume Cloud APIs</a> </li> <li data-product-slug="cdn"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/cdn/" title="CDN" class="label">CDN</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/cdn/" title="CDN" class="sub">Deliver content to end-users through a robust network of global data centers</a> </li> <li data-product-slug="media-services"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/media-services/" title="Media Services" class="label">Media Services</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/media-services/" title="Media Services" class="sub">Encode, store, and stream video and audio at scale</a> </li> <li data-product-slug="search"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/search/" title="Search" class="label">Search</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/search/" title="Search" class="sub">Fully-managed search-as-a-service</a> </li> <li class="link-bottom"> <a class="label" href="https://azure.microsoft.com/en-us/services/?filter=web-mobile">See all web + mobile</a> </li> </ul> <div class="free-trial"> <div> <p>Get credits that enable:</p> <p>Deploy 20 websites</p> <p>over 10M mobile API calls</p> <p>And much more...</p> <a href="https://azure.microsoft.com/en-us/free/" title="Learn more" class="wa-arrowLink wa-arrowLink-light" data-event="global-clicked-menumessage" data-event-property="Products (Web &amp; Mobile)">Learn more</a> <span class="icon icon-size17"><svg style="display:none; visibility:hidden;"><defs><symbol id="app-service" viewBox="0 0 50 50"> <path fill="#A0A1A2" d="M20.1,46.5H3.5V30h3.4c-0.4-1-0.6-2.1-0.6-3.3c0,0,0-0.1,0-0.2H0V50h23.6V36h-3.5V46.5z"></path> <path fill="#A0A1A2" d="M43.5,30h3v16.6H29.9V36.1h-3.5V50H50V26.5h-7.4c0.5,1,0.9,2,0.9,3.3C43.5,29.8,43.5,29.9,43.5,30z"></path> <path fill="#A0A1A2" d="M3.5,20V3.5h16.6v9.6c1-0.8,2.3-1.3,3.5-1.6V0H0v23.5h6.8C7.3,22.3,8,21,9,20.1L3.5,20L3.5,20z"></path> <path fill="#A0A1A2" d="M29.9,11.1V3.5h16.6v16.6h-7.3c0.3,1,0.5,2.2,0.5,3.4c0,0,0,0.1,0,0.1H50V0H26.4v10.9c0.3,0,0.5-0.1,0.8-0.1 C28.1,10.9,29,10.9,29.9,11.1z"></path> <path fill="#59B4D9" d="M40.8,29.7c0-2.1-1.7-3.7-3.7-3.7c-0.2,0-0.3,0-0.5,0c0.2-0.8,0.4-1.7,0.4-2.6c0-5.5-4.4-9.9-9.9-9.9 c-4.3,0-8,2.8-9.3,6.8c-0.7-0.2-1.4-0.4-2.2-0.4c-3.7,0-6.7,3-6.7,6.8c0,3.8,3,6.8,6.7,6.8c0,0,0,0,0,0v0h21.8l0,0 C39.3,33.3,40.8,31.7,40.8,29.7"></path> <path opacity="0.2" fill="#FFFFFF" d="M19.2,33.5c-0.9-0.9-1.5-2-1.8-3.3c-0.8-3.7,1.4-7.3,5.1-8.1c0.8-0.2,1.5-0.2,2.2-0.1 c0.3-3.4,2.4-6.5,5.5-8c-0.9-0.3-1.9-0.5-3-0.5c-4.3,0-8,2.8-9.3,6.8c-0.7-0.2-1.4-0.4-2.2-0.4c-3.7,0-6.7,3-6.7,6.8 c0,3.8,3,6.8,6.7,6.8c0,0,0,0,0,0v0H19.2z"></path> </symbol> </defs></svg><svg><use xlink:href="#app-service"></use></svg></span> </div> </div> </li> <li> <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="Databases">Databases</a> <ul class="menu-pop" id="Databases-category"> <li class="title">Databases</li> <li data-product-slug="sql-database"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/sql-database/" title="SQL Database" class="label">SQL Database</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/sql-database/" title="SQL Database" class="sub">Managed relational SQL Database-as-a-service</a> </li> <li data-product-slug="sql-data-warehouse"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/sql-data-warehouse/" title="SQL Data Warehouse" class="label">SQL Data Warehouse</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/sql-data-warehouse/" title="SQL Data Warehouse" class="sub">Elastic data warehouse-as-a-service with enterprise-class features</a> </li> <li data-product-slug="sql-server-stretch-database"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/sql-server-stretch-database/" title="SQL Server Stretch Database" class="label">SQL Server Stretch Database</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/sql-server-stretch-database/" title="SQL Server Stretch Database" class="sub">Dynamically stretch on-premises SQL Server databases to Azure</a> </li> <li data-product-slug="documentdb"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/documentdb/" title="DocumentDB" class="label">DocumentDB</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/documentdb/" title="DocumentDB" class="sub">Managed NoSQL document database-as-a-service</a> </li> <li data-product-slug="storage\tables"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/storage/tables/" title="Table Storage" class="label">Table Storage</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/storage/tables/" title="Table Storage" class="sub">NoSQL key-value store using semi-structured datasets</a> </li> <li data-product-slug="redis-cache"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/cache/" title="Redis Cache" class="label">Redis Cache</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/cache/" title="Redis Cache" class="sub">High throughput, low latency data access to build fast and scalable applications</a> </li> <li data-product-slug="data-factory"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/data-factory/" title="Data Factory" class="label">Data Factory</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/data-factory/" title="Data Factory" class="sub">Orchestrate and manage data transformation and movement</a> </li> </ul> <div class="free-trial"> <div> <p>Get credits that enable:</p> <p>8 standard SQL Databases</p> <p>Hadoop instance for a week</p> <p>And much more...</p> <a href="https://azure.microsoft.com/en-us/free/" title="Learn more" class="wa-arrowLink wa-arrowLink-light" data-event="global-clicked-menumessage" data-event-property="Products (Data &amp; Storage)">Learn more</a> <span class="icon icon-size17"><svg><use xlink:href="#storage"></use></svg></span> </div> </div> </li> <li> <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="Intelligence + Analytics">Intelligence + Analytics</a> <ul class="menu-pop" id="IntelligenceAnalytics-category"> <li class="title">Intelligence + Analytics</li> <li data-product-slug="hdinsight"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/hdinsight/" title="HDInsight" class="label">HDInsight</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/hdinsight/" title="HDInsight" class="sub">Provision cloud Hadoop, Spark, R Server, HBase, and Storm clusters</a> </li> <li data-product-slug="machine-learning"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/machine-learning/" title="Machine Learning" class="label">Machine Learning</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/machine-learning/" title="Machine Learning" class="sub">Powerful cloud based predictive analytics tool to enable predictive maintenance</a> </li> <li data-product-slug="stream-analytics"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/stream-analytics/" title="Stream Analytics" class="label">Stream Analytics</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/stream-analytics/" title="Stream Analytics" class="sub">Real-time data stream processing from millions of IoT devices</a> </li> <li data-product-slug="cognitive-services"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/cognitive-services/" title="Cognitive Services" class="label">Cognitive Services</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/cognitive-services/" title="Cognitive Services" class="sub">Add smart API capabilities to enable contextual interactions</a> </li> <li data-product-slug="bot-service"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/bot-service/" title="Azure Bot Service" class="label">Azure Bot Service</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/bot-service/" title="Azure Bot Service" class="sub">Intelligent, serverless bot service that scales on demand</a> </li> <li data-product-slug="data-lake-analytics"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/data-lake-analytics/" title="Data Lake Analytics" class="label">Data Lake Analytics</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/data-lake-analytics/" title="Data Lake Analytics" class="sub">Distributed analytics service that makes big data easy</a> </li> <li data-product-slug="data-lake-store"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/data-lake-store/" title="Data Lake Store" class="label">Data Lake Store</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/data-lake-store/" title="Data Lake Store" class="sub">Hyperscale repository for big data analytics workloads</a> </li> <li data-product-slug="power-bi-embedded"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/power-bi-embedded/" title="Power BI Embedded" class="label">Power BI Embedded</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/power-bi-embedded/" title="Power BI Embedded" class="sub">Embed fully interactive, stunning data visualizations in your applications</a> </li> <li class="link-bottom"> <a class="label" href="https://azure.microsoft.com/en-us/services/?filter=intelligence-analytics">See all intelligence + analytics</a> </li> </ul> <div class="free-trial"> <div> <p>Cortana Intelligence</p> <p>Learn how to transform your business with big data and advanced analytics</p> <a href="https://azure.microsoft.com/en-us/suites/cortana-intelligence-suite/" title="Learn more" class="wa-arrowLink wa-arrowLink-light" data-event="global-clicked-menumessage" data-event-property="Products (Intelligence + Analytics)">Learn more</a> <span class="icon icon-size17"><svg><use xlink:href="#storage"></use></svg></span> </div> </div> </li> <li> <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="Internet of Things">Internet of Things</a> <ul class="menu-pop" id="InternetOfThings-category"> <li class="title">Internet of Things</li> <li data-product-slug="iot-hub"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/iot-hub/" title="Azure IoT Hub" class="label">Azure IoT Hub</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/iot-hub/" title="Azure IoT Hub" class="sub">Connect, monitor, and control billions of IoT assets</a> </li> <li data-product-slug="event-hubs"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/event-hubs/" title="Event Hubs" class="label">Event Hubs</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/event-hubs/" title="Event Hubs" class="sub">Receive telemetry from millions of devices</a> </li> <li data-product-slug="stream-analytics"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/stream-analytics/" title="Stream Analytics" class="label">Stream Analytics</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/stream-analytics/" title="Stream Analytics" class="sub">Real-time data stream processing from millions of IoT devices</a> </li> <li data-product-slug="machine-learning"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/machine-learning/" title="Machine Learning" class="label">Machine Learning</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/machine-learning/" title="Machine Learning" class="sub">Powerful cloud based predictive analytics tool to enable predictive maintenance</a> </li> <li data-product-slug="notification-hubs"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/notification-hubs/" title="Notification Hubs" class="label">Notification Hubs</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/notification-hubs/" title="Notification Hubs" class="sub">A scalable, push notification engine for quickly sending millions of messages</a> </li> </ul> <div class="free-trial"> <div> <p>Azure IoT Suite</p> <p>Capture and analyze untapped data to improve business results</p> <a href="https://azure.microsoft.com/en-us/suites/iot-suite/" title="Learn more" class="wa-arrowLink wa-arrowLink-light" data-event="global-clicked-menumessage" data-event-property="Products (IoT)">Learn more</a> <span class="icon icon-size17"><svg style="display:none; visibility:hidden;"><defs><symbol id="machine-learning" viewBox="0 0 50 50"> <path fill="#59B4D9" d="M48.288,44.623L32.72,17.659V6.743h0.281c1.862,0,3.372-1.51,3.372-3.372S34.863,0,33.001,0H16.016 c-1.862,0-3.372,1.51-3.372,3.372s1.51,3.372,3.372,3.372h0.281v10.915L0.729,44.623C-0.979,47.58,0.418,50,3.833,50h41.351 C48.598,50,49.995,47.58,48.288,44.623z"></path> <polygon fill="#B8D432" points="13.551,33.017 7.127,44.143 41.889,44.143 35.466,33.017 "></polygon> <path fill="#7FBA00" d="M25.334,37.532c1.735,0,3.141-1.406,3.141-3.141c0-0.493-0.117-0.958-0.32-1.374h-5.643 c-0.203,0.415-0.32,0.88-0.32,1.374C22.193,36.126,23.599,37.532,25.334,37.532z"></path> <circle fill="#7FBA00" cx="29.232" cy="39.956" r="1.541"></circle> <path opacity="0.25" fill="#FFFFFF" d="M0.729,44.623l15.568-26.965V6.743h-0.281c-1.862,0-3.372-1.51-3.372-3.372 S14.153,0,16.016,0l7.319,0v17.572L15.13,50H3.833C0.418,50-0.979,47.58,0.729,44.623z"></path> </symbol> </defs></svg><svg><use xlink:href="#machine-learning"></use></svg></span> </div> </div> </li> <li> <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="Enterprise Integration">Enterprise Integration</a> <ul class="menu-pop" id="EnterpriseIntegration-category"> <li class="title">Enterprise Integration</li> <li data-product-slug="logic-apps"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/logic-apps/" title="Logic Apps" class="label">Logic Apps</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/logic-apps/" title="Logic Apps" class="sub">Automate the access and use of data across clouds without writing code</a> </li> <li data-product-slug="biztalk-services"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/biztalk-services/" title="BizTalk Services" class="label">BizTalk Services</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/biztalk-services/" title="BizTalk Services" class="sub">Seamlessly integrate the enterprise and the cloud</a> </li> <li data-product-slug="service-bus"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/service-bus/" title="Service Bus" class="label">Service Bus</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/service-bus/" title="Service Bus" class="sub">Connect across private and public cloud environments</a> </li> <li data-product-slug="api-management"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/api-management/" title="API Management" class="label">API Management</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/api-management/" title="API Management" class="sub">Publish APIs to developers, partners and employees securely and at scale</a> </li> <li data-product-slug="storsimple"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/storsimple/" title="StorSimple" class="label">StorSimple</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/storsimple/" title="StorSimple" class="sub">Hybrid cloud storage for enterprises, reduces costs and improves data security</a> </li> <li data-product-slug="sql-server-stretch-database"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/sql-server-stretch-database/" title="SQL Server Stretch Database" class="label">SQL Server Stretch Database</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/sql-server-stretch-database/" title="SQL Server Stretch Database" class="sub">Dynamically stretch on-premises SQL Server databases to Azure</a> </li> <li data-product-slug="data-factory"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/data-factory/" title="Data Factory" class="label">Data Factory</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/data-factory/" title="Data Factory" class="sub">Orchestrate and manage data transformation and movement</a> </li> </ul> <div class="free-trial"> <div> <p>Get credits that enable:</p> <p>Send 200 million messages</p> <p>And much more...</p> <a href="https://azure.microsoft.com/en-us/free/" title="Learn more" class="wa-arrowLink wa-arrowLink-light" data-event="global-clicked-menumessage" data-event-property="Products (Enterprise Integration)">Learn more</a> <span class="icon icon-size17"><svg style="display:none; visibility:hidden;"><defs><symbol id="app-service-logic" viewBox="0 0 50 38.8"> <path d="M26,21.3v-5H23.5v5c0,.9-.8,1.7-2.1,2.1l-3.4.7c-2.3.7-3.9,2.5-3.9,4.5v5.7h2.5V28.6c0-.9.8-1.7,2.1-2.1l3.4-.8A4.833,4.833,0,0,0,26,21.3Z" transform="translate(0 -5.6)" fill="#59b4d9"></path> <path d="M19.6,36.9V32.3a2.006,2.006,0,0,0-2-2H13a2.006,2.006,0,0,0-2,2v4.6a2.006,2.006,0,0,0,2,2h4.6A2.006,2.006,0,0,0,19.6,36.9Z" transform="translate(0 -5.6)" fill="#7fba00"></path> <path d="M23.2,21.3v-5h2.5v5c0,.9.8,1.7,2.1,2.1l4.2.9c2.3.7,3.9,2.5,3.9,4.5v5.7H33.4V28.8c0-.9-.8-1.7-2.1-2.1l-4.2-.9C24.8,25.1,23.2,23.3,23.2,21.3Z" transform="translate(0 -5.6)" fill="#59b4d9"></path> <path d="M30.4,37.1V32.5a2.006,2.006,0,0,1,2-2H37a2.006,2.006,0,0,1,2,2v4.6a2.006,2.006,0,0,1-2,2H32.4A2.006,2.006,0,0,1,30.4,37.1Z" transform="translate(0 -5.6)" fill="#7fba00"></path> <rect x="23.2" y="10.7" width="2.8" height="4.8" fill="#59b4d9"></rect> <path d="M26.5,11.7v3.7H22.8V11.7h3.7m.8-2.8H22a2.006,2.006,0,0,0-2,2v5.3a2.006,2.006,0,0,0,2,2h5.3a2.006,2.006,0,0,0,2-2V10.9a2.006,2.006,0,0,0-2-2Z" transform="translate(0 -5.6)" fill="#0072c6"></path> <path d="M7.9,44.4a7.41,7.41,0,0,1-4.5-1.1c-.9-.8-1.3-2.1-1.3-4V28.9c0-1.7-.7-2.6-2.1-2.6V23.7q2.1,0,2.1-2.7V10.8c0-1.9.4-3.3,1.3-4.1S5.8,5.6,7.9,5.6V8.2c-1.5,0-2.3.8-2.3,2.5v10c0,2.3-.7,3.7-2.2,4.3h0c1.4.6,2.2,2,2.2,4.3v9.9a3.439,3.439,0,0,0,.5,2,2.2,2.2,0,0,0,1.7.6l.1,2.6Z" transform="translate(0 -5.6)" fill="#59b4d9"></path> <path d="M42.1,5.6a7.41,7.41,0,0,1,4.5,1.1c.9.8,1.3,2.1,1.3,4V21.1c0,1.7.7,2.6,2.1,2.6v2.6q-2.1,0-2.1,2.7V39.1c0,1.9-.4,3.3-1.3,4.1s-2.4,1.2-4.5,1.2V41.8c1.5,0,2.3-.8,2.3-2.5v-10c0-2.3.7-3.7,2.2-4.3h0c-1.4-.6-2.2-2-2.2-4.3V10.8a3.439,3.439,0,0,0-.5-2,2.2,2.2,0,0,0-1.7-.6l-.1-2.6Z" transform="translate(0 -5.6)" fill="#59b4d9"></path> </symbol></defs></svg><svg><use xlink:href="#app-service-logic"></use></svg></span> </div> </div> </li> <li> <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="Security + Identity">Security + Identity</a> <ul class="menu-pop" id="SecurityIdentity-category"> <li class="title">Security + Identity</li> <li data-product-slug="security-center"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/security-center/" title="Security Center" class="label">Security Center</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/security-center/" title="Security Center" class="sub">Prevent, detect, and respond to threats with increased visibility</a> </li> <li data-product-slug="microsoft-identity"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/develop/identity/" title="Identity for developers" class="label">Identity for developers</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/develop/identity/" title="Identity for developers" class="sub">Enable one-click sign in for hundreds of millions of users</a> </li> <li data-product-slug="key-vault"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/key-vault/" title="Key Vault" class="label">Key Vault</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/key-vault/" title="Key Vault" class="sub">Safeguard and maintain control of keys and other secrets</a> </li> <li data-product-slug="active-directory"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/active-directory/" title="Azure Active Directory" class="label">Azure Active Directory</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/active-directory/" title="Azure Active Directory" class="sub">Synchronize on-premises directories and enable single sign-on</a> </li> <li data-product-slug="active-directory-b2c"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/active-directory-b2c/" title="Azure Active Directory B2C" class="label">Azure Active Directory B2C</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/active-directory-b2c/" title="Azure Active Directory B2C" class="sub">Consumer identity and access management in the cloud</a> </li> <li data-product-slug="active-directory-ds"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/active-directory-ds/" title="Azure Active Directory Domain Services" class="label">Azure Active Directory Domain Services</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/active-directory-ds/" title="Azure Active Directory Domain Services" class="sub">Join Azure virtual machines to a domain without domain controllers</a> </li> <li data-product-slug="multi-factor-authentication"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/multi-factor-authentication/" title="Multi-Factor Authentication" class="label">Multi-Factor Authentication</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/multi-factor-authentication/" title="Multi-Factor Authentication" class="sub">Safeguard access to your data and apps with an extra level of authentication</a> </li> </ul> <div class="free-trial"> <div> <p>Get credits that enable:</p> <p>Store 500,000 objects in Active Directory</p> <p>Multi-factor auth with 100 users</p> <p>And much more...</p> <a href="https://azure.microsoft.com/en-us/free/" title="Learn more" class="wa-arrowLink wa-arrowLink-light" data-event="global-clicked-menumessage" data-event-property="Products (Identity &amp; Access Management)">Learn more</a> <span class="icon icon-size17"><svg style="display:none; visibility:hidden;"><defs><symbol id="active-directory" viewBox="0 0 50 50"> <path fill="#59B4D9" d="M25.001,50.001c-1.232,0-2.392-0.48-3.261-1.352L1.351,28.261C0.492,27.402,0,26.215,0,25 c0-1.214,0.492-2.402,1.351-3.26L21.74,1.352C22.611,0.48,23.769,0,25.001,0c1.231,0,2.39,0.48,3.261,1.352L48.648,21.74 C49.521,22.608,50,23.767,50,25c0,1.233-0.479,2.392-1.353,3.263L28.262,48.649C27.392,49.521,26.232,50.001,25.001,50.001"></path> <path fill="#FFFFFF" d="M38.614,21.093c-2.16,0-3.91,1.75-3.91,3.909c0,0.792,0.239,1.527,0.645,2.143l-7.744,7.744 c-0.206-0.144-0.427-0.264-0.656-0.373V14.759c1.167-0.676,1.961-1.924,1.961-3.37C28.91,9.23,27.16,7.48,25,7.48 c-2.158,0-3.908,1.75-3.908,3.909c0,1.446,0.794,2.694,1.96,3.37v19.756c-0.219,0.104-0.434,0.216-0.632,0.353l-7.753-7.753 c0.394-0.61,0.628-1.333,0.628-2.113c0-2.159-1.75-3.909-3.908-3.909c-2.16,0-3.91,1.75-3.91,3.909s1.75,3.909,3.91,3.909 c0.448,0,0.872-0.091,1.274-0.23l8.15,8.15c-0.234,0.548-0.364,1.15-0.364,1.783c0,2.513,2.038,4.551,4.551,4.551 c2.514,0,4.551-2.038,4.551-4.551c0-0.621-0.126-1.212-0.351-1.751l8.173-8.172c0.392,0.132,0.804,0.22,1.241,0.22 c2.158,0,3.908-1.75,3.908-3.909S40.771,21.093,38.614,21.093z"></path> <rect x="31.006" y="8.226" transform="matrix(-0.707 0.7072 -0.7072 -0.707 68.2099 8.8718)" opacity="0.5" fill="#FFFFFF" width="2.523" height="20.676"></rect> <rect x="16.487" y="8.242" transform="matrix(0.7071 0.7071 -0.7071 0.7071 18.3355 -7.1088)" opacity="0.5" fill="#FFFFFF" width="2.524" height="20.677"></rect> <path fill="#B8D432" d="M27.665,38.614c0,1.496-1.214,2.709-2.71,2.709c-1.497,0-2.709-1.213-2.709-2.709 c0-1.496,1.212-2.709,2.709-2.709C26.45,35.905,27.665,37.118,27.665,38.614"></path> <path fill="#B8D432" d="M27.174,11.389c0,1.201-0.973,2.174-2.174,2.174c-1.201,0-2.174-0.973-2.174-2.174 c0-1.201,0.973-2.174,2.174-2.174C26.201,9.215,27.174,10.188,27.174,11.389"></path> <path fill="#B8D432" d="M13.563,25.001c0,1.201-0.975,2.174-2.174,2.174c-1.201,0-2.174-0.973-2.174-2.174 c0-1.201,0.973-2.174,2.174-2.174C12.588,22.827,13.563,23.8,13.563,25.001"></path> <path fill="#B8D432" d="M40.788,25.001c0,1.201-0.975,2.174-2.175,2.174c-1.2,0-2.174-0.973-2.174-2.174 c0-1.201,0.974-2.174,2.174-2.174C39.813,22.827,40.788,23.8,40.788,25.001"></path> <path opacity="0.1" fill="#FFFFFF" d="M28.262,1.352C27.391,0.48,26.233,0,25.001,0c-1.231,0-2.389,0.48-3.26,1.352L1.352,21.74 C0.492,22.598,0,23.786,0,25c0,1.215,0.492,2.403,1.352,3.261l11.543,11.544L34.61,7.699L28.262,1.352z"></path> </symbol> </defs></svg><svg><use xlink:href="#active-directory"></use></svg></span> </div> </div> </li> <li> <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="Developer Tools">Developer Tools</a> <ul class="menu-pop" id="DeveloperTools-category"> <li class="title">Developer Tools</li> <li data-product-slug="visual-studio-team-services"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/visual-studio-team-services/" title="Visual Studio Team Services" class="label">Visual Studio Team Services</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/visual-studio-team-services/" title="Visual Studio Team Services" class="sub">Services for teams to share code, track work, and ship software</a> </li> <li data-product-slug="devtest-lab"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/devtest-lab/" title="Azure DevTest Labs" class="label">Azure DevTest Labs</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/devtest-lab/" title="Azure DevTest Labs" class="sub">Quickly create environments using reusable templates and artifacts</a> </li> <li data-product-slug="application-insights"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/application-insights/" title="Application Insights" class="label">Application Insights</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/application-insights/" title="Application Insights" class="sub">Detect, triage, and diagnose issues in your web apps and services</a> </li> <li data-product-slug="api-management"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/api-management/" title="API Management" class="label">API Management</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/api-management/" title="API Management" class="sub">Publish APIs to developers, partners and employees securely and at scale</a> </li> <li data-product-slug="hockeyapp"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/hockeyapp/" title="HockeyApp" class="label">HockeyApp</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/hockeyapp/" title="HockeyApp" class="sub">Deploy mobile apps, collect feedback and crash reports, and monitor usage</a> </li> <li data-product-slug="tools"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/tools/" title="Developer Tools and SDKs" class="label">Developer Tools and SDKs</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/tools/" title="Developer Tools and SDKs" class="sub">Build, deploy, diagnose, and manage multi-platform, scalable apps and services</a> </li> <li data-product-slug="xamarin"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/features/xamarin/" title="Xamarin" class="label">Xamarin</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/features/xamarin/" title="Xamarin" class="sub">Create cloud-powered mobile apps faster</a> </li> <li data-product-slug="storage-explorer"> <a data-event="global-clicked-mainmenu" href="http://storageexplorer.com/" title="Storage Explorer" class="label">Storage Explorer</a> <a data-event="global-clicked-mainmenu" href="http://storageexplorer.com/" title="Storage Explorer" class="sub">View and interact with Azure Storage resources</a> </li> </ul> <div class="free-trial"> <div> <p>Each free account includes:</p> <p>Five free users</p> <p>Unlimited private code repos</p> <p>And more!</p> <a href="https://azure.microsoft.com/en-us/free/" title="Learn more" class="wa-arrowLink wa-arrowLink-light" data-event="global-clicked-menumessage" data-event-property="Products (Developer Tools)">Learn more</a> <span class="icon icon-size17"><svg style="display:none; visibility:hidden;"><defs><symbol id="visual-studio-team-services" viewBox="0 0 21 21"> <path fill="#7A4D87" d="M9.7,10L15,5.9v8.2L9.7,10z M2,13V7l3,3L2,13z M15,0L7.1,7.9L2,4L0,5v10l2,1l5.1-3.9L15,20l5-2V2L15,0z"></path> </symbol> </defs></svg><svg><use xlink:href="#visual-studio-team-services"></use></svg></span> </div> </div> </li> <li> <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="Monitoring + Management">Monitoring + Management</a> <ul class="menu-pop" id="MonitoringManagement-category"> <li class="title">Monitoring + Management</li> <li data-product-slug="azure-portal"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/features/azure-portal/" title="Microsoft Azure portal" class="label">Microsoft Azure portal</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/features/azure-portal/" title="Microsoft Azure portal" class="sub">Build, manage, and monitor all Azure products in a single, unified console</a> </li> <li data-product-slug="azure-resource-manager"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/features/resource-manager/" title="Azure Resource Manager" class="label">Azure Resource Manager</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/features/resource-manager/" title="Azure Resource Manager" class="sub">Simplify how you manage your app resources</a> </li> <li data-product-slug="application-insights"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/application-insights/" title="Application Insights" class="label">Application Insights</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/application-insights/" title="Application Insights" class="sub">Detect, triage, and diagnose issues in your web apps and services</a> </li> <li data-product-slug="log-analytics"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/log-analytics/" title="Log Analytics" class="label">Log Analytics</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/log-analytics/" title="Log Analytics" class="sub">Collect, search and visualize machine data from on-premises and cloud</a> </li> <li data-product-slug="automation"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/automation/" title="Automation" class="label">Automation</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/automation/" title="Automation" class="sub">Simplify cloud management with process automation</a> </li> <li data-product-slug="backup"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/backup/" title="Backup" class="label">Backup</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/backup/" title="Backup" class="sub">Simple and reliable server backup to the cloud</a> </li> <li data-product-slug="site-recovery"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/site-recovery/" title="Site Recovery" class="label">Site Recovery</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/site-recovery/" title="Site Recovery" class="sub">Orchestrate protection and recovery of private clouds</a> </li> <li data-product-slug="scheduler"> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/scheduler/" title="Scheduler" class="label">Scheduler</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/services/scheduler/" title="Scheduler" class="sub">Run your jobs on simple or complex recurring schedules</a> </li> <li class="link-bottom"> <a class="label" href="https://azure.microsoft.com/en-us/services/?filter=monitoring-management">See all monitoring + management</a> </li> </ul> <div class="free-trial"> <div> <p>Operations Management Suite</p> <p>Manage and protect your cloud and on-premises infrastructure</p> <a href="https://azure.microsoft.com/en-us/suites/operations-management-suite/" title="Learn more" class="wa-arrowLink wa-arrowLink-light" data-event="global-clicked-menumessage" data-event-property="Products (Monitoring + Management)">Learn more</a> <span class="icon icon-size17"><svg style="display:none; visibility:hidden;"><defs><symbol id="automation" viewBox="0 0 50 50"> <path fill="#A0A1A2" d="M46.281,23.344c0-0.375-0.031-0.734-0.063-1.109L50,20.141c-0.203-1.25-0.531-2.469-0.969-3.625 l-4.313,0.078c-0.328-0.672-0.688-1.328-1.094-1.938l2.219-3.703c-0.797-0.969-1.688-1.859-2.641-2.641l-2.188,1.297l-0.922,1.375 l-1.984,2.922c2.813,2.188,4.625,5.594,4.625,9.438c0,6.594-5.328,11.938-11.922,11.938c-6.578,0-11.922-5.344-11.922-11.938 c0-5.906,4.281-10.781,9.906-11.75l0.906-3.672l-2.094-3.781C26.359,4.344,25.156,4.672,24,5.109l0.063,4.328 c-0.656,0.313-1.313,0.672-1.922,1.094l-3.703-2.219c-0.969,0.781-1.844,1.672-2.641,2.641l2.219,3.703 c-0.422,0.609-0.766,1.266-1.094,1.938l-4.328-0.078c-0.422,1.156-0.75,2.375-0.953,3.625l3.766,2.094 c-0.031,0.375-0.047,0.734-0.047,1.109s0.016,0.734,0.047,1.109l-3.766,2.094c0.203,1.25,0.531,2.469,0.969,3.625l4.313-0.078 c0.328,0.672,0.672,1.328,1.094,1.938l-2.219,3.703c0.797,0.969,1.672,1.859,2.641,2.656l3.703-2.234 c0.609,0.422,1.266,0.781,1.922,1.109L24,41.578c1.156,0.438,2.359,0.766,3.609,0.969l2.109-3.781 c0.359,0.031,0.719,0.063,1.094,0.063s0.75-0.031,1.109-0.063l2.094,3.781c1.25-0.203,2.469-0.531,3.625-0.969l-0.078-4.313 c0.672-0.328,1.313-0.688,1.938-1.109l3.703,2.234c0.953-0.797,1.844-1.688,2.641-2.656l-2.219-3.703 c0.406-0.609,0.766-1.266,1.094-1.938l4.313,0.078c0.438-1.156,0.766-2.375,0.969-3.625l-3.781-2.094 C46.25,24.078,46.281,23.719,46.281,23.344z"></path> <path fill="#7A7A7A" d="M16,39.719v-1.859l-0.102-0.094l-1.902-0.641l-0.49-1.281l0.942-1.953l0.104-0.219l-0.589-0.594 l-0.716-0.719l-0.249,0.125l-1.859,0.953l-1.281-0.359L9.047,31H7.203l-0.094,0.094l-0.641,1.898L5.172,33.48l-2.156-1.037 l-1.313,1.302l0.125,0.245l0.953,1.857l-0.531,1.28L0,37.938v1.859l0.266,0.078l1.984,0.656l0.531,1.281l-1.016,2.156l1.313,1.328 l0.25-0.125l1.859-0.953l1.281,0.531L7.281,47h1.859l0.078-0.266l0.656-1.984l1.266-0.531l2.172,1.016l1.313-1.313l-0.125-0.25 l-0.953-1.859l0.367-1.297L16,39.719z M8.172,41.438c-1.438,0-2.609-1.172-2.609-2.609s1.172-2.609,2.609-2.609 s2.594,1.172,2.594,2.609S9.609,41.438,8.172,41.438z"></path> <path fill="#FCD116" d="M33.297,1.688l-0.719,2.266l-1.234,3.938L30.75,9.781l-0.516,1.656l-3.594,11.422 c-0.078,0.219,0.031,0.391,0.281,0.391h3.313c0.109,0,0.188,0.031,0.234,0.094c0.078,0.078,0.094,0.188,0.047,0.313l-3.422,8.297 c-0.094,0.219-0.031,0.266,0.125,0.078L38.047,19.75c0.156-0.188,0.094-0.328-0.141-0.328l-3.547,0.016l-0.656,0.016 c-0.234,0-0.344-0.172-0.219-0.375l3.375-6.016l0.797-1.438l0.922-1.656l1.969-3.484l1.125-2.031 C39.156,3,36.328,2.031,33.297,1.688z"></path> <path opacity="0.3" fill="#FF8C00" d="M39.505,3.367l-7.844,16.07h1.953c-0.174-0.037-0.249-0.183-0.14-0.359l3.375-6.016 l0.797-1.438l0.922-1.656l1.969-3.484l1.125-2.031C40.966,4.052,40.245,3.692,39.505,3.367z"></path> <path opacity="0.3" fill="#FF8C00" d="M37.92,19.422l-2.189,0.01l-8.093,12.14L38.061,19.75 C38.217,19.563,38.155,19.422,37.92,19.422z"></path> </symbol> </defs></svg><svg><use xlink:href="#automation"></use></svg></span> </div> </div> </li> <li> <a href="https://azure.microsoft.com/en-us/overview/azure-stack/">Microsoft Azure Stack</a> </li> <li class="link-bottom"> <a href="https://azure.microsoft.com/en-us/services/" data-event="global-clicked-productmenuseealllink">See all products</a> </li> </ul> </div> </li> <li id="main-nav-documentation"><a data-event="global-clicked-topnav" href="https://docs.microsoft.com/azure" title="Documentation">Documentation</a></li> <li><a data-event="global-clicked-topnav" href="https://azure.microsoft.com/en-us/pricing/" title="Pricing">Pricing</a></li> <li><a data-event="global-clicked-topnav" href="https://azure.microsoft.com/en-us/partners/" title="Partners">Partners</a></li> <li><a data-event="global-clicked-topnav" href="https://azure.microsoft.com/en-us/blog/" title="Blog">Blog</a></li> <li> <a data-event="global-clicked-topnav" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="Resources">Resources</a> <div> <ul class="menu-drop menu-drop-resources"> <li> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/downloads/" title="Downloads" class="label">Downloads</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/downloads/" title="Downloads" class="sub">Get the SDKs and command-line tools you need</a> </li> <li> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/resources/samples/" title="Samples" class="label">Samples</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/resources/samples/" title="Samples" class="sub">Learn how to interact with Azure services through code</a> </li> <li> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/resources/" title="Whitepapers and Analysts Reports" class="label">Whitepapers and Analysts Reports</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/resources/" title="Whitepapers and Analysts Reports" class="sub">View popular whitepapers, analyst reports and sign up for the newsletter</a> </li> <li> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/community/events/" title="Events" class="label">Events</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/community/events/" title="Events" class="sub">Find an in-person event or webinar</a> </li> <li> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/community/training/" title="Training" class="label">Training</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/community/training/" title="Training" class="sub">Discover training and certification programs</a> </li> <li> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/resources/templates/" title="Templates" class="label">Templates</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/resources/templates/" title="Templates" class="sub">Deploy Azure resources through the Azure Resource Manager with community contributed templates</a> </li> <li> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/updates/" title="Service Updates" class="label">Service Updates</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/updates/" title="Service Updates" class="sub">Learn about updates to Azure products</a> </li> </ul> <div class="free-trial free-trial-why-azure"> <div> <span class="icon icon-size13"><svg><use xlink:href="#azure"></use></svg></span> <p>Sign up for free and get <span class="price-data " data-amount="{&quot;currencies&quot;:{&quot;USD&quot;:200.0,&quot;ARS&quot;:2800.0,&quot;AUD&quot;:260.0,&quot;BRL&quot;:750.0,&quot;CAD&quot;:250.0,&quot;CHF&quot;:190.0,&quot;DKK&quot;:1300.0,&quot;EUR&quot;:170.0,&quot;GBP&quot;:125.0,&quot;HKD&quot;:1600.0,&quot;IDR&quot;:2940000.0,&quot;INR&quot;:12100.0,&quot;JPY&quot;:20500.0,&quot;KRW&quot;:240000.0,&quot;MXN&quot;:3600.0,&quot;MYR&quot;:900.0,&quot;NOK&quot;:1650.0,&quot;NZD&quot;:300.0,&quot;RUB&quot;:12500.0,&quot;SAR&quot;:750.0,&quot;SEK&quot;:1600.0,&quot;TRY&quot;:610.0,&quot;TWD&quot;:6300.0,&quot;ZAR&quot;:3450.0}}" data-decimals="0">$200</span> to spend on all Azure services</p> <a href="https://azure.microsoft.com/en-us/free/" title="Learn more" class="wa-arrowLink wa-arrowLink-light" data-event="global-clicked-menumessage" data-event-property="Resources">Learn more</a> </div> </div> </div> </li> <li> <a data-event="global-clicked-topnav" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="Support">Support</a> <div> <ul class="menu-drop menu-drop-support"> <li> <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="Support Overview">Support Overview</a> <ul class="menu-pop"> <li class="title">Support Overview</li> <li> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/support/options/" title="Azure Support" class="label">Azure Support</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/support/options/" title="Azure Support" class="sub">Find the support options you need</a> </li> <li> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/support/plans/" title="Compare Support Plans" class="label">Compare Support Plans</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/support/plans/" title="Compare Support Plans" class="sub">Explore and purchase technical support</a> </li> <li> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/support/forums/" title="Forums" class="label">Forums</a> <a data-event="global-clicked-mainmenu" href="https://azure.microsoft.com/en-us/support/forums/" title="Forums" class="sub">Get answers from Microsoft and community experts</a> </li> </ul> <div class="free-trial"> <div> <p>Sign up for free and get <span class="price-data " data-amount="{&quot;currencies&quot;:{&quot;USD&quot;:200.0,&quot;ARS&quot;:2800.0,&quot;AUD&quot;:260.0,&quot;BRL&quot;:750.0,&quot;CAD&quot;:250.0,&quot;CHF&quot;:190.0,&quot;DKK&quot;:1300.0,&quot;EUR&quot;:170.0,&quot;GBP&quot;:125.0,&quot;HKD&quot;:1600.0,&quot;IDR&quot;:2940000.0,&quot;INR&quot;:12100.0,&quot;JPY&quot;:20500.0,&quot;KRW&quot;:240000.0,&quot;MXN&quot;:3600.0,&quot;MYR&quot;:900.0,&quot;NOK&quot;:1650.0,&quot;NZD&quot;:300.0,&quot;RUB&quot;:12500.0,&quot;SAR&quot;:750.0,&quot;SEK&quot;:1600.0,&quot;TRY&quot;:610.0,&quot;TWD&quot;:6300.0,&quot;ZAR&quot;:3450.0}}" data-decimals="0">$200</span> to spend on all Azure services</p> <a href="https://docs.microsoft.com/en-us/free/" title="Learn more" class="wa-arrowLink wa-arrowLink-light" data-event="global-clicked-menumessage" data-event-property="Support (Overview)">Learn more</a> <span class="icon icon-size13" style="fill: #fff"><svg><use xlink:href="#azure"></use></svg></span> </div> </div> </li> <li><a href="https://azure.microsoft.com/en-us/support/trust-center/" title="Trust Center">Trust Center</a></li> <li> <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="Legal">Legal</a> <ul class="menu-pop"> <li class="title">Legal</li> <li> <a href="https://docs.microsoft.com/en-us/support/legal/" title="Overview" class="label"> Overview </a> </li> <li> <a href="https://docs.microsoft.com/en-us/support/legal/subscription-agreement/" title="Subscription Agreement" class="label"> Subscription Agreement </a> </li> <li> <a href="http://www.microsoftvolumelicensing.com/DocumentSearch.aspx?Mode=3&amp;DocumentTypeId=31" title="Services Terms" class="label"> Services Terms </a> </li> <li> <a href="https://docs.microsoft.com/en-us/support/legal/offer-details/" title="Offer Details" class="label"> Offer Details </a> </li> <li> <a href="https://www.microsoft.com/en-us/privacystatement/OnlineServices/Default.aspx" title="Privacy Statement" class="label"> Privacy Statement </a> </li> <li> <a href="https://docs.microsoft.com/en-us/support/legal/sla/" title="Service Level Agreements" class="label"> Service Level Agreements </a> </li> <li> <a href="https://docs.microsoft.com/en-us/support/legal/preview-supplemental-terms/" title="Preview Supplemental Terms" class="label"> Preview Supplemental Terms </a> </li> <li> <a href="https://docs.microsoft.com/en-us/support/legal/marketplace-terms/" title="Marketplace Terms" class="label"> Marketplace Terms </a> </li> <li> <a href="https://docs.microsoft.com/en-us/support/legal/website-terms-of-use/" title="Website Terms Of Use" class="label"> Website Terms Of Use </a> </li> </ul> <div class="free-trial"> <div> <p>Sign up for free and get <span class="price-data " data-amount="{&quot;currencies&quot;:{&quot;USD&quot;:200.0,&quot;ARS&quot;:2800.0,&quot;AUD&quot;:260.0,&quot;BRL&quot;:750.0,&quot;CAD&quot;:250.0,&quot;CHF&quot;:190.0,&quot;DKK&quot;:1300.0,&quot;EUR&quot;:170.0,&quot;GBP&quot;:125.0,&quot;HKD&quot;:1600.0,&quot;IDR&quot;:2940000.0,&quot;INR&quot;:12100.0,&quot;JPY&quot;:20500.0,&quot;KRW&quot;:240000.0,&quot;MXN&quot;:3600.0,&quot;MYR&quot;:900.0,&quot;NOK&quot;:1650.0,&quot;NZD&quot;:300.0,&quot;RUB&quot;:12500.0,&quot;SAR&quot;:750.0,&quot;SEK&quot;:1600.0,&quot;TRY&quot;:610.0,&quot;TWD&quot;:6300.0,&quot;ZAR&quot;:3450.0}}" data-decimals="0">$200</span> to spend on all Azure services</p> <a href="https://docs.microsoft.com/en-us/free/" title="Learn more" class="wa-arrowLink wa-arrowLink-light" data-event="global-clicked-menumessage" data-event-property="Support (Legal)">Learn more</a> <span class="icon icon-size13" style="fill: #fff"><svg><use xlink:href="#azure"></use></svg></span> </div> </div> </li> <li><a href="https://azure.microsoft.com/en-us/status/" title="Azure Status Dashboard">Azure Status Dashboard</a></li> </ul> </div> </li> <li class="mobile-free-trial az_hUpdated"> <a data-event="global-clicked-primarycta" href="https://azure.microsoft.com/en-us/free/" class="button button-primary" title="Free account">Free account</a> <a href="tel:" title="Sales">Sales: <span data-control="geophone">1-800-867-1389</span></a> </li> </ul> </div> <div class="nav-end"></div> </header> 


    <div id="lca-cookie-notification" class="shell-notification" style="display:none;">
        <div class="shell-notification-grid-row shell-notification-clearfix">
            <span id="cookie.consent.europe" class="notification-txt">By using this site you agree to the use of cookies for analytics, personalized content and ads.</span>
            <span class="notification-action">
            <a id="privacystatement-link" tabindex="1" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="Privacy Statement">Learn more</a>
            <a id="close" tabindex="2" title="close">
                <i class="shell-icon-close"></i>
            </a>
            </span>
        </div>
    </div>
    <div id="msdn-redirection-notification" class="shell-notification" style="display:none;">
        <div class="shell-notification-grid-row shell-notification-clearfix">
            <span id="msdn.redirection.text" class="notification-txt">You were redirected to this page from MSDN.  We are in the process of migrating all technical content to docs.microsoft.com.</span>
            <span class="notification-action">
            <a id="redirect-notification-close" tabindex="1" title="close">
                <i class="shell-icon-close"></i>
            </a>
            </span>
        </div>
    </div>

    <div id="sub-header" class="container" ms.cmpgrp="breadcrumb" role="navigation" aria-label="breadcrumb">    
        <div id="sub-header-content">
            <div class="content">
                <ul class="breadcrumbs"><li><a href="https://docs.microsoft.com/en-us/azure/index">Azure</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-resiliency-overview">Guidance</a></li></ul>
            </div>
        </div>
    </div>
</div>

    <main>
      <div class="container" ms.pgarea="body">      
        <div id="page-actions" ms.cmpgrp="social" role="complementary">
          <div id="page-actions-content" class="fixed pinned-actions" style="top: 18px; width: 302px; max-height: 937px;">
          
            <ol class="action-list">
              
              <li>
                <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#comments-container" class="button is-primary is-small" id="comments-link">
                  <i class="icon icon-comments"></i>Comments
                </a>
              </li>
              
              
              <li id="contenteditbtn">
                <a href="https://github.com/Microsoft/azure-docs/blob/master/articles/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance.md" title="Edit This Document" class="button is-primary is-small">
                  <i class="icon icon-editor"></i>Edit
                </a>
              </li>
              
              <li>
                <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" class="button is-primary is-small sharebutton" title="Share This Document"><i class="icon icon-share"></i>Share</a>
                <div class="share-container">
                  
                    <div><a href="https://twitter.com/intent/tweet?original_referer=https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance&amp;text=Tuning%20data%20aggregation%20and%20query%20performance%20with%20Elasticsearch%20on%20Azure%20%7C%20Microsoft%20Docs&amp;tw_p=tweetbutton&amp;url=https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance" class="share-twitter"><i class="icon icon-twitter"></i>Twitter</a></div>
                    <div><a href="https://www.facebook.com/sharer/sharer.php?u=https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance" class="share-facebook"><i class="icon icon-facebook"></i>Facebook</a></div>
                  

                  

                  
                </div>
              </li>
              
              
              <li class="menu">
                <div class="dropdown-container">
                  <div class="dropdown">
                    <label for="theme-selector">Theme</label>
                    <select id="theme-selector">
                      <option value="">Light
                      </option><option value="theme_night">Dark
                    </option></select>
                  </div>
                </div>
              </li>
            </ol>

            <div id="menu-expand">
              <h4><span id="menu-expand-icon">+ </span>Options</h4>
            </div>

            <nav id="side-doc-outline" class="doc-outline" ms.cmpgrp="intopic toc" role="navigation" aria-label="On page navigation">
              <h3 style="display: block;">In this article</h3>
            <ul><li class="selected"><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#index-and-query-performance-considerations">Index and query performance considerations</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#testing-and-analyzing-aggregation-and-search-performance">Testing and analyzing aggregation and search performance</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#performance-results---disk-type">Performance results - disk type</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#performance-results---scaling-up">Performance results - scaling up</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#performance-results---scaling-out">Performance results - scaling out</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#performance-results---number-of-replicas">Performance results - number of replicas</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#performance-results---doc-values">Performance results - doc values</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#performance-results---shard-request-cache">Performance results - shard request cache</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#performance-results---number-of-shards">Performance results - number of shards</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#summary">Summary</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#appendix-the-query-and-aggregation-performance-test">Appendix: the query and aggregation performance test</a></li></ul></nav>

          </div>
        </div>

        <div id="sidebar" ms.cmpgrp="left toc" role="navigation" aria-label="main navigation">
          <div id="sidebarContent" class="fixed" style="top: 18px; width: 288px;">
            <div class="filterHolder"><form class="tocFilter"><input placeholder="Filter" aria-label="Filter" type="search"><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#" title="clear filter" class="clearInput"></a></form><div class="emptyFilterMessage">No results</div></div>
            <nav class="toc" role="application" style="max-height: 877px;"><ul aria-treegrid="true" class="noSibs"><li aria-expanded="true" aria-treeitem="true"><span data-text="architecture">Architecture</span><ul aria-treegrid="true"><li aria-expanded="false" tabindex="0" aria-treeitem="true"><span data-text="cloud fundamentals">Cloud Fundamentals</span><ul aria-treegrid="true"><li aria-expanded="false" tabindex="0" aria-treeitem="true" class="noSubs"><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-resiliency-overview" data-text="design resilient applications">Design resilient applications</a><ul aria-treegrid="true"><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-resiliency-checklist" data-text="resiliency checklist">Resiliency checklist</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-resiliency-failure-mode-analysis" data-text="failure mode analysis">Failure mode analysis</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/resiliency/resiliency-disaster-recovery-azure-applications" data-text="disaster recovery">Disaster recovery</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/resiliency/resiliency-disaster-recovery-high-availability-azure-applications" data-text="disaster recovery and high availability">Disaster recovery and high availability</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/resiliency/resiliency-high-availability-azure-applications" data-text="high availability">High availability</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/resiliency/resiliency-high-availability-checklist" data-text="high availability checklist">High availability checklist</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/resiliency/resiliency-service-guidance-index" data-text="azure service-specific resiliency guidance">Azure service-specific resiliency guidance</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/resiliency/resiliency-technical-guidance-recovery-data-corruption" data-text="recovery from data corruption or accidental deletion">Recovery from data corruption or accidental deletion</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/resiliency/resiliency-technical-guidance-recovery-local-failures" data-text="recovery from local failures">Recovery from local failures</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/resiliency/resiliency-technical-guidance-recovery-loss-azure-region" data-text="recovery from a region-wide service disruption">Recovery from a region-wide service disruption</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/resiliency/resiliency-technical-guidance-recovery-on-premises-azure" data-text="recovery from on-premises to azure">Recovery from on-premises to Azure</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/resiliency/resiliency-technical-guidance" data-text="azure resiliency technical guidance">Azure resiliency technical guidance</a></li></ul></li></ul></li><li aria-expanded="false" tabindex="0" aria-treeitem="true"><span data-text="reference architectures">Reference Architectures</span><ul aria-treegrid="true"><li aria-expanded="false" tabindex="0" aria-treeitem="true" class="noSubs"><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-ra-compute" data-text="run vm workloads in azure">Run VM workloads in Azure</a><ul aria-treegrid="true"><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-compute-single-vm-linux" data-text="run a linux vm on azure">Run a Linux VM on Azure</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-compute-single-vm" data-text="run a windows vm on azure">Run a Windows VM on Azure</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-compute-multi-vm" data-text="run multiple vms on azure for scalability and availability">Run multiple VMs on Azure for scalability and availability</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-compute-n-tier-vm-linux" data-text="run linux vms for an n-tier architecture">Run Linux VMs for an N-tier architecture</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-compute-n-tier-vm" data-text="run windows vms for an n-tier architecture">Run Windows VMs for an N-tier architecture</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-compute-multiple-datacenters-linux" data-text="run linux vms in multiple regions for high availability">Run Linux VMs in multiple regions for high availability</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-compute-multiple-datacenters" data-text="run windows vms in multiple regions for high availability">Run Windows VMs in multiple regions for high availability</a></li></ul></li><li aria-expanded="false" tabindex="0" aria-treeitem="true" class="noSubs"><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-ra-hybrid-networking" data-text="connect your on-premises network to azure">Connect your on-premises network to Azure</a><ul aria-treegrid="true"><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-hybrid-network-expressroute" data-text="hybrid network architecture with azure expressroute">Hybrid network architecture with Azure ExpressRoute</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-hybrid-network-vpn" data-text="hybrid network architecture with azure and on-premises vpn">Hybrid network architecture with Azure and On-premises VPN</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-hybrid-network-expressroute-vpn-failover" data-text="highly available hybrid network architecture">Highly available hybrid network architecture</a></li></ul></li><li aria-expanded="false" tabindex="0" aria-treeitem="true" class="noSubs"><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-ra-network-security" data-text="protect the cloud boundary in azure">Protect the Cloud Boundary in Azure</a><ul aria-treegrid="true"><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-iaas-ra-secure-vnet-hybrid" data-text="secure hybrid network architecture in azure">Secure hybrid network architecture in Azure</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-iaas-ra-secure-vnet-dmz" data-text="dmz between azure and the internet">DMZ between Azure and the Internet</a></li></ul></li><li aria-expanded="false" tabindex="0" aria-treeitem="true" class="noSubs"><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-ra-identity" data-text="manage identity in azure">Manage identity in Azure</a><ul aria-treegrid="true"><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-identity-aad" data-text="implement azure active directory">Implement Azure Active Directory</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-identity-adds-extend-domain" data-text="extend adds to azure">Extend ADDS to Azure</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-identity-adds-resource-forest" data-text="create an adds resource forest in azure">Create an ADDS resource forest in Azure</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-identity-adfs" data-text="implement adfs in azure">Implement ADFS in Azure</a></li></ul></li><li aria-expanded="false" tabindex="0" aria-treeitem="true" class="noSubs"><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-ra-app-service" data-text="web application architectures for azure app service">Web application architectures for Azure App Service</a><ul aria-treegrid="true"><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-web-apps-basic" data-text="basic web application">Basic web application</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-web-apps-multi-region" data-text="web application with high availability">Web application with high availability</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-web-apps-scalability" data-text="improve scalability in a web application">Improve scalability in a web application</a></li></ul></li></ul></li><li aria-expanded="false" tabindex="0" aria-treeitem="true" class="noSubs"><span data-text="best practices for cloud applications">Best Practices for Cloud Applications</span><ul aria-treegrid="true"><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/best-practices-api-design" data-text="api design guidance">API design guidance</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/best-practices-api-implementation" data-text="api implementation guidance">API implementation guidance</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/best-practices-auto-scaling" data-text="autoscaling guidance">Autoscaling guidance</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/best-practices-availability-checklist" data-text="availability checklist">Availability checklist</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/best-practices-background-jobs" data-text="background jobs guidance">Background jobs guidance</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/best-practices-availability-paired-regions" data-text="azure paired regions">Azure Paired Regions</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/best-practices-caching" data-text="caching guidance">Caching guidance</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/best-practices-cdn" data-text="content delivery network guidance">Content Delivery Network guidance</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/best-practices-data-partitioning" data-text="data partitioning guidance">Data partitioning guidance</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/best-practices-monitoring" data-text="monitoring and diagnostics guidance">Monitoring and diagnostics guidance</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/best-practices-network-security" data-text="microsoft cloud services and network security">Microsoft cloud services and network security</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/best-practices-resource-manager-design-templates" data-text="patterns for designing azure resource manager templates">Patterns for designing Azure Resource Manager templates</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-naming-conventions" data-text="recommended naming conventions for azure resources">Recommended naming conventions for Azure resources</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/best-practices-resource-manager-security" data-text="security considerations for azure resource manager">Security considerations for Azure Resource Manager</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/best-practices-resource-manager-state" data-text="sharing state in azure resource manager templates">Sharing state in Azure Resource Manager templates</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/best-practices-retry-general" data-text="retry general guidance">Retry general guidance</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/best-practices-retry-service-specific" data-text="retry service specific guidance">Retry service specific guidance</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/best-practices-scalability-checklist" data-text="scalability checklist">Scalability checklist</a></li></ul></li><li aria-expanded="true" tabindex="0" aria-treeitem="true"><span data-text="scenario guides">Scenario Guides</span><ul aria-treegrid="true"><li aria-expanded="true" tabindex="0" aria-treeitem="true" class="noSubs"><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch" data-text="elasticsearch on azure guidance">Elasticsearch on Azure Guidance</a><ul aria-treegrid="true"><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-running-on-azure" data-text="run elasticsearch on azure">Run Elasticsearch on Azure</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-ingestion-performance" data-text="tune data ingestion performance">Tune data ingestion performance</a></li><li class="selectedHolder"><a tabindex="0" class="selected" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance" data-text="tune data aggregation and query performance">Tune data aggregation and query performance</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-configuring-resilience-and-recovery" data-text="configure resilience and recovery">Configure resilience and recovery</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-creating-performance-testing-environment" data-text="create a performance testing environment">Create a performance testing environment</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-implementing-jmeter-test-plan" data-text="implement a jmeter test plan">Implement a JMeter test plan</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-deploying-jmeter-junit-sampler" data-text="deploy a jmeter junit sampler">Deploy a JMeter JUnit sampler</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-running-automated-resilience-tests" data-text="run the automated resiliency tests">Run the automated resiliency tests</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-running-automated-performance-tests" data-text="run the automated performance tests">Run the automated performance tests</a></li></ul></li><li aria-expanded="false" tabindex="0" aria-treeitem="true" class="noSubs"><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-multitenant-identity" data-text="identity management for multitenant applications">Identity management for multitenant applications</a><ul aria-treegrid="true"><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-multitenant-identity-intro" data-text="overview">Overview</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-multitenant-identity-tailspin" data-text="tailspin surveys application">Tailspin Surveys application</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-multitenant-identity-authenticate" data-text="authentication using azure ad and openid connect">Authentication using Azure AD and OpenID Connect</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-multitenant-identity-claims" data-text="claims-based identities">Claims-based identities</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-multitenant-identity-signup" data-text="sign-up and tenant onboarding">Sign-up and tenant onboarding</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-multitenant-identity-app-roles" data-text="application roles">Application roles</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-multitenant-identity-authorize" data-text="role-based and resource-based authorization">Role-based and resource-based authorization</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-multitenant-identity-web-api" data-text="secure a backend web api">Secure a backend web API</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-multitenant-identity-token-cache" data-text="cache access tokens">Cache access tokens</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-multitenant-identity-adfs" data-text="federation with a customer&amp;#39;s ad fs">Federation with a customer's AD FS</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-multitenant-identity-client-assertion" data-text="use client assertion to get access tokens">Use client assertion to get access tokens</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-multitenant-identity-keyvault" data-text="use azure key vault to protect application secrets">Use Azure Key Vault to protect application secrets</a></li><li><a tabindex="0" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-nva-ha" data-text="deploying virtual appliances in high availability">Deploying virtual appliances in high availability</a></li></ul></li></ul></li></ul></li></ul></nav>          
            <div class="pdfDownloadHolder"></div>
          </div>
        </div>

        <div id="menu-nav" class="dropdown-container">
          <div class="dropdown dropdown-full mobilenavi">
            <select><option class="noLink">Architecture</option><option class="noLink">&nbsp;&nbsp;&nbsp;Cloud Fundamentals</option><option value="/en-us/azure/guidance/guidance-resiliency-overview">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Design resilient applications</option><option value="/en-us/azure/guidance/guidance-resiliency-checklist">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Resiliency checklist</option><option value="/en-us/azure/guidance/guidance-resiliency-failure-mode-analysis">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Failure mode analysis</option><option value="/en-us/azure/resiliency/resiliency-disaster-recovery-azure-applications">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Disaster recovery</option><option value="/en-us/azure/resiliency/resiliency-disaster-recovery-high-availability-azure-applications">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Disaster recovery and high availability</option><option value="/en-us/azure/resiliency/resiliency-high-availability-azure-applications">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;High availability</option><option value="/en-us/azure/resiliency/resiliency-high-availability-checklist">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;High availability checklist</option><option value="/en-us/azure/resiliency/resiliency-service-guidance-index">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Azure service-specific resiliency guidance</option><option value="/en-us/azure/resiliency/resiliency-technical-guidance-recovery-data-corruption">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Recovery from data corruption or accidental deletion</option><option value="/en-us/azure/resiliency/resiliency-technical-guidance-recovery-local-failures">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Recovery from local failures</option><option value="/en-us/azure/resiliency/resiliency-technical-guidance-recovery-loss-azure-region">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Recovery from a region-wide service disruption</option><option value="/en-us/azure/resiliency/resiliency-technical-guidance-recovery-on-premises-azure">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Recovery from on-premises to Azure</option><option value="/en-us/azure/resiliency/resiliency-technical-guidance">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Azure resiliency technical guidance</option><option class="noLink">&nbsp;&nbsp;&nbsp;Reference Architectures</option><option value="/en-us/azure/guidance/guidance-ra-compute">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Run VM workloads in Azure</option><option value="/en-us/azure/guidance/guidance-compute-single-vm-linux">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Run a Linux VM on Azure</option><option value="/en-us/azure/guidance/guidance-compute-single-vm">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Run a Windows VM on Azure</option><option value="/en-us/azure/guidance/guidance-compute-multi-vm">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Run multiple VMs on Azure for scalability and availability</option><option value="/en-us/azure/guidance/guidance-compute-n-tier-vm-linux">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Run Linux VMs for an N-tier architecture</option><option value="/en-us/azure/guidance/guidance-compute-n-tier-vm">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Run Windows VMs for an N-tier architecture</option><option value="/en-us/azure/guidance/guidance-compute-multiple-datacenters-linux">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Run Linux VMs in multiple regions for high availability</option><option value="/en-us/azure/guidance/guidance-compute-multiple-datacenters">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Run Windows VMs in multiple regions for high availability</option><option value="/en-us/azure/guidance/guidance-ra-hybrid-networking">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Connect your on-premises network to Azure</option><option value="/en-us/azure/guidance/guidance-hybrid-network-expressroute">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hybrid network architecture with Azure ExpressRoute</option><option value="/en-us/azure/guidance/guidance-hybrid-network-vpn">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hybrid network architecture with Azure and On-premises VPN</option><option value="/en-us/azure/guidance/guidance-hybrid-network-expressroute-vpn-failover">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Highly available hybrid network architecture</option><option value="/en-us/azure/guidance/guidance-ra-network-security">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Protect the Cloud Boundary in Azure</option><option value="/en-us/azure/guidance/guidance-iaas-ra-secure-vnet-hybrid">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Secure hybrid network architecture in Azure</option><option value="/en-us/azure/guidance/guidance-iaas-ra-secure-vnet-dmz">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DMZ between Azure and the Internet</option><option value="/en-us/azure/guidance/guidance-ra-identity">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Manage identity in Azure</option><option value="/en-us/azure/guidance/guidance-identity-aad">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Implement Azure Active Directory</option><option value="/en-us/azure/guidance/guidance-identity-adds-extend-domain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Extend ADDS to Azure</option><option value="/en-us/azure/guidance/guidance-identity-adds-resource-forest">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Create an ADDS resource forest in Azure</option><option value="/en-us/azure/guidance/guidance-identity-adfs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Implement ADFS in Azure</option><option value="/en-us/azure/guidance/guidance-ra-app-service">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Web application architectures for Azure App Service</option><option value="/en-us/azure/guidance/guidance-web-apps-basic">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Basic web application</option><option value="/en-us/azure/guidance/guidance-web-apps-multi-region">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Web application with high availability</option><option value="/en-us/azure/guidance/guidance-web-apps-scalability">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Improve scalability in a web application</option><option class="noLink">&nbsp;&nbsp;&nbsp;Best Practices for Cloud Applications</option><option value="/en-us/azure/best-practices-api-design">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;API design guidance</option><option value="/en-us/azure/best-practices-api-implementation">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;API implementation guidance</option><option value="/en-us/azure/best-practices-auto-scaling">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Autoscaling guidance</option><option value="/en-us/azure/best-practices-availability-checklist">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Availability checklist</option><option value="/en-us/azure/best-practices-background-jobs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Background jobs guidance</option><option value="/en-us/azure/best-practices-availability-paired-regions">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Azure Paired Regions</option><option value="/en-us/azure/best-practices-caching">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Caching guidance</option><option value="/en-us/azure/best-practices-cdn">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Content Delivery Network guidance</option><option value="/en-us/azure/best-practices-data-partitioning">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Data partitioning guidance</option><option value="/en-us/azure/best-practices-monitoring">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Monitoring and diagnostics guidance</option><option value="/en-us/azure/best-practices-network-security">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Microsoft cloud services and network security</option><option value="/en-us/azure/best-practices-resource-manager-design-templates">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Patterns for designing Azure Resource Manager templates</option><option value="/en-us/azure/guidance/guidance-naming-conventions">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Recommended naming conventions for Azure resources</option><option value="/en-us/azure/best-practices-resource-manager-security">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Security considerations for Azure Resource Manager</option><option value="/en-us/azure/best-practices-resource-manager-state">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sharing state in Azure Resource Manager templates</option><option value="/en-us/azure/best-practices-retry-general">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Retry general guidance</option><option value="/en-us/azure/best-practices-retry-service-specific">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Retry service specific guidance</option><option value="/en-us/azure/best-practices-scalability-checklist">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Scalability checklist</option><option class="noLink">&nbsp;&nbsp;&nbsp;Scenario Guides</option><option value="/en-us/azure/guidance/guidance-elasticsearch">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Elasticsearch on Azure Guidance</option><option value="/en-us/azure/guidance/guidance-elasticsearch-running-on-azure">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Run Elasticsearch on Azure</option><option value="/en-us/azure/guidance/guidance-elasticsearch-tuning-data-ingestion-performance">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tune data ingestion performance</option><option value="/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance" selected="selected">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tune data aggregation and query performance</option><option value="/en-us/azure/guidance/guidance-elasticsearch-configuring-resilience-and-recovery">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Configure resilience and recovery</option><option value="/en-us/azure/guidance/guidance-elasticsearch-creating-performance-testing-environment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Create a performance testing environment</option><option value="/en-us/azure/guidance/guidance-elasticsearch-implementing-jmeter-test-plan">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Implement a JMeter test plan</option><option value="/en-us/azure/guidance/guidance-elasticsearch-deploying-jmeter-junit-sampler">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Deploy a JMeter JUnit sampler</option><option value="/en-us/azure/guidance/guidance-elasticsearch-running-automated-resilience-tests">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Run the automated resiliency tests</option><option value="/en-us/azure/guidance/guidance-elasticsearch-running-automated-performance-tests">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Run the automated performance tests</option><option value="/en-us/azure/guidance/guidance-multitenant-identity">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Identity management for multitenant applications</option><option value="/en-us/azure/guidance/guidance-multitenant-identity-intro">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Overview</option><option value="/en-us/azure/guidance/guidance-multitenant-identity-tailspin">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tailspin Surveys application</option><option value="/en-us/azure/guidance/guidance-multitenant-identity-authenticate">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Authentication using Azure AD and OpenID Connect</option><option value="/en-us/azure/guidance/guidance-multitenant-identity-claims">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Claims-based identities</option><option value="/en-us/azure/guidance/guidance-multitenant-identity-signup">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sign-up and tenant onboarding</option><option value="/en-us/azure/guidance/guidance-multitenant-identity-app-roles">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Application roles</option><option value="/en-us/azure/guidance/guidance-multitenant-identity-authorize">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Role-based and resource-based authorization</option><option value="/en-us/azure/guidance/guidance-multitenant-identity-web-api">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Secure a backend web API</option><option value="/en-us/azure/guidance/guidance-multitenant-identity-token-cache">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cache access tokens</option><option value="/en-us/azure/guidance/guidance-multitenant-identity-adfs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Federation with a customer's AD FS</option><option value="/en-us/azure/guidance/guidance-multitenant-identity-client-assertion">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Use client assertion to get access tokens</option><option value="/en-us/azure/guidance/guidance-multitenant-identity-keyvault">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Use Azure Key Vault to protect application secrets</option><option value="/en-us/azure/guidance/guidance-nva-ha">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Deploying virtual appliances in high availability</option></select>
          </div>
        </div>

        <div id="main" role="main">
          <div id="langDisclaimer" class="disclaimer" style="display:none;"><span class="icon icon-disclaimer"></span><span class="disclaimertext">This content is not available in your language but here is the English version.</span></div>
                    

          
            <h1 id="tuning-data-aggregation-and-query-performance-with-elasticsearch-on-azure" sourcefile="articles/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance.md" sourcestartlinenumber="21" sourceendlinenumber="21">Tuning data aggregation and query performance with Elasticsearch on Azure</h1>
            <div id="metadata" ms.cmpgrp="page info">
              <div class="info">
                <div class="meta">
                  
                  <time class="date" datetime="9/22/2016 12:00:00 AM">2016/9/22</time>
                  
                  <span class="reading-time">52 min to read</span>
                  
                  <span class="contributors-text">Contributors</span>
                  <ul class="contributors">
                    
                      
                      
                        <li><a href="https://github.com/dragon119" title="Masashi Narumoto"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/dragon119.png" alt="Masashi Narumoto"></a></li>
                      
                      
                      
                        <li><a href="https://github.com/bennage" title="Christopher Bennage"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/bennage.png" alt="Christopher Bennage"></a></li>
                      
                      
                                                            
                  </ul>
                  
                </div>
                
              </div>
            </div>

            <nav id="center-doc-outline" class="doc-outline" ms.cmpgrp="intopic toc" role="navigation" aria-label="On page navigation">
              <h3 style="display: block;">In this article</h3>
            <ul class="lf-text-block lf-block" data-lf-anchor-id="1bfc0536ff2970d77b6978c707d7254f:0"><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#index-and-query-performance-considerations">Index and query performance considerations</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#testing-and-analyzing-aggregation-and-search-performance">Testing and analyzing aggregation and search performance</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#performance-results---disk-type">Performance results - disk type</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#performance-results---scaling-up">Performance results - scaling up</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#performance-results---scaling-out">Performance results - scaling out</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#performance-results---number-of-replicas">Performance results - number of replicas</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#performance-results---doc-values">Performance results - doc values</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#performance-results---shard-request-cache">Performance results - shard request cache</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#performance-results---number-of-shards">Performance results - number of shards</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#summary">Summary</a></li><li><a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#appendix-the-query-and-aggregation-performance-test">Appendix: the query and aggregation performance test</a></li><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="1bfc0536ff2970d77b6978c707d7254f:0">+
</a>
</span></ul></nav>
          

          <div><div class="content">
<!-- BEGIN INCLUDE: Include content from &quot;includes/guidance-pnp-header-include.md&quot; --><p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:0"><a href="http://aka.ms/mspnp"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/pnp-logo.png" alt="patterns &amp; practices"></a><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:0">+
</a>
</span></p>
<!--END INCLUDE --><p class="lf-text-block lf-block" data-lf-anchor-id="9ee1158b41e096227404ece6e37f2ce0:0">This article is <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch">part of a series</a>. <span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="9ee1158b41e096227404ece6e37f2ce0:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="09f669484c98c850a1cdad464d2056c1:0">A primary reason for using Elasticsearch is to support searches through data. Users should be able to quickly locate the information they are looking for. Additionally, the system must enable users to ask questions of the data, seek correlations, and come to conclusions that can drive business decisions. This processing is what differentiates data from information.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="09f669484c98c850a1cdad464d2056c1:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="c0db6867153220fd12e1998673604439:0">This document summarizes options that you can consider when determining the best way to optimize your system for query and search performance.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="c0db6867153220fd12e1998673604439:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="a3c42f4b57b966fd2be9b84767276e51:0">All performance recommendations depend largely on the scenarios that apply to your situation, the volume of data that you are indexing, and the rate at which applications and users query your data. You should carefully test the results of any change in configuration or indexing structure using your own data and workloads to assess the benefits to your specific scenarios. To this end, this document also describes a number of benchmarks that were performed for one specific scenario implemented using different configurations. You can adapt the approach taken to assess the performance of your own systems. The details of these tests are described in the <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#appendix-the-query-and-aggregation-performance-test">appendix</a>.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="a3c42f4b57b966fd2be9b84767276e51:0">+
</a>
</span></p>
<h2 id="index-and-query-performance-considerations">Index and query performance considerations</h2>
<p class="lf-text-block lf-block" data-lf-anchor-id="56d11c031837092b76cf449a19a95a73:0">This section describes some common factors that you should think about when designing indexes that need to support fast querying and searching.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="56d11c031837092b76cf449a19a95a73:0">+
</a>
</span></p>
<h3 id="storing-multiple-types-in-an-index">Storing multiple types in an index</h3>
<p class="lf-text-block lf-block" data-lf-anchor-id="88894d8749b420b033c099c77b545e60:0">An Elasticsearch index can contain multiple types. It may be better to avoid this approach and create a separate index for each type. Consider the following points:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="88894d8749b420b033c099c77b545e60:0">+
</a>
</span></p>
<ul class="lf-text-block lf-block" data-lf-anchor-id="89c94d6acf9a2fca32c989cf47014f4b:0">
<li>Different types might specify different analyzers, and it is not always clear which analyzer Elasticsearch should use if a query is performed at the index level rather than at the type level. See <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/mapping.html#_avoiding_type_gotchas">Avoiding Type Gotchas</a> for details.</li>
<li>Shards for indexes that hold multiple types will likely be bigger than those for indexes that contain a single type. The bigger a shard, the more effort is required by Elasticsearch to filter data when performing queries.</li>
<li><p>If there is a significant mismatch between data volumes for the types, information for one type can become sparsely distributed across many shards reducing the efficiency of searches that retrieve this data.</p>
<p>  <img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance1.png" alt=""></p>
<p>  <strong><em>The effects of sharing an index between types</em></strong> </p>
<p>  In the upper part of the diagram, the same index is shared by documents of type A and type B. There are many more documents of type A than type B. Searches for type A will involve querying all four shards. The lower part of the diagram shows the effect if separate indexes are created for each type. In this case, searches for type A will only require accessing two shards.</p>
</li>
<li>Small shards can be more evenly distributed than large shards, making it easier for Elasticsearch to spread the load across nodes.</li>
<li>Different types might have different retention periods. It can be difficult to archive old data that shares shards with active data.</li>
<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="89c94d6acf9a2fca32c989cf47014f4b:0">+
</a>
</span></ul>
<p class="lf-text-block lf-block" data-lf-anchor-id="18d1807214b57fac19284d47578b1865:0">However, under some circumstances sharing an index across types can be efficient if:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="18d1807214b57fac19284d47578b1865:0">+
</a>
</span></p>
<ul class="lf-text-block lf-block" data-lf-anchor-id="83cd2d6929b0288831c879c349470ea7:0">
<li>Searches regularly span types held in the same index.</li>
<li>The types only have a small number of documents each. Maintaining a separate set of shards for each type can become a significant overhead in this case.</li>
<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="83cd2d6929b0288831c879c349470ea7:0">+
</a>
</span></ul>
<h3 id="optimizing-index-types">Optimizing index types</h3>
<p class="lf-text-block lf-block" data-lf-anchor-id="0eed0dc7459ce098318789cf73252ef1:0">An Elasticsearch index contains a copy of the original JSON documents that were used to populate it. This information is held in the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-source-field.html#mapping-source-field"><em>_source</em></a> field of each indexed item. This data is not searchable, but by default is returned by <em>get</em> and <em>search</em> requests. However, this field incurs overhead and occupies storage, making shards larger and increasing the volume of I/O performed. You can disable the <em>_source</em> field on a per type basis:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="0eed0dc7459ce098318789cf73252ef1:0">+
</a>
</span></p>
<div class="codeHeader lang-http"><div class="copyBtn">Copy</div><div class="labelHolder">http</div></div><pre><code class="lang-http"><span class="hljs-attribute">PUT my_index
{
  "mappings"</span>: {
    "<span class="hljs-attribute">my_type"</span>: {
      "<span class="hljs-attribute">_source"</span>: {
        "<span class="hljs-attribute">enabled"</span>: false
      }
    }
  }
}
</code></pre><p class="lf-text-block lf-block" data-lf-anchor-id="07803c0705b84a99518548cb27004704:0">Disabling this field also removes the ability to perform the following operations:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="07803c0705b84a99518548cb27004704:0">+
</a>
</span></p>
<ul class="lf-text-block lf-block" data-lf-anchor-id="8bdc2f697db9f805214928c749002e46:0">
<li>Updating data in the index by using the <em>update</em> API.</li>
<li>Performing searches that return highlighted data.</li>
<li>Reindexing from one Elasticsearch index directly to another.</li>
<li>Changing mappings or analysis settings.</li>
<li>Debugging queries by viewing the original document.</li>
<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8bdc2f697db9f805214928c749002e46:0">+
</a>
</span></ul>
<h3 id="reindexing-data">Reindexing data</h3>
<p class="lf-text-block lf-block" data-lf-anchor-id="81d88d294fb0a9b83d899c5763204f6d:0">The number of shards available to an index ultimately determines the capacity of the index. You can take an initial (and informed) guess at how many shards will be required, but you should always consider your document re-indexing strategy up front. In many cases, reindexing may be an intended task as data grows. You may not want to allocate a large number of shards to an index initially, for the sake of search optimization, but allocate new shards as the volume of data expands. In other cases reindexing might need to be performed on a more ad-hoc basis if your estimates about data volume growth simply prove to be inaccurate.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="81d88d294fb0a9b83d899c5763204f6d:0">+
</a>
</span></p>
<div class="NOTE alert"><h5>Note</h5><p class="lf-text-block lf-block" data-lf-anchor-id="819c6d49487638b836c890c76b626e69:0">Reindexing might not be necessary for data that ages quickly. In this case, an application might create a new index for each period of time. Examples include performance logs or audit data which could be stored in a fresh index each day.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="819c6d49487638b836c890c76b626e69:0">+
</a>
</span></p>
</div>
<!-- -->
<p class="lf-text-block lf-block" data-lf-anchor-id="8a946d015dbdc4b0238f48574b235679:0">Reindexing effectively involves creating a new index from the data in an old one, and then removing the old index. If an index is large, this process can take time, and you may need to ensure that the data remains searchable during this period. For this reason, you should create an <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-aliases.html">alias for each index</a>, and queries should retrieve data through these aliases. While reindexing, keep the alias pointing at the old index, and then switch it to reference the new index once reindexing is complete. This approach is also useful for accessing time-based data that creates a new index each day. To access the current data use an alias that rolls over to the new index as it is created.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8a946d015dbdc4b0238f48574b235679:0">+
</a>
</span></p>
<h3 id="managing-mappings">Managing mappings</h3>
<p class="lf-text-block lf-block" data-lf-anchor-id="19916ded051e2ee031c99dde6b204e51:0">Elasticsearch uses mappings to determine how to interpret the data that occurs in each field in a document. Each type has its own mapping, which effectively defines a schema for that type. Elasticsearch uses this information to generate inverted indexes for each field in the documents in a type. In any document, each field has a datatype (such as <em>string</em>, <em>date</em>, or <em>long</em>) and a value. You can specify the mappings for an index when the index is first created, or they can be inferred by Elasticsearch when new documents are added to a type. However, consider the following points:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="19916ded051e2ee031c99dde6b204e51:0">+
</a>
</span></p>
<ul class="lf-text-block lf-block" data-lf-anchor-id="8dd16ba9459c2ca211cd99de4b616f71:0">
<li>Mappings generated dynamically can cause errors depending on how fields are interpreted when documents are added to an index. For example, document 1 could contain a field A that holds a number and causes Elasticsearch to add a mapping that specifies that this field is a <em>long</em>. If a subsequent document is added in which field A contains nonnumeric data, then it will fail. In this case, field A should probably have been interpreted as a string when the first document was added. Specifying this mapping when the index is created can help to prevent such problems.</li>
<li>Design your documents to avoid generating excessively large mappings as this can add significant overhead when performing searches, consume lots of memory, and also cause queries to fail to find data. Adopt a consistent naming convention for fields in documents that share the same type. For example, don't use field names such as "first_name", "FirstName", and "forename" in different documents. Use the same field name in each document. Additionally, do not attempt to use values as keys (this is a common approach in Column-Family databases, but can cause inefficiencies and failures with Elasticsearch.) For more information, see <a href="https://www.elastic.co/blog/found-crash-elasticsearch#mapping-explosion">Mapping Explosion</a>.</li>
<li><p>Use <em>not_analyzed</em> to avoid tokenization where appropriate. For example, if a document contains a string field named <em>data</em> that holds the value "ABC-DEF" then you might attempt to perform a search for all documents that match this value as follows:</p>
<div class="codeHeader lang-http"><div class="copyBtn">Copy</div><div class="labelHolder">http</div></div><pre><code class="lang-http"><span class="hljs-attribute">GET /myindex/mydata/_search
{
  "query" </span>: {
    "<span class="hljs-attribute">filtered" </span>: {
      "<span class="hljs-attribute">filter" </span>: {
        "<span class="hljs-attribute">term" </span>: {
          "<span class="hljs-attribute">data" </span>: "ABC-DEF"
        }
      }
    }
  }
}
</code></pre><p>However, this search will fail to return the expected results due to the way in which the string ABC-DEF is tokenized when it is indexed. It will be effectively split into two tokens, ABC and DEF, by the hyphen. This feature is designed to support full text searching, but if you want the string to be interpreted as a single atomic item you should disable tokenization when the document is added to the index. You can use a mapping such as this:</p>
<div class="codeHeader lang-http"><div class="copyBtn">Copy</div><div class="labelHolder">http</div></div><pre><code class="lang-http"><span class="hljs-attribute">PUT /myindex
{
  "mappings" </span>: {
    "<span class="hljs-attribute">mydata" </span>: {
      "<span class="hljs-attribute">properties" </span>: {
        "<span class="hljs-attribute">data" </span>: {
          "<span class="hljs-attribute">type" </span>: "string",
          "<span class="hljs-attribute">index" </span>: "not_analyzed"
        }
      }
    }
  }
}
</code></pre><p>For more information, see <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/_finding_exact_values.html#_term_filter_with_text">Finding Exact Values</a>.</p>
</li>
<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8dd16ba9459c2ca211cd99de4b616f71:0">+
</a>
</span></ul>
<h3 id="using-doc-values">Using doc values</h3>
<p class="lf-text-block lf-block" data-lf-anchor-id="89d8ed6f473aaaf125c9b9d74b226af1:0">Many queries and aggregations require that data is sorted as part of the search operation. Sorting requires being able to map one or more terms to a list of documents. To assist in this process, Elasticsearch can load all of the values for a field used as a sort key into memory. This information is known as <em>fielddata</em>. The intent is that caching fielddata in memory incurs less I/O and might be faster than repeatedly reading the same data from disk. However, if a field has high cardinality then storing the fielddata in memory can consume a lot of heap space, possibly impacting the ability to perform other concurrent operations, or even exhausting storage causing Elasticsearch to fail.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="89d8ed6f473aaaf125c9b9d74b226af1:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="c94dcda745aea5e0254d99d64b256e59:0">As an alternative approach, Elasticsearch also supports <em>doc values</em>. A doc value is similar to an item of in-memory fielddata except that it is stored on disk and created when data is stored in an index (fielddata is constructed dynamically when a query is performed.) Doc values do not consume heap space, and so are useful for queries that sort or aggregate data across fields that can contain a very large number of unique values. Additionally, the reduced pressure on the heap can help to offset the performance differences between retrieving data from disk and reading from memory. Garbage collection is likely to occur less often, and other concurrent operations that utilize memory are less likely to be effected.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="c94dcda745aea5e0254d99d64b256e59:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="9a99a4cd7a92f1a639cb99c771816485:0">You enable or disable doc values on a per-property basis in an index using the <em>doc_values</em> attribute, as shown by the following example:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="9a99a4cd7a92f1a639cb99c771816485:0">+
</a>
</span></p>
<div class="codeHeader lang-http"><div class="copyBtn">Copy</div><div class="labelHolder">http</div></div><pre><code class="lang-http"><span class="hljs-attribute">PUT /myindex
{
  "mappings" </span>: {
    "<span class="hljs-attribute">mydata" </span>: {
      "<span class="hljs-attribute">properties" </span>: {
        "<span class="hljs-attribute">data" </span>: {
          ...
          "<span class="hljs-attribute">doc_values"</span>: true
        }
      }
    }
  }
}
</code></pre><div class="NOTE alert"><h5>Note</h5><p class="lf-text-block lf-block" data-lf-anchor-id="ca8d27cd971767f766e2cd8ff985748a:0">Doc values are enabled by default with Elasticsearch version 2.0.0 onwards.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="ca8d27cd971767f766e2cd8ff985748a:0">+
</a>
</span></p>
</div>
<p class="lf-text-block lf-block" data-lf-anchor-id="811dcfce10a6a1e215cd94d65721de2d:0">The exact impact of using doc values is likely to be highly specific to your own data and query scenarios, so be prepared to conduct performance testing to establish their usefulness. You should also note that doc values do not work with analyzed string fields. For more information, see <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/doc-values.html#doc-values">Doc Values</a>.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="811dcfce10a6a1e215cd94d65721de2d:0">+
</a>
</span></p>
<h3 id="using-replicas-to-reduce-query-contention">Using replicas to reduce query contention</h3>
<p class="lf-text-block lf-block" data-lf-anchor-id="89d90d6947bc2a9a11ccad475f256ead:0">A common strategy to boost the performance of queries is to create many replicas of each index. Data retrieval operations can be satisfied by fetching data from a replica. However, this strategy can severely impact the performance of data ingestion operations, so it needs to be used with care in scenarios that involve mixed workloads. Additionally, this strategy is only of benefit if replicas are distributed across nodes and do not compete for resources with primary shards that are part of the same index. Remember that it is possible to increase or decrease the number of replicas for an index dynamically.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="89d90d6947bc2a9a11ccad475f256ead:0">+
</a>
</span></p>
<h3 id="using-the-shard-request-cache">Using the shard request cache</h3>
<p class="lf-text-block lf-block" data-lf-anchor-id="8fe52f2d5fba66ca3109e8c745014ad5:0">Elasticsearch can cache the local data requested by queries on each shard in memory. This enables searches that retrieve the same data to run more quickly, data can be read from memory rather than disk storage. Caching data in this way can therefore improve the performance of some search operations, at the cost of reducing the memory available to other tasks being performed concurrently. There is also the risk that data served from the cache is outdated. The data in the cache is only invalidated when the shard is refreshed and the data has changed. The frequency of refreshes is governed by the value of the <em>refresh_interval</em> setting of the index.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8fe52f2d5fba66ca3109e8c745014ad5:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="03178bde4f8305f760ced8d75b2f76e3:0">The request caching for an index is disabled by default, but you can enable it as follows:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="03178bde4f8305f760ced8d75b2f76e3:0">+
</a>
</span></p>
<div class="codeHeader lang-http"><div class="copyBtn">Copy</div><div class="labelHolder">http</div></div><pre><code class="lang-http"><span class="hljs-attribute">PUT /myindex/_settings
{
  "index.requests.cache.enable"</span>: true
}
</code></pre><p class="lf-text-block lf-block" data-lf-anchor-id="ef507a46699b16c2a5cc9da674630adb:0">The shard request cache is most suitable for information that remains relatively static, such as historical or logging data.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="ef507a46699b16c2a5cc9da674630adb:0">+
</a>
</span></p>
<h3 id="using-client-nodes">Using client nodes</h3>
<p class="lf-text-block lf-block" data-lf-anchor-id="8fc47d0bdf99b2da39c999d75d264651:0">All queries are processed by the node that first receives the request. This node sends further requests to all other nodes containing shards for the indices being queried, and then accumulates the results for returning the response. If a query involves aggregating data or performing complex computations, the initial node is responsible for performing the appropriate processing. If your system has to support a relatively small number of complex queries, consider creating a pool of client nodes to alleviate the load from the data nodes. Conversely, if your system has to handle a large number of simple queries, then submit these requests direct to the data nodes, and use a load balancer to distribute the requests evenly.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8fc47d0bdf99b2da39c999d75d264651:0">+
</a>
</span></p>
<h3 id="tuning-queries">Tuning queries</h3>
<p class="lf-text-block lf-block" data-lf-anchor-id="8dc16d4e9fa9065b2621184ee5404e47:0">The following points summarize tips for maximizing the performance of Elasticsearch queries:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8dc16d4e9fa9065b2621184ee5404e47:0">+
</a>
</span></p>
<ul class="lf-text-block lf-block" data-lf-anchor-id="8dc46d6d459f66fb33c589c64b734e59:0">
<li>Avoid queries that involve wild cards wherever possible.</li>
<li>If the same field is subject to full-text searching and exact matching, then consider storing the data for the field in analyzed and nonanalyzed forms. Perform full-text searches against the analyzed field, and exact matches against the nonanalyzed field.</li>
<li>Only return the data necessary. If you have large documents, but an application only requires information held in a subset of the fields, then return this subset from queries rather than entire documents. This strategy can reduce the network bandwidth requirements of the cluster.</li>
<li>Wherever possible, use filters instead of queries when searching for data. A filter simply determines whether a document matches a given criterion whereas a query also calculates how close a match a document is (scoring). Internally, the values generated by a filter are stored as a bitmap indicating match/no match for each document, and they can be cached by Elasticsearch. If the same filter criterion occurs subsequently, the bitmap can be retrieved from cache and used to quickly fetch the matching documents. For more information, see <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/_finding_exact_values.html#_internal_filter_operation">Internal Filter Operation</a>.</li>
<li>Use <em>bool</em> filters for performing static comparisons, and only use <em>and</em>, <em>or</em>, and <em>not</em> filters for dynamically calculated filters, such as those that involve scripting or the <em>geo-\</em>* filters.</li>
<li><p>If a query combines <em>bool</em> filters with <em>and</em>, <em>or</em>, or <em>not</em> with <em>geo-</em>* filters, place the <em>and</em>/<em>or</em>/<em>not geo-</em>* filters last so that they operate on the smallest data set possible.</p>
<p>  Similarly, use a <em>post_filter</em> to run expensive filter operations. These filters will be performed last.</p>
</li>
<li><p>Use aggregations rather than facets. Avoid calculating aggregates that are analyzed or that have many possible values.</p>
<blockquote><p><strong>Note</strong>: Facets have been removed in Elasticsearch version 2.0.0.</p>
</blockquote>
</li>
<li>Use the <em>cardinality</em> aggregation in preference to the <em>value_count</em> aggregation unless your application requires an exact count of matching items. An exact count can become quickly outdated, and many applications only require a reasonable approximation.</li>
<li>Avoid scripting. Scripts in queries and filters can be expensive and the results are not cached. Long-running scripts can consume search threads indefinitely, causing subsequent requests to be queued. If the queue fills up, further requests will be rejected.</li>
<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8dc46d6d459f66fb33c589c64b734e59:0">+
</a>
</span></ul>
<h2 id="testing-and-analyzing-aggregation-and-search-performance">Testing and analyzing aggregation and search performance</h2>
<p class="lf-text-block lf-block" data-lf-anchor-id="9bf00514a39416d92ba4e843e10f32e9:0">This section describes the results of a series of tests that were performed against varying cluster and index configurations. Two types of tests were performed, as follows:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="9bf00514a39416d92ba4e843e10f32e9:0">+
</a>
</span></p>
<ul class="lf-text-block lf-block" data-lf-anchor-id="8fd4694955b9e4f3bbcdc8436d234673:0">
<li><strong>The <em>ingestion and query</em> test</strong>. This test started with an empty index that was populated as the test proceeded by performing bulk insert operations (each operation added 1000 documents). At the same time, a number of queries designed to search for documents added during the preceding 15 minute period and generate aggregations were repeated at 5 second intervals. This test was typically allowed to run for 24 hours, to reproduce the effects of a challenging workload comprising large-scale data ingestion with near real-time queries.</li>
<li><strong>The <em>query-only</em> test</strong>. This test is similar to the <em>ingestion and query</em> test except that the ingestion part is omitted, and the index on each node is prepopulated with 100 million documents. An amended set of queries is performed; the time element limiting documents to those added in the last 15 minutes was removed as the data was now static. The tests ran for 90 minutes, there is less time needed to establish a performance pattern due to the fixed amount of data.</li>
<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8fd4694955b9e4f3bbcdc8436d234673:0">+
</a>
</span></ul>
<hr>
<p class="lf-text-block lf-block" data-lf-anchor-id="8bd52c6fdfb064d61309e44765034357:0">Each document in the index had the same schema. This table summarizes the fields in the schema:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8bd52c6fdfb064d61309e44765034357:0">+
</a>
</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Organization</td>
<td>String</td>
<td>The test generates 200 unique organizations.</td>
</tr>
<tr>
<td>CustomField1 - CustomField5</td>
<td>String</td>
<td>These are five string fields which are set to the empty string.</td>
</tr>
<tr>
<td>DateTimeRecievedUtc</td>
<td>Timestamp</td>
<td>The date and time at which the document was added.</td>
</tr>
<tr>
<td>Host</td>
<td>String</td>
<td>This field is set to the empty string.</td>
</tr>
<tr>
<td>HttpMethod</td>
<td>String</td>
<td>This field is set to one of the following values: "POST","GET","PUT".</td>
</tr>
<tr>
<td>HttpReferrer</td>
<td>String</td>
<td>This field is set to the empty string.</td>
</tr>
<tr>
<td>HttpRequest</td>
<td>String</td>
<td>This field is populated with random text between 10 and 200 characters in length.</td>
</tr>
<tr>
<td>HttpUserAgent</td>
<td>String</td>
<td>This field is set to the empty string.</td>
</tr>
<tr>
<td>HttpVersion</td>
<td>String</td>
<td>This field is set to the empty string.</td>
</tr>
<tr>
<td>OrganizationName</td>
<td>String</td>
<td>This field is set to the same value as the Organization field.</td>
</tr>
<tr>
<td>SourceIp</td>
<td>IP</td>
<td>This field contains an IP address indicating the "origin" of the data.</td>
</tr>
<tr>
<td>SourceIpAreaCode</td>
<td>Long</td>
<td>This field is set to 0.</td>
</tr>
<tr>
<td>SourceIpAsnNr</td>
<td>String</td>
<td>This field is set to "AS#####".</td>
</tr>
<tr>
<td>SourceIpBase10</td>
<td>Long</td>
<td>This field is set to 500.</td>
</tr>
<tr>
<td>SourceIpCountryCode</td>
<td>String</td>
<td>This field contains a 2-character country code.</td>
</tr>
<tr>
<td>SourceIpCity</td>
<td>String</td>
<td>This field contains a string identifying a city in a country.</td>
</tr>
<tr>
<td>SourceIpLatitude</td>
<td>Double</td>
<td>This field contains a random value.</td>
</tr>
<tr>
<td>SourceIpLongitude</td>
<td>Double</td>
<td>This field contains a random value.</td>
</tr>
<tr>
<td>SourceIpMetroCode</td>
<td>Long</td>
<td>This field is set to 0.</td>
</tr>
<tr>
<td>SourceIpPostalCode</td>
<td>String</td>
<td>This field is set to the empty string.</td>
</tr>
<tr>
<td>SourceLatLong</td>
<td>Geo point</td>
<td>This field is set to a random geo point.</td>
</tr>
<tr>
<td>SourcePort</td>
<td>String</td>
<td>This field is populated with the string representation of a random number.</td>
</tr>
<tr>
<td>TargetIp</td>
<td>IP</td>
<td>This is populated with a random IP address in the range 0.0.100.100 to 255.9.100.100.</td>
</tr>
<tr>
<td>SourcedFrom</td>
<td>String</td>
<td>This field is set to the string "MonitoringCollector".</td>
</tr>
<tr>
<td>TargetPort</td>
<td>String</td>
<td>This field is populated with the string representation of a random number.</td>
</tr>
<tr>
<td>Rating</td>
<td>String</td>
<td>This field is populated with one of 20 different string values selected at random.</td>
</tr>
<tr>
<td>UseHumanReadableDateTimes</td>
<td>Boolean</td>
<td>This field is set to false.</td>
</tr>
</tbody>
</table>
<p class="lf-text-block lf-block" data-lf-anchor-id="8bd42c69cfbc26d31109e84749034353:0">The following queries were performed as a batch by each iteration of the tests. The names in italics are used to refer to these queries in the remainder of this document. Note that the time criterion (documents added in the last 15 minutes) was omitted from the <em>query-only</em> tests:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8bd42c69cfbc26d31109e84749034353:0">+
</a>
</span></p>
<ul class="lf-text-block lf-block" data-lf-anchor-id="93b59ced7f3a27a6b509e4ff03cb4f57:0">
<li>How many documents with each <em>Rating</em> value have been entered in the last 15 minutes (<em>Count By rating</em>)? </li>
<li>How many documents have been added in each 5 minute interval during the last 15 minutes (<em>Count over time</em>)?</li>
<li>How many documents of each <em>Rating</em> value have been added for each country in the last 15 minutes (<em>Hits by country</em>)?</li>
<li>Which 15 organizations occur most frequently in documents added in the last 15 minutes (<em>Top 15 organizations</em>)?</li>
<li>How many different organizations occur in documents added in the last 15 minutes (<em>Unique count organizations</em>)?</li>
<li>How many documents have been added in the last 15 minutes (<em>Total hits count</em>)?</li>
<li>How many different <em>SourceIp</em> values occur in documents added in the last 15 minutes (<em>Unique IP count</em>)?</li>
<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="93b59ced7f3a27a6b509e4ff03cb4f57:0">+
</a>
</span></ul>
<p class="lf-text-block lf-block" data-lf-anchor-id="8fc42d4dcfb964db3909e84367034247:0">The definition of the index and the details of the queries are outlined in the <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#appendix-the-query-and-aggregation-performance-test">appendix</a>.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8fc42d4dcfb964db3909e84367034247:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="0790ad494f99261119a98847c3034147:0">The tests were designed to understand the effects of the following variables:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="0790ad494f99261119a98847c3034147:0">+
</a>
</span></p>
<ul class="lf-text-block lf-block" data-lf-anchor-id="8fcc4d789b982ea82d21a84341075b2d:0">
<li><strong>Disk type</strong>. Tests were performed on a 6-node cluster of D4 VMs using standard storage (HDDs) and repeated on a 6-node cluster of DS4 VMs using premium storage (SSDs).</li>
<li><p><strong>Machine size - scaling up</strong>. Tests were performed on a 6-node cluster comprising DS3 VMs (designated as the <em>small</em> cluster), repeated on a cluster of DS4 VMs (the <em>medium</em> cluster), and repeated again on a cluster of DS14 machines (the <em>large</em> cluster). The following table summarizes the key characteristics of each VM SKU:</p>
<table>
<thead>
<tr>
<th>Cluster</th>
<th>VM SKU</th>
<th>Number of cores</th>
<th>Number of data disks</th>
<th>RAM (GB)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Small</td>
<td>Standard DS3</td>
<td>4</td>
<td>8</td>
<td>14</td>
</tr>
<tr>
<td>Medium</td>
<td>Standard DS4</td>
<td>8</td>
<td>16</td>
<td>28</td>
</tr>
<tr>
<td>Large</td>
<td>Standard DS14</td>
<td>16</td>
<td>32</td>
<td>112</td>
</tr>
</tbody>
</table>
</li>
<li><strong>Cluster size - scaling out</strong>. Tests were performed on clusters of DS14 VMs containing 1, 3, and 6 nodes.</li>
<li><strong>Number of index replicas</strong>. Tests were performed using indexes configured with 1 and 2 replicas.</li>
<li><strong>Doc values</strong>. Initially the tests were performed with the index setting <em>doc_values</em> set to <em>true</em> (the default value). Selected tests were repeated with <em>doc_values</em> set to <em>false</em>.</li>
<li><strong>Caching</strong>. Tests were conducted with the shard request cache enabled on the index.</li>
<li><strong>Number of shards</strong>. Tests were repeated using varying numbers of shards to establish whether queries ran more efficiently across indexes containing fewer, larger shards or more, smaller shards.</li>
<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8fcc4d789b982ea82d21a84341075b2d:0">+
</a>
</span></ul>
<h2 id="performance-results---disk-type">Performance results - disk type</h2>
<p class="lf-text-block lf-block" data-lf-anchor-id="87c42d6dde986e992a89a84b67034254:0">Disk performance was evaluated by running the <em>ingestion and query</em> test on the 6-node cluster of D4 VMs (using HDDs), and on the 6-node cluster of DS4 VMs (using SSDs). The configuration of Elasticsearch in both clusters was the same. The data was spread across 16 disks on each node, and each node had 14GB of RAM allocated to the Java virtual machine (JVM) running Elasticsearch, the remaining memory (also 14GB) was left for operating system use. Each test ran for 24 hours. This period was selected to enable the effects of the increasing volume of data to become apparent and to allow the system to stabilize. The table below summarizes the results, highlighting the response times of the various operations that comprised the test.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="87c42d6dde986e992a89a84b67034254:0">+
</a>
</span></p>
<table>
<thead>
<tr>
<th>Cluster</th>
<th>Operation/query</th>
<th>Average response time (ms)</th>
</tr>
</thead>
<tbody>
<tr>
<td>D4</td>
<td>Ingestion</td>
<td>978</td>
</tr>
<tr>
<td>Count By Rating</td>
<td>103</td>
<td></td>
</tr>
<tr>
<td>Count Over Time</td>
<td>134</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>199</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>137</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>139</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>510</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>89</td>
<td></td>
</tr>
<tr>
<td>DS4</td>
<td>Ingestion</td>
<td>511</td>
</tr>
<tr>
<td>Count By Rating</td>
<td>187</td>
<td></td>
</tr>
<tr>
<td>Count Over Time</td>
<td>411</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>402</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>307</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>320</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>841</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>236</td>
<td></td>
</tr>
</tbody>
</table>
<p class="lf-text-block lf-block" data-lf-anchor-id="9fb48ce95f9c328b3108e8c36903535d:0">At first glance, it would appear that the DS4 cluster performed queries less well than the D4 cluster, at times doubling (or worse) the response time. This does not tell the whole story though. The next table shows the number of ingestion operations performed by each cluster (remember that each operation loads 1000 documents):<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="9fb48ce95f9c328b3108e8c36903535d:0">+
</a>
</span></p>
<table>
<thead>
<tr>
<th>Cluster</th>
<th>Ingestion operation count</th>
</tr>
</thead>
<tbody>
<tr>
<td>D4</td>
<td>264769</td>
</tr>
<tr>
<td>DS4</td>
<td>503157</td>
</tr>
</tbody>
</table>
<p class="lf-text-block lf-block" data-lf-anchor-id="8ff40d6d4f9a74b1ab09a8d741015375:0">The DS4 cluster was able to load nearly twice as much data than the D4 cluster during the test. Therefore, when analyzing the response times for each operation, you also need to consider how many documents each query has to scan, and how many documents are returned. These are dynamic figures as the volume of documents in the index is continually growing. You cannot simply divide 503137 by 264769 (the number of ingestion operations performed by each cluster) and then multiply the result by the average response time for each query performed by the D4 cluster to give a comparative information as this ignores the amount of I/O being performed concurrently by the ingestion operation. Instead, you should measure the physical amount of data being written to and read from disk as the test proceeds. The JMeter test plan captures this information for each node. The summarized results are:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8ff40d6d4f9a74b1ab09a8d741015375:0">+
</a>
</span></p>
<table>
<thead>
<tr>
<th>Cluster</th>
<th>Average bytes written/read by each operation</th>
</tr>
</thead>
<tbody>
<tr>
<td>D4</td>
<td>13471557</td>
</tr>
<tr>
<td>DS4</td>
<td>24643470</td>
</tr>
</tbody>
</table>
<p class="lf-text-block lf-block" data-lf-anchor-id="81d02c6c31bc329a2909dcd369024a51:0">This data shows that the DS4 cluster was able to sustain an I/O rate approximately 1.8 times that of the D4 cluster. Given that, apart from nature of the disks, all other resources are the same, the difference must be due to using SSDs rather HDDs.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="81d02c6c31bc329a2909dcd369024a51:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8f74ec0deebca4b36109e8cb79035f43:0">To help justify this conclusion, the following graphs illustrate the how the I/O was performed over time by each cluster:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8f74ec0deebca4b36109e8cb79035f43:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:1"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance2.png" alt=""><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:1">+
</a>
</span></p>
<!-- -->
<p class="lf-text-block lf-block" data-lf-anchor-id="a5100f221d0166cc1a01015f62274651:0"><strong><em>Disk activity for the D4 and DS4 clusters</em></strong><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="a5100f221d0166cc1a01015f62274651:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8fd468294fb82ebb2909e8d365014255:0">The graph for the D4 cluster shows significant variation, especially during the first half of the test. This was likely due to throttling to reduce the I/O rate. In the initial stages of the test, the queries are able to run quickly as there is little data to analyze. The disks in the D4 cluster are therefore likely to be operating close to their input/output operations per second (IOPS) capacity, although each I/O operation might not be returning much data. The DS4 cluster is able to support a higher IOPS rate and does not suffer the same degree of throttling,  the I/O rates are more regular. To support this theory, the next pair of graphs show how the CPU was blocked by disk I/O over time (the disk wait times shown in the graphs are the proportion of the time that the CPU spent waiting for I/O):<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8fd468294fb82ebb2909e8d365014255:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:2"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance3.png" alt=""><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:2">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="c1540d2d0190a4d902410353790f4241:0"><strong><em>CPU disk I/O wait times for the D4 and DS4 clusters</em></strong><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="c1540d2d0190a4d902410353790f4241:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="0954e80d43bc2e9741e89992df224369:0">It is important to understand that there are two predominant reasons for I/O operations to block the CPU:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="0954e80d43bc2e9741e89992df224369:0">+
</a>
</span></p>
<ul class="lf-text-block lf-block" data-lf-anchor-id="8d64c52d4abb32b839ca89d74152ae8b:0">
<li>The I/O subsystem could be reading or writing data to or from disk.</li>
<li>The I/O subsystem could be throttled by the host environment. Azure disks implemented by using HDDs have a maximum throughput of 500 IOPS, and SSDs have a maximum throughput of 5000 IOPS.</li>
<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8d64c52d4abb32b839ca89d74152ae8b:0">+
</a>
</span></ul>
<p class="lf-text-block lf-block" data-lf-anchor-id="8bd42d2f4bb8a2fb3b49e9436d0b4a5d:0">For the D4 cluster, the amount of time spent waiting for I/O during the first half of the test correlates closely in an inverted manner with the graph showing the I/O rates. Periods of low I/O correspond to periods of significant time the CPU spends blocked,  this indicates that I/O is being throttled. As more data is added to the cluster the situation changes, and in the second half of the test peaks in I/O wait times correspond with peaks in I/O throughput. At this point, the CPU is blocked while performing real I/O. Again, with the DS4 cluster, the time spent waiting for I/O is much more even. Each peak matches an equivalent peak in I/O performance rather than a trough, this implies that there is little or no throttling occurring.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8bd42d2f4bb8a2fb3b49e9436d0b4a5d:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="0f151c05579870f2ab48a14344115373:0">There is one other factor to consider. During the test, the D4 cluster generated 10584 ingestion errors, and 21 query errors. The test on the DS4 cluster produced no errors.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="0f151c05579870f2ab48a14344115373:0">+
</a>
</span></p>
<h2 id="performance-results---scaling-up">Performance results - scaling up</h2>
<p class="lf-text-block lf-block" data-lf-anchor-id="8d744dfddd902cb9294db9436d675275:0">Scale-up testing was performed by running tests against 6-node clusters of DS3, DS4, and DS14 VMs. These SKUS were selected because a DS4 VM provides twice as many CPU cores and memory as a DS3, and a DS14 machine doubles the CPU resources again while providing four times the amount of memory. The table below compares the key aspects of each SKU:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8d744dfddd902cb9294db9436d675275:0">+
</a>
</span></p>
<table>
<thead>
<tr>
<th>SKU</th>
<th>#CPU cores</th>
<th>Memory (GB)</th>
<th>Max disk IOPS</th>
<th>Max bandwidth (MB/s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>DS3</td>
<td>4</td>
<td>14</td>
<td>12,800</td>
<td>128</td>
</tr>
<tr>
<td>DS4</td>
<td>8</td>
<td>28</td>
<td>25,600</td>
<td>256</td>
</tr>
<tr>
<td>DS14</td>
<td>16</td>
<td>112</td>
<td>50,000</td>
<td>512</td>
</tr>
</tbody>
</table>
<p class="lf-text-block lf-block" data-lf-anchor-id="8f445c6ddc9064db0a0de853c1034253:0">The following table summarizes the results of running the tests on the small (DS3), medium (DS4), and large (DS14) clusters. Each VM used SSDs to hold the data. Each test ran for 24 hours.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8f445c6ddc9064db0a0de853c1034253:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8bd42d6f4fa132f8324ea8c7630746f7:0">The table reports the number of successful requests for each type of query (failures are not included). The number of requests attempted for each type of query is roughly the same during a run of the test. This is because the JMeter test plan executes a single occurrence of each query (Count By Rating, Count Over Time, Hits By Country, Top 15 Organizations, Unique Count Organizations, Unique IP Count, and Total Hits Count ) together in a single unit known as a <em>test transaction</em> (this transaction is independent of the task that performs the ingestion operation, which is run by a separate thread). Each iteration of the test plan performs a single test transaction. The number of test transactions completed is therefore a measure of the response time of the slowest query in each transaction.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8bd42d6f4fa132f8324ea8c7630746f7:0">+
</a>
</span></p>
<table>
<thead>
<tr>
<th>Cluster</th>
<th>Operation/query</th>
<th>Number of requests</th>
<th>Average response time (ms)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Small (DS3)</td>
<td>Ingestion</td>
<td>207284</td>
<td>3328</td>
</tr>
<tr>
<td>Count By Rating</td>
<td>18444</td>
<td>268</td>
<td></td>
</tr>
<tr>
<td>Count Over Time</td>
<td>18444</td>
<td>340</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>18445</td>
<td>404</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>18439</td>
<td>323</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>18437</td>
<td>338</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>18442</td>
<td>468</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>18428</td>
<td>294</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Medium (DS4)</td>
<td>Ingestion</td>
<td>503157</td>
<td>511</td>
</tr>
<tr>
<td>Count By Rating</td>
<td>6958</td>
<td>187</td>
<td></td>
</tr>
<tr>
<td>Count Over Time</td>
<td>6958</td>
<td>411</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>6958</td>
<td>402</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>6958</td>
<td>307</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>6956</td>
<td>320</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>6955</td>
<td>841</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>6958</td>
<td>236</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Large (DS14)</td>
<td>Ingestion</td>
<td>502714</td>
<td>511</td>
</tr>
<tr>
<td>Count By Rating</td>
<td>7041</td>
<td>201</td>
<td></td>
</tr>
<tr>
<td>Count Over Time</td>
<td>7040</td>
<td>298</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>7039</td>
<td>363</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>7038</td>
<td>244</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>7037</td>
<td>283</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>7037</td>
<td>681</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>7038</td>
<td>200</td>
<td></td>
</tr>
</tbody>
</table>
<p class="lf-text-block lf-block" data-lf-anchor-id="8fd40d2bdd986cbb3b09c8434d074671:0">These figures show that, for this test, the performance of the DS4 and DS14 cluster were reasonably similar. The response times for the query operations for the DS3 cluster also appear to compare favorably initially, and the number of query operations performed is far in excess of the values for the DS4 and DS14 cluster. However, one should also take strong notice of the ingestion rate and the consequent number of documents being searched. In the DS3 cluster ingestion is far more constrained, and by the end of the test the database only contained about 40% of the documents read in by each of the other two clusters. This is could be due to the processing resources, network, and disk bandwidth available to a DS3 VM compared to a DS4 or DS14 VM. Given that a DS4 VM has twice as many resources available as a DS3 VM, and a DS14 has twice (four times for memory) the resources of a DS4 VM, one question remains: Why is the difference in ingestion rates between the DS4 and DS14 clusters significantly less than that which occurs between the DS3 and DS4 clusters? This could be due to the network utilization and bandwidth limits of Azure VMs. The graphs below show this data for all three clusters:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8fd40d2bdd986cbb3b09c8434d074671:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:3"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance4.png" alt=""><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:3">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="9b554f75dca164f33b49a9435d2746d7:0"><strong>Network utilization for the DS3, DS4, and DS14 clusters performing the ingestion and query test</strong> <span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="9b554f75dca164f33b49a9435d2746d7:0">+
</a>
</span></p>
<!-- -->
<p class="lf-text-block lf-block" data-lf-anchor-id="81642cafdfb82ecb3989e84757474375:0">The limits of available network bandwidth with Azure VMs are not published and can vary, but the fact that network activity appears to have levelled off at an average of around 2.75GBps for both the DS4 and DS14 tests suggests that such a limit has been reached and has become the primary factor in restricting throughput. In the case of the DS3 cluster, the network activity was considerably lower so the lower performance is more likely due to constraints in the availability of other resources.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="81642cafdfb82ecb3989e84757474375:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8b94ec655fba243bb941a84347034345:0">To isolate the effects of the ingestion operations and illustrate how query performance varies as nodes scale up, a set of query-only tests was performed using the same nodes. The following table summarizes the results obtained on each cluster:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8b94ec655fba243bb941a84347034345:0">+
</a>
</span></p>
<div class="NOTE alert"><h5>Note</h5><p class="lf-text-block lf-block" data-lf-anchor-id="8fa52ded47b9e4fbba07ec47470946fb:0">You should not compare the performance and number of requests executed by queries in the <em>query-only</em> test with those run by the <em>ingestion and query</em> test. This is because the queries have been modified and the volume of documents involved is different.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8fa52ded47b9e4fbba07ec47470946fb:0">+
</a>
</span></p>
</div>
<table>
<thead>
<tr>
<th>Cluster</th>
<th>Operation/query</th>
<th>Number of requests</th>
<th>Average response Ttme (ms)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Small (DS3)</td>
<td>Count By Rating</td>
<td>464</td>
<td>11758</td>
</tr>
<tr>
<td>Count Over Time</td>
<td>464</td>
<td>14699</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>463</td>
<td>14075</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>464</td>
<td>11856</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>462</td>
<td>12314</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>461</td>
<td>19898</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>462</td>
<td>8882</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Medium (DS4)</td>
<td>Count By Rating</td>
<td>1045</td>
<td>4489</td>
</tr>
<tr>
<td>Count Over Time</td>
<td>1045</td>
<td>7292</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>1053</td>
<td>7564</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>1055</td>
<td>5066</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>1051</td>
<td>5231</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>1051</td>
<td>9228</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>1051</td>
<td>2180</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Large (DS14)</td>
<td>Count By Rating</td>
<td>1842</td>
<td>1927</td>
</tr>
<tr>
<td>Count Over Time</td>
<td>1839</td>
<td>4483</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>1838</td>
<td>4761</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>1842</td>
<td>2117</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>1837</td>
<td>2393</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>1837</td>
<td>7159</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>1837</td>
<td>642</td>
<td></td>
</tr>
</tbody>
</table>
<p class="lf-text-block lf-block" data-lf-anchor-id="8fe42d6ddf9866d21909e84347010257:0">This time, the trends in the average response times across the different clusters is clearer. Network utilization is well below the 2.75GBps required earlier by the DS4 and DS14 clusters (which probably saturated the network in the ingestion and query tests), and the 1.5GBps for the DS3 cluster. In fact, it is closer to 200MBps in all cases as shown by the graphs below:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8fe42d6ddf9866d21909e84347010257:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:4"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance5.png" alt=""><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:4">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="83440e7c9c8064b72b49a943542144c3:0"><strong><em>Network utilization for the DS3, DS4 and DS14 clusters performing the query-only test</em></strong> <span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="83440e7c9c8064b72b49a943542144c3:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="83d47c2d5f8824b93bc8a8436725427d:0">The limiting factor in the DS3 and DS4 clusters now appears to be CPU utilization, which is close to 100% for much of the time. In the DS14 cluster the CPU usage averages just over 80%. This is still high, but clearly highlights the advantages of having more CPU cores available. The following image depicts the CPU usage patterns for the DS3, DS4, and DS14 clusters.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="83d47c2d5f8824b93bc8a8436725427d:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:5"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance6.png" alt=""><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:5">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8b557e6ddf9164f7bb41a8c3752142f7:0"><strong><em>CPU utilization for the DS3 and DS14 clusters performing the query-only test</em></strong> <span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8b557e6ddf9164f7bb41a8c3752142f7:0">+
</a>
</span></p>
<h2 id="performance-results---scaling-out">Performance results - scaling out</h2>
<p class="lf-text-block lf-block" data-lf-anchor-id="8a9d684cddb8a4b3bb85ac43772546f3:0">To illustrate how the system scales out with the number of nodes, tests were run using DS14 clusters containing 1, 3, and 6 nodes. This time, only the <em>query-only</em> test was performed, using 100 million documents and running for 90 minutes:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8a9d684cddb8a4b3bb85ac43772546f3:0">+
</a>
</span></p>
<table>
<thead>
<tr>
<th>Cluster</th>
<th>Operation/query</th>
<th>Number of requests</th>
<th>Average response time (ms)</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 Node</td>
<td>Count By Rating</td>
<td>288</td>
<td>6216</td>
</tr>
<tr>
<td>Count Over Time</td>
<td>288</td>
<td>28933</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>288</td>
<td>29455</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>288</td>
<td>9058</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>287</td>
<td>19916</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>284</td>
<td>54203</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>287</td>
<td>3333</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>3 Nodes</td>
<td>Count By Rating</td>
<td>1194</td>
<td>3427</td>
</tr>
<tr>
<td>Count Over Time</td>
<td>1194</td>
<td>5381</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>1191</td>
<td>6840</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>1196</td>
<td>3819</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>1190</td>
<td>2938</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>1189</td>
<td>12516</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>1191</td>
<td>1272</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>6 Nodes</td>
<td>Count By Rating</td>
<td>1842</td>
<td>1927</td>
</tr>
<tr>
<td>Count Over Time</td>
<td>1839</td>
<td>4483</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>1838</td>
<td>4761</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>1842</td>
<td>2117</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>1837</td>
<td>2393</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>1837</td>
<td>7159</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>1837</td>
<td>642</td>
<td></td>
</tr>
</tbody>
</table>
<p class="lf-text-block lf-block" data-lf-anchor-id="8fd4a479df98e6bf1b69e843770702df:0">The number of nodes makes a significant difference in the query performance of the cluster, although in a nonlinear manner. The 3 node cluster completes approximately 4 times as many queries as the single node cluster, while the 6 node cluster handles 6 times as many. To help explain this nonlinearity, the following graphs show how the CPU was being consumed by the three clusters:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8fd4a479df98e6bf1b69e843770702df:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:6"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance7.png" alt=""><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:6">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8fdc4e6ddf9967f7bbd1a953772102ff:0"><strong><em>CPU utilization for the 1, 3, and 6-node clusters performing the query-only test</em></strong><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8fdc4e6ddf9967f7bbd1a953772102ff:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="87955d2d47cc35bc89c1a01f52051eed:0">The single-node and 3-node clusters are CPU-bound, while although CPU utilization is high in the 6-node cluster there is spare processing capacity available. In this case, other factors are likely to be limiting the throughput. This could be confirmed by testing with 9 and 12 nodes, which would likely show further spare processing capacity.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="87955d2d47cc35bc89c1a01f52051eed:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8ff53c6b5d9a3c9b3909e8d749014edd:0">The data in the table above also shows how the average response times for the queries vary. This is the item that is most informative when testing how a system scales for specific types of query. Some searches are clearly far more efficient when spanning more nodes than others. This could be due to the ratio between the number of nodes and the number of documents in the cluster increasing, each cluster contained 100 million documents. When performing searches that involve aggregating data, Elasticsearch will process and buffer the data retrieved as part of the aggregation process in memory on each node. If there are more nodes, there is less data to retrieve, buffer, and process on each node.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8ff53c6b5d9a3c9b3909e8d749014edd:0">+
</a>
</span></p>
<h2 id="performance-results---number-of-replicas">Performance results - number of replicas</h2>
<p class="lf-text-block lf-block" data-lf-anchor-id="ba416d55df9875d52b69cc436107427b:0">The <em>ingestion and query</em> tests were run against an index with a single replica. The tests were repeated on the 6-node DS4 and DS14 clusters using an index configured with two replicas. All tests ran for 24 hours. The table below shows the comparative results for one and two replicas:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="ba416d55df9875d52b69cc436107427b:0">+
</a>
</span></p>
<table>
<thead>
<tr>
<th>Cluster</th>
<th>Operation/query</th>
<th>Average response time (ms) - 1 replica</th>
<th>Average response time (ms) - 2 replicas</th>
<th>% difference in response time</th>
</tr>
</thead>
<tbody>
<tr>
<td>DS4</td>
<td>Ingestion</td>
<td>511</td>
<td>655</td>
<td>+28%</td>
</tr>
<tr>
<td>Count By Rating</td>
<td>187</td>
<td>168</td>
<td>-10%</td>
<td></td>
</tr>
<tr>
<td>Count Over Time</td>
<td>411</td>
<td>309</td>
<td>-25%</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>402</td>
<td>562</td>
<td>+40%</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>307</td>
<td>366</td>
<td>+19%</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>320</td>
<td>378</td>
<td>+18%</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>841</td>
<td>987</td>
<td>+17%</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>236</td>
<td>236</td>
<td>+0%</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>DS14</td>
<td>Ingestion</td>
<td>511</td>
<td>618</td>
<td>+21%</td>
</tr>
<tr>
<td>Count By Rating</td>
<td>201</td>
<td>275</td>
<td>+37%</td>
<td></td>
</tr>
<tr>
<td>Count Over Time</td>
<td>298</td>
<td>466</td>
<td>+56%</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>363</td>
<td>529</td>
<td>+46%</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>244</td>
<td>407</td>
<td>+67%</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>283</td>
<td>403</td>
<td>+42%</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>681</td>
<td>823</td>
<td>+21%</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>200</td>
<td>221</td>
<td>+11%</td>
<td></td>
</tr>
</tbody>
</table>
<p class="lf-text-block lf-block" data-lf-anchor-id="8fd42c699f1820e32f48e94365044715:0">The ingestion rate decreased as the number of replicas increased. This should be expected as Elasticsearch is writing more copies of each document, generating additional disk I/O.  This is reflected by the graphs for the DS14 cluster for indexes with 1 and 2 replicas shown in the image below. In the case of the index with 1 replica, the average I/O rate was 16896573 bytes/second. For the index with 2 replicas, the average I/O rate was 33986843 bytes/second, just over twice as many.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8fd42c699f1820e32f48e94365044715:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:7"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance8.png" alt=""><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:7">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8f5c4d79942960f3ea4549434c1566e9:0"><strong><em>Disk I/O rates for nodes with 1 and 2 replicas performing the ingestion and query test</em></strong><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8f5c4d79942960f3ea4549434c1566e9:0">+
</a>
</span></p>
<table>
<thead>
<tr>
<th>Cluster</th>
<th>Query</th>
<th>Average response time (ms) - 1 replica</th>
<th>Average response time (ms) - 2 replicas</th>
</tr>
</thead>
<tbody>
<tr>
<td>DS4</td>
<td>Count By Rating</td>
<td>4489</td>
<td>4079</td>
</tr>
<tr>
<td>Count Over Time</td>
<td>7292</td>
<td>6697</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>7564</td>
<td>7173</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>5066</td>
<td>4650</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>5231</td>
<td>4691</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>9228</td>
<td>8752</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>2180</td>
<td>1909</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>DS14</td>
<td>Count By Rating</td>
<td>1927</td>
<td>2330</td>
</tr>
<tr>
<td>Count Over Time</td>
<td>4483</td>
<td>4381</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>4761</td>
<td>5341</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>2117</td>
<td>2560</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>2393</td>
<td>2546</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>7159</td>
<td>7048</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>642</td>
<td>708</td>
<td></td>
</tr>
</tbody>
</table>
<p class="lf-text-block lf-block" data-lf-anchor-id="15f40fad8f9aafb30da9ad4b670b426b:0">These results show an improvement in average response time for the DS4 cluster, but an increase for the DS14 cluster. To help interpret these results, you should also consider the number of queries performed by each test:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="15f40fad8f9aafb30da9ad4b670b426b:0">+
</a>
</span></p>
<table>
<thead>
<tr>
<th>Cluster</th>
<th>Query</th>
<th>Number performed - 1 replica</th>
<th>Number performed - 2 replicas</th>
</tr>
</thead>
<tbody>
<tr>
<td>DS4</td>
<td>Count By Rating</td>
<td>1054</td>
<td>1141</td>
</tr>
<tr>
<td>Count Over Time</td>
<td>1054</td>
<td>1139</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>1053</td>
<td>1138</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>1055</td>
<td>1141</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>1051</td>
<td>1136</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>1051</td>
<td>1135</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>1051</td>
<td>1136</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>DS14</td>
<td>Count By Rating</td>
<td>1842</td>
<td>1718</td>
</tr>
<tr>
<td>Count Over Time</td>
<td>1839</td>
<td>1716</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>1838</td>
<td>1714</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>1842</td>
<td>1718</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>1837</td>
<td>1712</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>1837</td>
<td>1712</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>1837</td>
<td>1712</td>
<td></td>
</tr>
</tbody>
</table>
<p class="lf-text-block lf-block" data-lf-anchor-id="83f42c6ddf88269b3149ec4377214a7f:0">This data shows that the number of queries performed by the DS4 cluster increased in line with the decrease in average response time, but again the converse is true of the DS14 cluster. One significant factor is that the CPU utilization of the DS4 cluster in the 1-replica and 2-replica tests was unevenly spread. Some nodes exhibited close to 100% utilization while others had spare processing capacity. The improvement in performance is most likely due to the increased ability to distribute processing across the nodes of the cluster. The following image shows the variation in CPU processing between the most lightly and heavily used VMs (nodes 4 and 3):<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="83f42c6ddf88269b3149ec4377214a7f:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:8"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance9.png" alt=""><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:8">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8bd4bc6d9f88e7f7b9c1a953732149fb:0"><strong><em>CPU utilization for the least used and most used nodes in the DS4 cluster performing the query-only test</em></strong><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8bd4bc6d9f88e7f7b9c1a953732149fb:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8b506d019f9d34993981b84165874a71:0">For the DS14 cluster this was not the case. CPU utilization for both tests was lower across all nodes, and the availability of a second replica became less of an advantage and more of an overhead:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8b506d019f9d34993981b84165874a71:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:9"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance10.png" alt=""><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:9">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8bd4bc6d9f8c64f7b9c1a9c3732149ff:0"><strong><em>CPU utilization for the least used and most used nodes in the DS14 cluster performing the query-only test</em></strong><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8bd4bc6d9f8c64f7b9c1a9c3732149ff:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="05f56c6bd79841a02eeb09d641615571:0">These results show the need to benchmark your system carefully when deciding whether to use multiple replicas. You should always have at least one replica of each index (unless you are willing to risk losing data if a node fails), but additional replicas can impose a burden on the system for little benefit, depending on your workloads and the hardware resources available to the cluster.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="05f56c6bd79841a02eeb09d641615571:0">+
</a>
</span></p>
<h2 id="performance-results---doc-values">Performance results - doc values</h2>
<p class="lf-text-block lf-block" data-lf-anchor-id="9719cdf55f9ae6f50a89a943490740ff:0">The <em>ingestion and query</em> tests were conducted with doc values enabled, causing Elasticsearch to store data used for sorting fields on disk. The tests were repeated with doc values disabled, so Elasticsearch constructed fielddata dynamically and cached it in memory. All tests ran for 24 hours. The table below compares the response times for tests run against clusters of 6 nodes built using D4, DS4, and DS14 VMs (the D4 cluster uses regular hard disks, while the DS4 and DS14 clusters use SSDs).<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="9719cdf55f9ae6f50a89a943490740ff:0">+
</a>
</span></p>
<table>
<thead>
<tr>
<th>Cluster</th>
<th>Operation/query</th>
<th>Average response time (ms) - doc values enabled</th>
<th>Average response time (ms) - doc values disabled</th>
<th>% difference in response time</th>
</tr>
</thead>
<tbody>
<tr>
<td>D4</td>
<td>Ingestion</td>
<td>978</td>
<td>835</td>
<td>-15%</td>
</tr>
<tr>
<td>Count By Rating</td>
<td>103</td>
<td>132</td>
<td>+28%</td>
<td></td>
</tr>
<tr>
<td>Count Over Time</td>
<td>134</td>
<td>189</td>
<td>+41%</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>199</td>
<td>259</td>
<td>+30%</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>137</td>
<td>184</td>
<td>+34%</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>139</td>
<td>197</td>
<td>+42%</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>510</td>
<td>604</td>
<td>+18%</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>89</td>
<td>134</td>
<td>+51%</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>DS4</td>
<td>Ingestion</td>
<td>511</td>
<td>581</td>
<td>+14%</td>
</tr>
<tr>
<td>Count By Rating</td>
<td>187</td>
<td>190</td>
<td>+2%</td>
<td></td>
</tr>
<tr>
<td>Count Over Time</td>
<td>411</td>
<td>409</td>
<td>-0.5%</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>402</td>
<td>414</td>
<td>+3%</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>307</td>
<td>284</td>
<td>-7%</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>320</td>
<td>313</td>
<td>-2%</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>841</td>
<td>955</td>
<td>+14%</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>236</td>
<td>281</td>
<td>+19%</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>DS14</td>
<td>Ingestion</td>
<td>511</td>
<td>571</td>
<td>+12%</td>
</tr>
<tr>
<td>Count By Rating</td>
<td>201</td>
<td>232</td>
<td>+15%</td>
<td></td>
</tr>
<tr>
<td>Count Over Time</td>
<td>298</td>
<td>341</td>
<td>+14%</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>363</td>
<td>457</td>
<td>+26%</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>244</td>
<td>338</td>
<td>+39%</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>283</td>
<td>350</td>
<td>+24%</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>681</td>
<td>909</td>
<td>+33%</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>200</td>
<td>245</td>
<td>+23%</td>
<td></td>
</tr>
</tbody>
</table>
<p class="lf-text-block lf-block" data-lf-anchor-id="9bf82c4dffb266db3b29e8436f034347:0">The next table compares the number of ingestion operations performed by the tests:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="9bf82c4dffb266db3b29e8436f034347:0">+
</a>
</span></p>
<table>
<thead>
<tr>
<th>Cluster</th>
<th>Ingestion operation count  - doc values enabled</th>
<th>Ingestion Operation count - doc values disabled</th>
<th>% difference in \number of ingestion operations</th>
</tr>
</thead>
<tbody>
<tr>
<td>D4</td>
<td>264769</td>
<td>408690</td>
<td>+54%</td>
</tr>
<tr>
<td>DS4</td>
<td>503137</td>
<td>578237</td>
<td>+15%</td>
</tr>
<tr>
<td>DS14</td>
<td>502714</td>
<td>586472</td>
<td>+17%</td>
</tr>
</tbody>
</table>
<p class="lf-text-block lf-block" data-lf-anchor-id="8b14edef7d9b66f33349c0c74b016691:0">The improved ingestion rates occur with doc values disabled as less data is being written to disk as documents are inserted. The improved performance is especially noticeable with the D4 VM using HDDs to store data. In this case, the response time for ingestion operations also decreased by 15% (see the first table in this section). This could be due to the reduced pressure on the HDDs which were likely running close to their IOPS limits in the test with doc values enabled, see the Disk Type test for more information. The following graph compares the I/O performance of the D4 VMs with doc values enabled (values held on disk) and doc values disabled (values held in memory):<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8b14edef7d9b66f33349c0c74b016691:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:10"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance11.png" alt=""><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:10">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="a70085431e1be4e72201014640274621:0"><strong><em>Disk activity for the D4 cluster with doc values enabled and disabled</em></strong><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="a70085431e1be4e72201014640274621:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8bd48deddf9b6fbb3f49a8c34d07424d:0">In contrast, the ingestion values for the VMs using SSDs show a small increase in the number of documents but also an increase in the response time of the ingestion operations. With one or two small exceptions, the query response times were also worse. The SSDs are less likely to be running close to their IOPS limits with doc values enabled, so changes in performance are more likely due to increased processing activity and the overhead of managing the JVM heap. This is evident by comparing the CPU utilization with doc values enabled and disabled. The next graph highlights this data for the DS4 cluster, where most of the CPU utilization moves from the 30%-40% band with doc values enabled, to the 40%-50% band with doc values disabled (the DS14 cluster showed a similar trend):<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8bd48deddf9b6fbb3f49a8c34d07424d:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:11"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance12.png" alt=""><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:11">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8114cded9e02a5b33460010241a75629:0"><strong><em>CPU utilization for the DS4 cluster with doc values enabled and disabled</em></strong><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8114cded9e02a5b33460010241a75629:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8b5ccded9f92e4f52b6988434507606d:0">To distinguish the effects of doc values on query performance from data ingestion, pairs of query-only tests were performed for the DS4 and DS14 clusters with doc values enabled and disabled. The table below summarizes the results of these tests:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8b5ccded9f92e4f52b6988434507606d:0">+
</a>
</span></p>
<table>
<thead>
<tr>
<th>Cluster</th>
<th>Operation/query</th>
<th>Average response time (ms) - doc values enabled</th>
<th>Average response time (ms) - doc values disabled</th>
<th>% difference in response time</th>
</tr>
</thead>
<tbody>
<tr>
<td>DS4</td>
<td>Count By Rating</td>
<td>4489</td>
<td>3736</td>
<td>-16%</td>
</tr>
<tr>
<td>Count Over Time</td>
<td>7293</td>
<td>5459</td>
<td>-25%</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>7564</td>
<td>5930</td>
<td>-22%</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>5066</td>
<td>3874</td>
<td>-14%</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>5231</td>
<td>4483</td>
<td>-2%</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>9228</td>
<td>9474</td>
<td>+3%</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>2180</td>
<td>1218</td>
<td>-44%</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>DS14</td>
<td>Count By Rating</td>
<td>1927</td>
<td>2144</td>
<td>+11%</td>
</tr>
<tr>
<td>Count Over Time</td>
<td>4483</td>
<td>4337</td>
<td>-3%</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>4761</td>
<td>4840</td>
<td>+2%</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>2117</td>
<td>2302</td>
<td>+9%</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>2393</td>
<td>2497</td>
<td>+4%</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>7159</td>
<td>7639</td>
<td>+7%</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>642</td>
<td>633</td>
<td>-1%</td>
<td></td>
</tr>
</tbody>
</table>
<p class="lf-text-block lf-block" data-lf-anchor-id="8285a5ef4f9a0fb7276980834d05440d:0">Remember that, with Elasticsearch 2.0 onwards, doc values are enabled by default. In the tests covering the DS4 cluster, disabling doc values appears to have a positive effect overall, whereas the converse is generally true for the DS14 cluster (the two cases where performance is better with doc values disabled are very marginal).<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8285a5ef4f9a0fb7276980834d05440d:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="9914af094f88388925c9b8d67f265e45:0">For the DS4 cluster, CPU utilization in both cases was close to 100% for the duration of both tests indicating that the cluster was CPU bound. However, the number of queries processed decreased from 7369 to 5894 (20%). Remember that if doc values are disabled Elasticsearch will dynamically generate fielddata in memory, and this consumes CPU power. This configuration has reduced the rate of disk I/O but increased stress on CPUs already running close to their maximum capabilities, so in this case queries are faster with doc values disabled but there are fewer of them.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="9914af094f88388925c9b8d67f265e45:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="b38c2d694f82a5e331c3e401480742cd:0">In the DS14 tests with and without doc values CPU activity was high, but not 100%. The number of queries performed was slightly higher (approximately 4%) in tests with doc values enabled:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="b38c2d694f82a5e331c3e401480742cd:0">+
</a>
</span></p>
<table>
<thead>
<tr>
<th>Cluster</th>
<th>Query</th>
<th>Number performed - doc values enabled</th>
<th>Number performed - doc values disabled</th>
</tr>
</thead>
<tbody>
<tr>
<td>DS4</td>
<td>Count By Rating</td>
<td>1054</td>
<td>845</td>
</tr>
<tr>
<td>Count Over Time</td>
<td>1054</td>
<td>844</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>1053</td>
<td>842</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>1055</td>
<td>846</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>1051</td>
<td>839</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>1051</td>
<td>839</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>1051</td>
<td>839</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>DS14</td>
<td>Count By Rating</td>
<td>1772</td>
<td>1842</td>
</tr>
<tr>
<td>Count Over Time</td>
<td>1772</td>
<td>1839</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>1770</td>
<td>1838</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>1773</td>
<td>1842</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>1769</td>
<td>1837</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>1768</td>
<td>1837</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>1769</td>
<td>1837</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="performance-results---shard-request-cache">Performance results - shard request cache</h2>
<p class="lf-text-block lf-block" data-lf-anchor-id="0fc52d6ddd9924d31b4de8c365034357:0">To demonstrate how the caching index data in the memory of each node can impact performance, the <em>query and ingestion</em> test was conducted on a DS4 and a DS14 6-node cluster with index caching enabled - see the section <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#using-the-shard-request-cache">Using the shard request cache</a> for more information. The results were compared to those generated by the earlier tests using the same index but with index caching disabled. The table below summarizes the results. Note that the data has been curtailed to cover only the first 90 minutes of the test, at this point the comparative trend was apparent and continuing the test would probably have not yielded any additional insights:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="0fc52d6ddd9924d31b4de8c365034357:0">+
</a>
</span></p>
<table>
<thead>
<tr>
<th>Cluster</th>
<th>Operation/query</th>
<th>Average response time (ms) - index cache disabled</th>
<th>Average response time (ms) - index cache enabled</th>
<th>% difference in response time</th>
</tr>
</thead>
<tbody>
<tr>
<td>DS4</td>
<td>Ingestion</td>
<td>504</td>
<td>3260</td>
<td>+547%</td>
</tr>
<tr>
<td>Count By Rating</td>
<td>218</td>
<td>273</td>
<td>+25%</td>
<td></td>
</tr>
<tr>
<td>Count Over Time</td>
<td>450</td>
<td>314</td>
<td>-30%</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>447</td>
<td>397</td>
<td>-11%</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>342</td>
<td>317</td>
<td>-7%</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>370</td>
<td>324</td>
<td>-12%%</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>760</td>
<td>355</td>
<td>-53%</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>258</td>
<td>291</td>
<td>+12%</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>DS14</td>
<td>Ingestion</td>
<td>503</td>
<td>3365</td>
<td>+569%</td>
</tr>
<tr>
<td>Count By Rating</td>
<td>234</td>
<td>262</td>
<td>+12%</td>
<td></td>
</tr>
<tr>
<td>Count Over Time</td>
<td>357</td>
<td>298</td>
<td>-17%</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>416</td>
<td>383</td>
<td>-8%</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>272</td>
<td>324</td>
<td>-7%</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>330</td>
<td>321</td>
<td>-3%</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>674</td>
<td>352</td>
<td>-48%</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>227</td>
<td>292</td>
<td>+29%</td>
<td></td>
</tr>
</tbody>
</table>
<p class="lf-text-block lf-block" data-lf-anchor-id="9abbdd9a492498d8957e10c7df400ae6:0">This data shows two points of interest:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="9abbdd9a492498d8957e10c7df400ae6:0">+
</a>
</span></p>
<ul class="lf-text-block lf-block" data-lf-anchor-id="8bb58d4f5a8414b83b4ea8d74b335229:0">
<li>Data ingestion rates appear to be greatly diminished by enabling index caching.</li>
<li>Index caching does not necessarily improve the response time of all types of query, and can have an adverse effect on certain aggregate operations such as those performed by the Count By Rating and Total Hits Count  queries.</li>
<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8bb58d4f5a8414b83b4ea8d74b335229:0">+
</a>
</span></ul>
<p class="lf-text-block lf-block" data-lf-anchor-id="8d94ac095fb122991909ec4b21035255:0">To understand why the system exhibits this behavior, you should consider the number of queries successfully performed in each case during the test runs. The following table summarizes this data:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8d94ac095fb122991909ec4b21035255:0">+
</a>
</span></p>
<table>
<thead>
<tr>
<th>Cluster</th>
<th>Operation/query</th>
<th>Operations/queries count - index cache disabled</th>
<th>Operations/queries count - index cache enabled</th>
</tr>
</thead>
<tbody>
<tr>
<td>DS4</td>
<td>Ingestion</td>
<td>38611</td>
<td>13232</td>
</tr>
<tr>
<td>Count By Rating</td>
<td>524</td>
<td>18704</td>
<td></td>
</tr>
<tr>
<td>Count Over Time</td>
<td>523</td>
<td>18703</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>522</td>
<td>18702</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>521</td>
<td>18706</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>521</td>
<td>18700</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>521</td>
<td>18699</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>521</td>
<td>18701</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>DS14</td>
<td>Ingestion</td>
<td>38769</td>
<td>12835</td>
</tr>
<tr>
<td>Count By Rating</td>
<td>528</td>
<td>19239</td>
<td></td>
</tr>
<tr>
<td>Count Over Time</td>
<td>528</td>
<td>19239</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>528</td>
<td>19238</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>527</td>
<td>19240</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>524</td>
<td>19234</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>524</td>
<td>19234</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>527</td>
<td>19236</td>
<td></td>
</tr>
</tbody>
</table>
<p class="lf-text-block lf-block" data-lf-anchor-id="87d92d4e45bc24fb38e9d8d36f276a5b:0">You can see that although the ingestion rate when caching was enabled was approximately 1/3 of that when caching was disabled, the number of queries performed increased by a factor of 34. Queries no longer incur as much disk I/O and did not have to compete for disk resources. This is reflected by the graphs in the figure below that compare the I/O activity for all four cases:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="87d92d4e45bc24fb38e9d8d36f276a5b:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:12"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance13.png" alt=""><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:12">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="0b5c09410421e4f16ac1494740174663:0"><strong><em>Disk I/O activity for the ingestion and query test with index caching disabled and enabled</em></strong><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="0b5c09410421e4f16ac1494740174663:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="93d42c050dbce6b7fb4cc8576f384275:0">The decrease in disk I/O also meant that the CPU spent less time waiting for I/O to complete. This is highlighted by the next figure:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="93d42c050dbce6b7fb4cc8576f384275:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:13"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance14.png" alt=""><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:13">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="835449430539e4f1eac5111648374429:0"><strong><em>CPU time spent waiting for disk I/O to complete for the ingestion and query test with index caching disabled and enabled</em></strong><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="835449430539e4f1eac5111648374429:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="89dcbc2d4f3a2f9ab1e9f88367254a51:0">The reduction in disk I/O meant that Elasticsearch could spend a much greater proportion of its time servicing queries from data held in memory. This increased CPU utilization, which becomes apparent if you look at the CPU utilization for all four cases. The graphs below show how CPU use was more sustained with caching enabled:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="89dcbc2d4f3a2f9ab1e9f88367254a51:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:14"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance15.png" alt=""><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:14">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="0b5d0d45142365f11ad608470127567b:0"><strong><em>CPU utilization for the ingestion and query test with index caching disabled and enabled</em></strong><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="0b5d0d45142365f11ad608470127567b:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8fc42c6ddf9126db2b89e8436c074247:0">The volume of network I/O in both scenarios for the duration of the tests was broadly similar. The tests without caching showed a gradual degradation during the test period, but the longer, 24 hour runs of these tests showed that this statistic levelled off at approximately 2.75GBps. The image below shows this data for the DS4 clusters (the data for the DS14 clusters was very similar):<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8fc42c6ddf9126db2b89e8436c074247:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:15"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance16.png" alt=""><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:15">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="0f1d2df71d316df13ac75847532746eb:0"><strong><em>Network traffic volumes for the ingestion and query test with index caching disabled and enabled</em></strong><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="0f1d2df71d316df13ac75847532746eb:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="83442ded5dad7ddc318de84773654215:0">As described in the <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#performance-results-scaling-up">scaling up</a> test, the restrictions to network bandwidth with Azure VMs are not published and can vary, but the moderate levels of CPU and disk activity suggests that network utilization may be the limiting factor in this scenario.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="83442ded5dad7ddc318de84773654215:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="039d0cec9dbba0731ba9e8434d0b83ff:0">Caching is more naturally suited to scenarios where data changes infrequently. To highlight the impact of caching in this scenario, the <em>query-only</em> tests were performed with caching enabled. The results are shown below (these tests ran for 90 minute, and the indexes under test contained 100 million documents):<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="039d0cec9dbba0731ba9e8434d0b83ff:0">+
</a>
</span></p>
<table>
<thead>
<tr>
<th>Cluster</th>
<th>Query</th>
<th>Average response time (ms)</th>
<th>Number of Queries Performed</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Cache disabled</strong></td>
<td><strong>Cache enabled</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>DS4</td>
<td>Count By Rating</td>
<td>4489</td>
<td>210</td>
</tr>
<tr>
<td>Count Over Time</td>
<td>7292</td>
<td>211</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>7564</td>
<td>231</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>5066</td>
<td>211</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>5231</td>
<td>211</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>9228</td>
<td>218</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>2180</td>
<td>210</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>DS14</td>
<td>Count By Rating</td>
<td>1927</td>
<td>211</td>
</tr>
<tr>
<td>Count Over Time</td>
<td>4483</td>
<td>219</td>
<td></td>
</tr>
<tr>
<td>Hits By Country</td>
<td>4761</td>
<td>236</td>
<td></td>
</tr>
<tr>
<td>Top 15 Organizations</td>
<td>2117</td>
<td>212</td>
<td></td>
</tr>
<tr>
<td>Unique Count Organizations</td>
<td>2393</td>
<td>212</td>
<td></td>
</tr>
<tr>
<td>Unique IP Count</td>
<td>7159</td>
<td>220</td>
<td></td>
</tr>
<tr>
<td>Total Hits Count</td>
<td>642</td>
<td>211</td>
<td></td>
</tr>
</tbody>
</table>
<p class="lf-text-block lf-block" data-lf-anchor-id="87d46c6d4f986ed32b09c843680242dd:0">The variance in the performance of the noncached tests is due to the difference in resources available between the DS4 and DS14 VMs. In both cases of the cached test the average response time dropped significantly as data was being retrieved directly from memory. It is also worth noting that the response times for the cached DS4 and DS14 cluster tests were very similar despite the disparity with the noncached results. There is also very little difference between the response times for each query within each test, they all take approximately 220ms. The disk I/O rates and CPU utilization for both clusters were very low as once all the data is in memory little I/O or processing is required. The network I/O rate was similar to that of the uncached tests, confirming that network bandwidth may be a limiting factor in this test. The following graphs present this information for the DS4 cluster. The profile of the DS14 cluster was very similar:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="87d46c6d4f986ed32b09c843680242dd:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:16"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance17.png" alt=""><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:16">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="495d0f452ca2b1f5abc17983512146ed:0"><strong><em>Disk I/O, CPU utilization, and network utilization for the query-only test with index caching enabled</em></strong><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="495d0f452ca2b1f5abc17983512146ed:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="87e42dee9d9a2693390ced4377254b47:0">The figures in the table above suggest that using the DS14 architecture shows little benefit over using the DS4. In fact, the number of samples generated by the DS14 cluster was about 5% below that of the DS4 cluster, but this could also be due to network restrictions which can vary slightly over time.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="87e42dee9d9a2693390ced4377254b47:0">+
</a>
</span></p>
<h2 id="performance-results---number-of-shards">Performance results - number of shards</h2>
<p class="lf-text-block lf-block" data-lf-anchor-id="8bda2d496fb1883d6fa8d847e7054a46:0">The purpose of this test was to determine whether the number of shards created for an index has any bearing on the query performance of that index.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8bda2d496fb1883d6fa8d847e7054a46:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="81d02d690fb004355d6998c7c705465d:0">Separate tests conducted previously showed that the shard configuration of an index can impact the rate of data ingestion. The tests conducted to determine query performance followed a similar methodology, but were restricted to a 6-node cluster running on DS14 hardware. This approach helps to minimize the number of variables, so any differences in performance should be due to the volume of shards.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="81d02d690fb004355d6998c7c705465d:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8fcc2c6ddfb960d33a09e84365034757:0">The <em>query-only</em> test was conducted on copies of the same index configured with 7, 13, 23, 37, and 61 primary shards. The index contained 100 million documents and had a single replica, doubling the number of shards across the cluster. Each test ran for 90 minutes. The following table summarizes the results. The average response time shown is the response time for the JMeter test transaction that encompasses the complete set of queries performed by each iteration of the test. See the note in the section <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#performance-results-scaling-up">Performance results - scaling up</a> for more information:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8fcc2c6ddfb960d33a09e84365034757:0">+
</a>
</span></p>
<table>
<thead>
<tr>
<th>Number of shards</th>
<th>Shard layout (shards per node, including replicas)</th>
<th>Number of queries performed</th>
<th>Avg response time (ms)</th>
</tr>
</thead>
<tbody>
<tr>
<td>7 (14 including replicas)</td>
<td>3-2-2-2-2-3</td>
<td>7461</td>
<td>40524</td>
</tr>
<tr>
<td>13 (26)</td>
<td>5-4-5-4-4-4</td>
<td>7369</td>
<td>41055</td>
</tr>
<tr>
<td>23 (46)</td>
<td>7-8-8-7-8-8</td>
<td>14193</td>
<td>21283</td>
</tr>
<tr>
<td>37 (74)</td>
<td>13-12-12-13-12-12</td>
<td>13399</td>
<td>22506</td>
</tr>
<tr>
<td>61 (122)</td>
<td>20-21-20-20-21-20</td>
<td>14743</td>
<td>20445</td>
</tr>
</tbody>
</table>
<p class="lf-text-block lf-block" data-lf-anchor-id="8ed44d6dd789a0fbb981c84767072e71:0">These results indicate that there is a significant difference in performance between the 13(26) shard cluster and the 23,(46) shard cluster, throughput nearly doubles and response times halve. This is most likely due to the configuration of the VMs and the structures that Elasticsearch uses to process search requests. Search requests are queued, and each search request is handled by a single search thread. The number of search threads created by an Elasticsearch node is a function of the number of processors available on the machine hosting the node. The results suggest that with only 4 or 5 shards on a node, processing resources are not being fully utilized. This is supported by looking at the CPU utilization while running this test. The following image is a snapshot taken from Marvel while performing the 13(26) shard test:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8ed44d6dd789a0fbb981c84767072e71:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:17"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance18.png" alt=""><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:17">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8b966e4d9f9ad2fbba60aac16523597f:0"><strong><em>CPU utilization for the query-only test on the 7(14) shard cluster</em></strong><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8b966e4d9f9ad2fbba60aac16523597f:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="0be4afed65494bf0bfadace3e7036acd:0">Compare these figures with those of the 23(46) shard test:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="0be4afed65494bf0bfadace3e7036acd:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:18"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/query-performance19.png" alt=""><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="d41d8cd98f00b204e9800998ecf8427e:18">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="cbcc7cedff92e0f1bb81a8c361215b7f:0"><strong><em>CPU utilization for the query-only test on the 23(46) shard cluster</em></strong><span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="cbcc7cedff92e0f1bb81a8c361215b7f:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="87cc0d6f5fb802b93ca9f947c7076a5d:0">In the 23(46) shard test, CPU utilization was far higher. Each node contains 7 or 8 shards. The DS14 architecture provides 16 processors, and Elasticsearch is better able to exploit this number of cores with the additional shards. The figures in the table above suggest that increasing the number of shards beyond this point may improve performance slightly, but you should offset these figures against the additional overhead of maintaining a high volume of shards. These tests imply that the optimal number of shards per node is half the number of processor cores available on each node. However, remember that these results were achieved when only running queries. If your system imports data, you should also consider how sharding can impact the performance of data ingestion operations. <span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="87cc0d6f5fb802b93ca9f947c7076a5d:0">+
</a>
</span></p>
<h2 id="summary">Summary</h2>
<p class="lf-text-block lf-block" data-lf-anchor-id="01d16daa54bee4b920c79d9e59224479:0">Elasticsearch provides many options that you can use to structure indexes and tune them to support large-scale query operations. This document has summarized some common configurations and techniques that you can use to tune your database for query purposes. However, you should recognize that there is a tradeoff between optimizing a database to support fast retrieval as opposed to supporting high-volume data ingestion. Sometimes what is good for querying can have a detrimental impact on insert operations and vice versa. In a system that is exposed to mixed workloads, you need to assess where the balance lies and adjust the system parameters accordingly.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="01d16daa54bee4b920c79d9e59224479:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8fc42d6d5f9964d83989a8474547625f:0">Additionally, the applicability of different configurations and techniques can vary depending on the structure of the data and the limitations (or otherwise) of the hardware the system is constructed on. Many of the tests shown in this document illustrate how the selection of the hardware platform can impact throughput, and also how some strategies can be beneficial in certain cases but detrimental in others. The important point is to understand the options available and then perform rigorous benchmarking using your own data to determine the most optimal combination.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8fc42d6d5f9964d83989a8474547625f:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="0135690d45afa0b505cd0d575b214639:0">Finally, remember that an Elasticsearch database is not necessarily a static item. It will likely grow over time, and the strategies used to structure the data may need to be revised regularly. For example, it may be necessary to scale up, scale out, or reindex data with additional shards. As the system increases in size and complexity, be prepared to continually test performance to ensure that you are still meeting any SLAs guaranteed to your customers.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="0135690d45afa0b505cd0d575b214639:0">+
</a>
</span></p>
<h2 id="appendix-the-query-and-aggregation-performance-test">Appendix: the query and aggregation performance test</h2>
<p class="lf-text-block lf-block" data-lf-anchor-id="8d816dcbef9b66fb2bcb884367070cd7:0">This appendix describes the performance test performed against the Elasticsearch cluster. The tests were run by using JMeter running on a separate set of VMs. Details the configuration of the test environment are described in <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-creating-performance-testing-environment">Creating a performance testing environment for Elasticsearch on Azure</a>. To perform your own testing, you can create your own JMeter test plan manually following the guidance in this appendix, or you can use the automated test scripts available separately. For more information, see <a href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-running-automated-performance-tests">Running the automated Elasticsearch performance tests</a>.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8d816dcbef9b66fb2bcb884367070cd7:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="8dc46de95fb92e8ab149a8c34f032247:0">The data query workload performed the set of queries described below while performing a large-scale upload of documents at the same time. The purpose of this workload was to simulate a production environment where new data is constantly being added while searches are performed. The queries were structured to retrieve only the most recent data from documents added in the last 15 minutes.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="8dc46de95fb92e8ab149a8c34f032247:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="9bdd2d6fdf9822b13b89fc4745074bdd:0">Each document was stored in a single index named <em>idx</em>, and had the type <em>doc</em>. You can use the following HTTP request to create the index. The <em>number_of_replicas</em> and <em>number_of_shards</em> settings varied from the values shown below in many of the tests. Additionally, for the tests that used fielddata rather than doc values, each property was annotated with the attribute <em>"doc_values" : false</em>.<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="9bdd2d6fdf9822b13b89fc4745074bdd:0">+
</a>
</span></p>
<p class="lf-text-block lf-block" data-lf-anchor-id="81910825043370916a0c0fc13b475474:0"><strong>Important</strong>: The index was dropped and recreated prior to each test run. <span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="81910825043370916a0c0fc13b475474:0">+
</a>
</span></p>
<div class="codeHeader lang-http"><div class="copyBtn">Copy</div><div class="labelHolder">http</div></div><pre><code class="lang-http"><span class="hljs-attribute">PUT /idx
{  
    "settings" </span>: {
        "<span class="hljs-attribute">number_of_replicas"</span>: 1,
        "<span class="hljs-attribute">refresh_interval"</span>: "30s",
        "<span class="hljs-attribute">number_of_shards"</span>: "5",
        "<span class="hljs-attribute">index.translog.durability"</span>: "async"    
    },
    "<span class="hljs-attribute">doc"</span>: {
        "<span class="hljs-attribute">mappings"</span>: {
            "<span class="hljs-attribute">event"</span>: {
                "<span class="hljs-attribute">_all"</span>: {
                    "<span class="hljs-attribute">enabled"</span>: false
                },
                "<span class="hljs-attribute">_timestamp"</span>: {
                    "<span class="hljs-attribute">enabled"</span>: true,
                    "<span class="hljs-attribute">store"</span>: true,
                    "<span class="hljs-attribute">format"</span>: "date_time"
                },
                "<span class="hljs-attribute">properties"</span>: {
                    "<span class="hljs-attribute">Organization"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">CustomField1"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">CustomField2"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">CustomField3"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">CustomField4"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">CustomField5"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">DateTimeReceivedUtc"</span>: {
                        "<span class="hljs-attribute">type"</span>: "date",
                        "<span class="hljs-attribute">format"</span>: "dateOptionalTime"
                    },
                    "<span class="hljs-attribute">Host"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">HttpMethod"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">HttpReferrer"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">HttpRequest"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">HttpUserAgent"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">HttpVersion"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">OrganizationName"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">SourceIp"</span>: {
                        "<span class="hljs-attribute">type"</span>: "ip"
                    },
                    "<span class="hljs-attribute">SourceIpAreaCode"</span>: {
                        "<span class="hljs-attribute">type"</span>: "long"
                    },
                    "<span class="hljs-attribute">SourceIpAsnNr"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">SourceIpBase10"</span>: {
                        "<span class="hljs-attribute">type"</span>: "long"
                    },
                    "<span class="hljs-attribute">SourceIpCity"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">SourceIpCountryCode"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">SourceIpLatitude"</span>: {
                        "<span class="hljs-attribute">type"</span>: "double"
                    },
                    "<span class="hljs-attribute">SourceIpLongitude"</span>: {
                        "<span class="hljs-attribute">type"</span>: "double"
                    },
                    "<span class="hljs-attribute">SourceIpMetroCode"</span>: {
                        "<span class="hljs-attribute">type"</span>: "long"
                    },
                    "<span class="hljs-attribute">SourceIpPostalCode"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">SourceIpRegion"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">SourceLatLong"</span>: {
                        "<span class="hljs-attribute">type"</span>: "geo_point",
                        "<span class="hljs-attribute">doc_values"</span>: true,
                        "<span class="hljs-attribute">lat_lon"</span>: true,
                        "<span class="hljs-attribute">geohash"</span>: true
                    },
                    "<span class="hljs-attribute">SourcePort"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">SourcedFrom"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">TargetIp"</span>: {
                        "<span class="hljs-attribute">type"</span>: "ip"
                    },
                    "<span class="hljs-attribute">TargetPort"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">Rating"</span>: {
                        "<span class="hljs-attribute">type"</span>: "string",
                        "<span class="hljs-attribute">index"</span>: "not_analyzed"
                    },
                    "<span class="hljs-attribute">UseHumanReadableDateTimes"</span>: {
                        "<span class="hljs-attribute">type"</span>: "boolean"
                    }
                }
            }
        }
    }
}
</code></pre><p class="lf-text-block lf-block" data-lf-anchor-id="0d852c4cc69956d341404c4303010243:0">The following queries were performed by the test:<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="0d852c4cc69956d341404c4303010243:0">+
</a>
</span></p>
<ul class="lf-text-block lf-block" data-lf-anchor-id="97bccde4a7aba120fe082ec312994b23:0">
<li><p>How many documents with each Rating value have been entered in the last 15 minutes?</p>
<div class="codeHeader lang-http"><div class="copyBtn">Copy</div><div class="labelHolder">http</div></div><pre><code class="lang-http"><span class="hljs-attribute">GET /idx/doc/_search
{
  "query"</span>: {
    "<span class="hljs-attribute">bool"</span>: {
      "<span class="hljs-attribute">must"</span>: [
        {
          "<span class="hljs-attribute">range"</span>: {
            "<span class="hljs-attribute">DateTimeReceivedUtc"</span>: {
              "<span class="hljs-attribute">gte"</span>: "now-15m",
              "<span class="hljs-attribute">lte"</span>: "now"
            }
          }
        }
      ],
      "<span class="hljs-attribute">must_not"</span>: [],
      "<span class="hljs-attribute">should"</span>: []
    }
  },
  "<span class="hljs-attribute">from"</span>: 0,
  "<span class="hljs-attribute">size"</span>: 0,
  "<span class="hljs-attribute">aggs"</span>: {
    "<span class="hljs-attribute">2"</span>: {
      "<span class="hljs-attribute">terms"</span>: {
        "<span class="hljs-attribute">field"</span>: "Rating",
        "<span class="hljs-attribute">size"</span>: 5,
        "<span class="hljs-attribute">order"</span>: {
          "<span class="hljs-attribute">_count"</span>: "desc"
        }
      }
    }
  }
}
</code></pre></li>
<li><p>How many documents have been added in each 5 minute interval during the last 15 minutes?</p>
<div class="codeHeader lang-http"><div class="copyBtn">Copy</div><div class="labelHolder">http</div></div><pre><code class="lang-http"><span class="hljs-attribute">GET /idx/doc/_search
{
  "query"</span>: {
    "<span class="hljs-attribute">bool"</span>: {
      "<span class="hljs-attribute">must"</span>: [
        {
          "<span class="hljs-attribute">range"</span>: {
            "<span class="hljs-attribute">DateTimeReceivedUtc"</span>: {
              "<span class="hljs-attribute">gte"</span>: "now-15m",
              "<span class="hljs-attribute">lte"</span>: "now"
            }
          }
        }
      ],
      "<span class="hljs-attribute">must_not"</span>: [],
      "<span class="hljs-attribute">should"</span>: []
    }
  },
  "<span class="hljs-attribute">from"</span>: 0,
  "<span class="hljs-attribute">size"</span>: 0,
  "<span class="hljs-attribute">sort"</span>: [],
  "<span class="hljs-attribute">aggs"</span>: {
    "<span class="hljs-attribute">2"</span>: {
      "<span class="hljs-attribute">date_histogram"</span>: {
        "<span class="hljs-attribute">field"</span>: "DateTimeReceivedUtc",
        "<span class="hljs-attribute">interval"</span>: "5m",
        "<span class="hljs-attribute">time_zone"</span>: "America/Los_Angeles",
        "<span class="hljs-attribute">min_doc_count"</span>: 1,
        "<span class="hljs-attribute">extended_bounds"</span>: {
          "<span class="hljs-attribute">min"</span>: "now-15m",
          "<span class="hljs-attribute">max"</span>: "now"
        }
      }
    }
  }
}
</code></pre></li>
<li><p>How many documents of each Rating value have been added for each country in the last 15 minutes?</p>
<div class="codeHeader lang-HTTP"><div class="copyBtn">Copy</div><div class="labelHolder">HTTP</div></div><pre><code class="lang-HTTP"><span class="hljs-attribute">GET /idx/doc/_search
{
  "query"</span>: {
    "<span class="hljs-attribute">filtered"</span>: {
      "<span class="hljs-attribute">query"</span>: {
        "<span class="hljs-attribute">query_string"</span>: {
          "<span class="hljs-attribute">query"</span>: "*",
          "<span class="hljs-attribute">analyze_wildcard"</span>: true
        }
      },
      "<span class="hljs-attribute">filter"</span>: {
        "<span class="hljs-attribute">bool"</span>: {
          "<span class="hljs-attribute">must"</span>: [
            {
              "<span class="hljs-attribute">query"</span>: {
                "<span class="hljs-attribute">query_string"</span>: {
                  "<span class="hljs-attribute">query"</span>: "*",
                  "<span class="hljs-attribute">analyze_wildcard"</span>: true
                }
              }
            },
            {
              "<span class="hljs-attribute">range"</span>: {
                "<span class="hljs-attribute">DateTimeReceivedUtc"</span>: {
                  "<span class="hljs-attribute">gte"</span>: "now-15m",
                  "<span class="hljs-attribute">lte"</span>: "now"
                }
              }
            }
          ],
          "<span class="hljs-attribute">must_not"</span>: []
        }
      }
    }
  },
  "<span class="hljs-attribute">size"</span>: 0,
  "<span class="hljs-attribute">aggs"</span>: {
    "<span class="hljs-attribute">2"</span>: {
      "<span class="hljs-attribute">terms"</span>: {
        "<span class="hljs-attribute">field"</span>: "Rating",
        "<span class="hljs-attribute">size"</span>: 5,
        "<span class="hljs-attribute">order"</span>: {
          "<span class="hljs-attribute">_count"</span>: "desc"
        }
      },
      "<span class="hljs-attribute">aggs"</span>: {
        "<span class="hljs-attribute">3"</span>: {
          "<span class="hljs-attribute">terms"</span>: {
            "<span class="hljs-attribute">field"</span>: "SourceIpCountryCode",
            "<span class="hljs-attribute">size"</span>: 15,
            "<span class="hljs-attribute">order"</span>: {
              "<span class="hljs-attribute">_count"</span>: "desc"
            }
          }
        }
      }
    }
  }
}
</code></pre></li>
<li><p>Which 15 organizations occur most frequently in documents added in the last 15 minutes?</p>
<div class="codeHeader lang-http"><div class="copyBtn">Copy</div><div class="labelHolder">http</div></div><pre><code class="lang-http"><span class="hljs-attribute">GET /idx/doc/_search
{
  "query"</span>: {
    "<span class="hljs-attribute">filtered"</span>: {
      "<span class="hljs-attribute">query"</span>: {
        "<span class="hljs-attribute">query_string"</span>: {
          "<span class="hljs-attribute">query"</span>: "*",
          "<span class="hljs-attribute">analyze_wildcard"</span>: true
        }
      },
      "<span class="hljs-attribute">filter"</span>: {
        "<span class="hljs-attribute">bool"</span>: {
          "<span class="hljs-attribute">must"</span>: [
            {
              "<span class="hljs-attribute">query"</span>: {
                "<span class="hljs-attribute">query_string"</span>: {
                  "<span class="hljs-attribute">query"</span>: "*",
                  "<span class="hljs-attribute">analyze_wildcard"</span>: true
                }
              }
            },
            {
              "<span class="hljs-attribute">range"</span>: {
                "<span class="hljs-attribute">DateTimeReceivedUtc"</span>: {
                  "<span class="hljs-attribute">gte"</span>: "now-15m",
                  "<span class="hljs-attribute">lte"</span>: "now"
                }
              }
            }
          ],
          "<span class="hljs-attribute">must_not"</span>: []
        }
      }
    }
  },
  "<span class="hljs-attribute">size"</span>: 0,
  "<span class="hljs-attribute">aggs"</span>: {
    "<span class="hljs-attribute">2"</span>: {
      "<span class="hljs-attribute">terms"</span>: {
        "<span class="hljs-attribute">field"</span>: "Organization",
        "<span class="hljs-attribute">size"</span>: 15,
        "<span class="hljs-attribute">order"</span>: {
          "<span class="hljs-attribute">_count"</span>: "desc"
        }
      }
    }
  }
}
</code></pre></li>
<li><p>How many different organizations occur in documents added in the last 15 minutes?</p>
<div class="codeHeader lang-http"><div class="copyBtn">Copy</div><div class="labelHolder">http</div></div><pre><code class="lang-http"><span class="hljs-attribute">GET /idx/doc/_search
{
  "query"</span>: {
    "<span class="hljs-attribute">filtered"</span>: {
      "<span class="hljs-attribute">query"</span>: {
        "<span class="hljs-attribute">query_string"</span>: {
          "<span class="hljs-attribute">query"</span>: "*",
          "<span class="hljs-attribute">analyze_wildcard"</span>: true
        }
      },
      "<span class="hljs-attribute">filter"</span>: {
        "<span class="hljs-attribute">bool"</span>: {
          "<span class="hljs-attribute">must"</span>: [
            {
              "<span class="hljs-attribute">query"</span>: {
                "<span class="hljs-attribute">query_string"</span>: {
                  "<span class="hljs-attribute">query"</span>: "*",
                  "<span class="hljs-attribute">analyze_wildcard"</span>: true
                }
              }
            },
            {
              "<span class="hljs-attribute">range"</span>: {
                "<span class="hljs-attribute">DateTimeReceivedUtc"</span>: {
                  "<span class="hljs-attribute">gte"</span>: "now-15m",
                  "<span class="hljs-attribute">lte"</span>: "now"
                }
              }
            }
          ],
          "<span class="hljs-attribute">must_not"</span>: []
        }
      }
    }
  },
  "<span class="hljs-attribute">size"</span>: 0,
  "<span class="hljs-attribute">aggs"</span>: {
    "<span class="hljs-attribute">2"</span>: {
      "<span class="hljs-attribute">cardinality"</span>: {
        "<span class="hljs-attribute">field"</span>: "Organization"
      }
    }
  }
}
</code></pre></li>
<li><p>How many documents have been added in the last 15 minutes?</p>
<div class="codeHeader lang-http"><div class="copyBtn">Copy</div><div class="labelHolder">http</div></div><pre><code class="lang-http"><span class="hljs-attribute">GET /idx/doc/_search
{
  "query"</span>: {
    "<span class="hljs-attribute">filtered"</span>: {
      "<span class="hljs-attribute">query"</span>: {
        "<span class="hljs-attribute">query_string"</span>: {
          "<span class="hljs-attribute">query"</span>: "*",
          "<span class="hljs-attribute">analyze_wildcard"</span>: true
        }
      },
      "<span class="hljs-attribute">filter"</span>: {
        "<span class="hljs-attribute">bool"</span>: {
          "<span class="hljs-attribute">must"</span>: [
            {
              "<span class="hljs-attribute">query"</span>: {
                "<span class="hljs-attribute">query_string"</span>: {
                  "<span class="hljs-attribute">analyze_wildcard"</span>: true,
                  "<span class="hljs-attribute">query"</span>: "*"
                }
              }
            },
            {
              "<span class="hljs-attribute">range"</span>: {
                "<span class="hljs-attribute">DateTimeReceivedUtc"</span>: {
                  "<span class="hljs-attribute">gte"</span>: "now-15m",
                  "<span class="hljs-attribute">lte"</span>: "now"
                }
              }
            }
          ],
          "<span class="hljs-attribute">must_not"</span>: []
        }
      }
    }
  },
  "<span class="hljs-attribute">size"</span>: 0,
  "<span class="hljs-attribute">aggs"</span>: {}
}
</code></pre></li>
<li><p>How many different SourceIp values occur in documents added in the last 15 minutes?</p>
<div class="codeHeader lang-http"><div class="copyBtn">Copy</div><div class="labelHolder">http</div></div><pre><code class="lang-http"><span class="hljs-attribute">GET /idx/doc/_search
{
  "query"</span>: {
    "<span class="hljs-attribute">filtered"</span>: {
      "<span class="hljs-attribute">query"</span>: {
        "<span class="hljs-attribute">query_string"</span>: {
          "<span class="hljs-attribute">query"</span>: "*",
          "<span class="hljs-attribute">analyze_wildcard"</span>: true
        }
      },
      "<span class="hljs-attribute">filter"</span>: {
        "<span class="hljs-attribute">bool"</span>: {
          "<span class="hljs-attribute">must"</span>: [
            {
              "<span class="hljs-attribute">query"</span>: {
                "<span class="hljs-attribute">query_string"</span>: {
                  "<span class="hljs-attribute">query"</span>: "*",
                  "<span class="hljs-attribute">analyze_wildcard"</span>: true
                }
              }
            },
            {
              "<span class="hljs-attribute">range"</span>: {
                "<span class="hljs-attribute">DateTimeReceivedUtc"</span>: {
                  "<span class="hljs-attribute">gte"</span>: "now-15m",
                  "<span class="hljs-attribute">lte"</span>: "now"
                }
              }
            }
          ],
          "<span class="hljs-attribute">must_not"</span>: []
        }
      }
    }
  },
  "<span class="hljs-attribute">size"</span>: 0,
  "<span class="hljs-attribute">aggs"</span>: {
    "<span class="hljs-attribute">2"</span>: {
      "<span class="hljs-attribute">cardinality"</span>: {
        "<span class="hljs-attribute">field"</span>: "SourceIp"
      }
    }
  }
}
</code></pre></li>
<span class="lf-thread-btn"><a class="fycon-action-view" tabindex="0" data-lf-anchor-id="97bccde4a7aba120fe082ec312994b23:0">+
</a>
</span></ul>
</div></div>

          

          <div id="comments-container" role="form"><div class="fyre fyre-width-medium"><div class="fyre-widget "><div class="fyre-featured-content-wrapper" style="display: none"></div><div class="fyre-stream-stats"><div class="fyre-comment-count"><span>0 comments</span></div><div class="fyre-help"><div class="fyre-box-wrapper"><a class="fyre-logo-link" href="http://livefyre.com/" target="_blank"><img class="fyre-logo-drop" src="https://d3qdfnco3bamip.cloudfront.net/wjs/v3.0.1481843438/images/down_arrow.png" alt="Down arrow"><img class="fyre-logo-help" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Livefyre"></a><ul class="fyre-box-list"><li><a href="http://livefyre.com/" target="_blank" title="Get Livefyre">Get Livefyre</a></li><li><a href="http://support.livefyre.com/" target="_blank" title="FAQ">FAQ</a></li></ul></div></div></div><div class="fyre-auth"><div class="fyre-login-bar"><a rel="nofollow" class="fyre-user-loggedout">Sign in</a></div><div class="fyre-live-container"><div class="fyre-livecount"><em class="fyre-stream-livecount">0 people listening</em></div><div class="fyre-listener-avatars"></div></div></div><div class="fyre-editor"><div class="fyre-editor-container fyre-editor-container-focus"><div class="fyre-editor-editable editable fyre-editor-field" id="fyre-editor-3" g_editable="true" role="textbox" contenteditable="true"><p>&nbsp;</p></div><span class="fyre-editor-spinner" style="display: none;"></span><div class="fyre-editor-preview"></div><div class="fyre-editor-media-drawer" style="display: none;"></div><div class="fyre-editor-toolbar"><div class="fyre-mention-menu fyre-mention-menu-vertical" role="menu" aria-haspopup="true" style="user-select: none; display: none;"><div class="fyre-mention-menu-filter" style="user-select: none;"><div style="user-select: none;"></div><input type="text" aria-autocomplete="list" aria-owns=":h.content-el" aria-expanded="true" tabindex="-1" style="user-select: none;"></div><div class="fyre-mention-menu-content" id=":h.content-el" style="user-select: none;"><div class="goog-control goog-control-disabled" aria-disabled="true" id=":e" style="user-select: none;"></div><div class="goog-control goog-control-disabled" aria-disabled="true" id=":f" style="user-select: none;"></div><div class="goog-control goog-control-disabled" aria-disabled="true" id=":g" style="user-select: none;"></div><div class="fyre-mention-item fyre-mention-item-twitter" aria-hidden="true" id=":i" style="user-select: none; display: none;"><img src="https://dpstvy7p9whsy.cloudfront.net/a/anon/50.jpg" class="fyre-mention-item-avatar"><h4 class="fyre-mention-item-display-name"></h4><span class="fyre-mention-item-twitter"></span></div><div class="fyre-mention-item fyre-mention-item-livefyre" aria-hidden="true" id=":j" style="user-select: none; display: none;"><img src="https://dpstvy7p9whsy.cloudfront.net/a/anon/50.jpg" class="fyre-mention-item-avatar"><h4 class="fyre-mention-item-display-name"></h4><span class="fyre-mention-item-livefyre"></span></div></div></div><div class="goog-toolbar goog-toolbar-horizontal" role="toolbar" style="user-select: none;"><div class="goog-toolbar-separator goog-inline-block" role="separator" id=":b" style="user-select: none;">&nbsp;</div><div class="goog-inline-block fyre-button-left fyre-format-button" role="button" id=":d" style="user-select: none;"><div class="goog-inline-block fyre-button-left-outer-box"><div class="goog-inline-block fyre-button-left-inner-box"></div></div></div><div class="goog-inline-block fyre-button-left fyre-mention-button" role="button" id=":l" style="user-select: none;"><div class="goog-inline-block fyre-button-left-outer-box"><div class="goog-inline-block fyre-button-left-inner-box"></div></div></div><div class="goog-inline-block fyre-button-left fyre-embed-button" role="button" id=":n" aria-hidden="true" style="user-select: none; display: none;"><div class="goog-inline-block fyre-button-left-outer-box"><div class="goog-inline-block fyre-button-left-inner-box"></div></div></div><div class="goog-inline-block fyre-button-left fyre-raw-button" role="button" id=":p" style="user-select: none; display: none;"><div class="goog-inline-block fyre-button-left-outer-box"><div class="goog-inline-block fyre-button-left-inner-box"></div></div></div><div class="goog-inline-block fyre-button-left fyre-follow-button" role="button" id=":r" style="user-select: none;"><div class="goog-inline-block fyre-button-left-outer-box"><div class="goog-inline-block fyre-button-left-inner-box">+ Follow</div></div></div><div class="goog-inline-block fyre-button-right fyre-share-button" role="button" id=":t" style="user-select: none;"><div class="goog-inline-block fyre-button-right-outer-box"><div class="goog-inline-block fyre-button-right-inner-box">Share<label class="fyre-share-counter fyre-share-empty"></label></div></div></div><div class="goog-inline-block fyre-button-right fyre-post-button fyre-post-button-new" role="button" id=":v" style="user-select: none;"><div class="goog-inline-block fyre-button-right-outer-box"><div class="goog-inline-block fyre-button-right-inner-box">Post comment as...</div></div></div></div></div></div><div class="fyre-comment-preview" style="display: none;"><h5>Custom HTML Preview<span class="fyre-icon-remove"></span></h5><div class="fyre-roundedpanel-content fyre-comment-preview-content"><article class="fyre-comment-article"><div class="fyre-comment"><div class="fyre-comment-raw-html"></div></div></article></div></div></div><div class="fyre-input-box-collapsed"></div><div class="fyre-stream-header"><div class="fyre-content-loading" style="display: none;">Loading</div><div class="fyre-stream-sort"><div class="fyre-stream-sort-options"><a class="fyre-stream-sort-newest fyre-stream-sort-selected">Newest</a><span class="fyre-stream-sort-bar"> | </span><a class="fyre-stream-sort-oldest">Oldest</a></div><a class="fyre-stream-sort-back"></a></div></div><div class="fyre-comment-stream"><div class="fyre-stream-content"></div><div class="fyre-stream-content-not-found"></div><div class="fyre-stream-more" style="display: none;"><div class="fyre-stream-more-container"><div class="fyre-text">Show More Comments</div><div class="fyre-spinner"><img src="https://d3qdfnco3bamip.cloudfront.net/wjs/v3.0.1481843438/images/snake-loader.gif" alt=""></div></div></div></div><div class="fyre-top-content-stream"></div><div class="fyre-thread-breakout-stream"></div><div class="fyre-stream-menu-container"></div></div></div></div>
        </div>
      </div>

      <div id="openFeedbackContainer" class="openfeedback-container or-t-ml" role="complementary" style="z-index: 1000;"></div>

    </main>

    <footer id="footer" ms.pgarea="footer" class="footer-layout">
  <div class="container" role="contentinfo">

    <select id="locale-picker" aria-label="Change Page Language"><option data-id="cs-cz" dir="ltr">Čeština</option><option data-id="de-de" dir="ltr">Deutsch</option><option data-id="en-us" selected="" dir="ltr">English</option><option data-id="es-es" dir="ltr">Español</option><option data-id="fr-fr" dir="ltr">Français</option><option data-id="hu-hu" dir="ltr">Magyar</option><option data-id="it-it" dir="ltr">Italiano</option><option data-id="ja-jp" dir="ltr">日本語</option><option data-id="ko-kr" dir="ltr">한국어</option><option data-id="nl-nl" dir="ltr">Nederlands</option><option data-id="pl-pl" dir="ltr">Polski</option><option data-id="pt-br" dir="ltr">Português (Brasil)</option><option data-id="pt-pt" dir="ltr">Português (Portugal)</option><option data-id="ru-ru" dir="ltr">Pусский</option><option data-id="sv-se" dir="ltr">Svenska</option><option data-id="tr-tr" dir="ltr">Türkçe</option><option data-id="zh-cn" dir="ltr">中文 (简体)</option><option data-id="zh-tw" dir="ltr">中文 (繁體)</option></select>
    
    <ul class="links" ms.cmpgrp="footer link">
      <li><a id="footer-about-link" href="https://docs.microsoft.com/teamblog">Blog</a></li>
      <li><a id="footer-privacy-link" href="https://privacy.microsoft.com/en-us/">Privacy &amp; Cookies</a></li>
      <li><a id="footer-term-of-use" href="https://docs.microsoft.com/en-us/legal/termsofuse">Terms of Use</a></li>
      <li><a href="https://aka.ms/sitefeedback">Feedback</a></li>
      <li id="impressum-section"><a id="impressum-link" href="https://docs.microsoft.com/en-us/azure/guidance/guidance-elasticsearch-tuning-data-aggregation-and-query-performance#">Impressum</a></li>
      <li><a href="https://www.microsoft.com/en-us/legal/intellectualproperty/Trademarks/EN-US.aspx">Trademarks</a></li>
    </ul>
  </div>
</footer>

<!---->



    <script type="text/javascript" async="" id="smcx-sdk" src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/79yNbHm5_2Bc09cabC381UfD6Mz_2FuWCiepbBF6EB_2FT0Ea4MCk82Bh_2BApaijjR77BSR.js.下载"></script><script src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/e0ce3378843779296d07.conceptual.js.下载"></script>
  
<link rel="stylesheet" type="text/css" href="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/open-commenting.ui.v1.0.2-7-g1b78816.master.min.css"><link rel="stylesheet" type="text/css" href="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/open-commenting.ui.docs.v1.0.2-7-g1b78816.master.min.css"><img src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/c.gif" style="display: none;"><script type="text/javascript" src="./Tuning data aggregation and query performance with Elasticsearch on Azure _ Microsoft Docs_files/open-rating.ui-v0.6.1-85-g59868b4.master.min.js.下载"></script><div id="fyre-messenger-1"></div><div class="lf"><div class="lf-popover lf-thread-popover"><div class="lf-thread-content lf-popover-content"></div>
<div class="lf-popover-arrow"></div>
</div></div></body></html>